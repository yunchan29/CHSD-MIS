<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CHSD MIS</title>
    <link rel="stylesheet" href="/Stylesheets/style.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"/>
    <style>
        .content {
            flex: 1;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        .content-container {
            overflow-y: auto;
            padding: 20px;
        }
        .form-step {
            display: none;
        }
        .form-step.active {
            display: block;
        }
        .step {
            display: inline-block;
            margin-right: 20px;
            opacity: 0.5;
        }
        .step.completed .circle {
            background-color: green;
        }
        .step.active {
            opacity: 1;
        }
    </style>
</head>
<body>

    <div id="loading-screen" class="loading-screen" style="display: none;">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
    </div>

    <div class="main-container d-flex">
        <div class="sideNav" id="side_nav">
            <div class="header-box text-center">
                <button class="btn d-md-none d-block close-btn px-1 py-0 text-white"><i class="fal fa-stream"></i>Menu</button>
            </div>
            <ul class="sideBarList list-unstyled px-2">
                <li class="sideNav active"><a href="/AdminPages/InformalSettlers/InformalSettlersApplication.html" class="text-decoration-none"><i class="fa-solid fa-folder"></i> Housing Application</a></li>
                <li class="sideNav"><a href="/AdminPages/InformalSettlers/InformalSettlersReport.html" class="text-decoration-none"><i class="fa-solid fa-chart-column"></i> Application Report</a></li>
                <li class="sideNav"><a href="/AdminPages/InformalSettlers/InformalSettlersUserManager.html" class="text-decoration-none"><i class="fa-solid fa-user-pen"></i> User Manager</a></li>
                <li class="sideNav"><a id="admin-logout-btn"><i class="fa-solid fa-right-from-bracket"></i> Log out</a></li>
            </ul>
        </div>

        <div class="content">
            <nav class="navigationBar navbar navbar-expand-lg bg-light">
                <div class="container-fluid">
                    <div class="d-flex justify-content-between d-md-none d-block">
                        <a class="navbar-brand d-flex align-items-center" href="#">
                            <img src="/resources/pictures/chsd.png" alt="CHSD" width="40" height="40" class="me-2">
                            <h5 class="mb-0 fs-5">CHSD</h5>
                        </a>
                        <button class="btn px-1 py-0 open-btn">
                            <i class="fa-solid fa-bars-staggered"></i>
                        </button>
                    </div>

                    <div class="collapse navbar-collapse d-none d-md-flex" id="navbarSupportedContent">
                        <a class="navbar-brand d-flex align-items-center" href="#">
                            <img src="/resources/pictures/chsd.png" alt="CHSD" width="75" height="75" class="me-2">
                            <h5 class="mb-0 fs-5 fs-lg-4">City Housing and Settlements Department</h5>
                        </a>
                    </div>
                </div>
            </nav>

          <div class="contentContainer">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <!-- Add Profile Button on the left -->
                <button type="button" class="btn btn-dark data-bs-toggle="modal" data-bs-target="#housingApplicationModal">
                    <i class="fa-solid fa-plus"></i> Add Profile
                </button>
            
                <!-- Search Bar, Sort, and Filter on the right -->
                <div class="input-group" style="width: auto;">
                    <input type="text" class="form-control" id="searchBar" placeholder="Search..." oninput="filterProfiles()">
            
                    <div class="input-group-append">
                        <button class="btn btn-secondary dropdown-toggle" type="button" id="sortFilterDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                            Sort/Filter
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="sortFilterDropdown">
                            <li><a class="dropdown-item" href="#" onclick="sortProfilesByName()">Sort by Name</a></li>
                            <li><a class="dropdown-item" href="#" onclick="sortProfilesByDate()">Sort by Date Profiled</a></li>
                            <li><a class="dropdown-item" href="#" onclick="filterByStatus('Pending')">Filter by Pending</a></li>
                            <li><a class="dropdown-item" href="#" onclick="filterByStatus('Approved')">Filter by Approved</a></li>
                            <li><a class="dropdown-item" href="#" onclick="filterByStatus('Archived')">Filter by Archived</a></li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <!-- Table Section -->
            <h4 class="text-center mt-2 mb-2">Housing Applications</h4>
            <table class="table table-striped">
                <thead>
                    <tr>
                        
                        <th>Household Head</th>
                        <th>Date Submitted</th>
                        <th>Status</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody class="housingDiv">
                    <!-- Profiles will be inserted here by JavaScript -->
                </tbody>
            </table>
            
                <div id="paginationControls">
                    <button class="btn btn-primary" id="prevPageBtn" disabled>Previous</button>
                    <span id="pageInfo">Page 1 of 1</span>
                    <button class="btn btn-primary" id="nextPageBtn" disabled>Next</button>
                </div>
                
           
            

  
  <div class="modal fade" id="housingApplicationModal" tabindex="-1" aria-labelledby="housingApplicationModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered wide-modal">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="housingApplicationModalLabel">Housing Application</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
            
                

               
                <div class="step-progress mb-4">
                    <div class="step completed" id="step-1">
                        <div class="circle"></div>
                        <div class="label">Information of Household</div>
                    </div>
                    <div class="step" id="step-2">
                        <div class="circle"></div>
                        <div class="label">Household Members</div>
                    </div>
                    <div class="step" id="step-3">
                        <div class="circle"></div>
                        <div class="label">Lot and House Characteristics</div>
                    </div>
                </div>
               
              <!-- Form Steps -->
<div class="form-step active" id="form-step-1">
    <h5>Household Head Details</h5>
    <div class="row">
        <div class="col">
            <label for="surveyNo">Survey No.</label>
            <input type="text" id="surveyNo" class="form-control">
        </div>
        <div class="col">
            <label for="dateApplied">Date</label>
            <input type="date" id="dateApplied" class="form-control">
        </div>
        <div class="col">
            <label for="barangay">Barangay</label>
            <select class="form-control" id="barangay">
              <option>Barangay 1</option>
              <option>Barangay 2</option>
              <option>Barangay 3</option>
            </select>
        </div>
        <div class="col">
            <label for="sitioPurok">Sitio/Purok</label>
            <select class="form-control" id="sitioPurok">
                <option>Purok 1</option>
                <option></option>
                <option></option>
                <option></option>

            </select>
        </div>
    </div>

    <div class="row">
        <div class="col-md-4">
           <label for="classificationArea">Classification Area</label>
           <input type="text" class="form-control" id="classificationArea">
        </div>
        <div class="col-md-8">
           <label for="householdRemarks">Remarks</label>
           <textarea class="form-control" id="householdRemarks" rows="1">
           </textarea>
        </div>
    </div>

    <div class="row">
        <div class="col-md-3">
           <label for="householdBirthday">Date of Birth</label>
           <input type="date" class="form-control" id="householdBirthday">
        </div>
        <div class="col-md-3">
            <label for="householdSex">Sex</label>
            <select class="form-control" id="householdSex">
                <option>Male</option>
                <option>Female</option>
            </select>
        </div>
        <div class="col-md-3">
            <label for="householdCivilStatus">Civil Status</label>
            <select class="form-control" id="householdCivilStatus">
                <option></option>
                <option></option>
            </select>
        </div>
    </div>


    <div class="row">
        <div class="col-md-3">
            <label for="householdLastName">Last Name</label>
            <input type="text" class="form-control" id="householdLastName">
        </div>
        <div class="col-md-3">
            <label for="householdFirstName">First Name</label>
            <input type="text" class="form-control" id="householdFirstName">
        </div>
        <div class="col-md-3">
            <label for="householdMiddleName">Middle Name</label>
            <input type="text" class="form-control" id="householdMiddleName">
        </div>
        <div class="col-md-3">
            <label for="householdMaidenName">Maiden Name</label>
            <input type="text" class="form-control" id="householdMaidenName">
        </div>
    </div>

    <div class="row">
       <div class="col-md-6">
        <label for="householdOccupation">Occupation</label>
        <input type="text" class="form-control" id="householdOccupation">
       </div>

       <div class="col-md-6">
         <label for="householdPlaceOfWork">Place Of Work</label>
         <input type="text" class="form-control" id="householdPlaceOfWork">
       </div>
    </div>

    <div class="row">
        <div class="col">
            <label for="householdAddress">Present Address</label>
            <textarea class="form-control" id="householdAddress" rows="1"></textarea>
        </div>
    </div>

    <div class="row">

    </div>

    <div class="row">
        <h5>Name of Spouse</h5>
    </div>
    <div class="row">
        <div class="col-md-3">
            <label for="spouseLastName">Last Name</label>
            <input type="text" class="form-control" id="spouseLastName">
        </div>
        <div class="col-md-3">
            <label for="spouseFirstName">First Name</label>
            <input type="text" class="form-control" id="spouseFirstName">
        </div>
        <div class="col-md-3">
            <label for="spouseMiddleName">Middle Name</label>
            <input type="text" class="form-control" id="spouseMiddleName">
        </div>
        <div class="col-md-3">
            <label for="spouseMaidenName">Maiden Name</label>
            <input type="text" class="form-control" id="spouseMaidenName">
        </div>
    </div>

    <div class="row">
        <div class="col-md-3">
            <label for="spouseBirthday">Date of Birth</label>
            <input type="date" class="form-control" id="spouseBirthday">
        </div>
    </div>

    <div class="row">
        <div class="col-md-4">
           <label for="classificationOfSurveyHousehold">Classification Of Survey Household</label>
           <select class="form-control" id="classificationOfSurveyHousehold">
            <option></option>
           </select>
        </div>
        <div class="col-md-2">
            <label for="householdAmount">Amount</label>
            <input type="number" class="form-control" id="householdAmount">
        </div>
        <div class="col-md-6">
            <label for="structureOwner">Structure Owner</label>
            <input type="text" class="form-control" id="structureOwner">
        </div>
    </div>

    <div class="row">
        <div class="col-md-6">
             <label for="provinceOfOrigin">Province Of Origin</label>
             <input type="text" class="form-control" id="provinceOfOrigin">
        </div>
        <div class="col-md-3">
            <label for="householdSize">Household Size</label>
            <input type="number" class="form-control" id="householdSize">
        </div>
        <div class="col-md-3">
            <label for="yearOfResidency">Year of Residency</label>
            <input type="text" class="form-control" id="yearOfResidency">
        </div>
    </div>

    <div class="row">

        <label for="reasonsForEstablishing">Reasons For Establishing Residence In The Area</label>
        <textarea class="form-control" id="reasonsForEstablishing"></textarea>
    </div>

   
    
        


   
  

    <div class="row justify-content-end mt-4">
        <div class="col">
           
        </div>
    </div>
</div>


                <div class="form-step" id="form-step-2">
                    
                    
                    <h5>Household Members Information</h5>
                    <div class="row">
                        <div class="col-md-6">
                            <label for="memberName">Name</label>
                            <input type="text" id="memberName" class="form-control">
                        </div>
                        <div class="col-md-6">
                            <label for="relationToHead">Relation To The Household Head</label>
                            <input type="text" class="form-control" id="relationToHead">
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-2">
                            <label for="memberAge">Age</label>
                            <input type="number" class="form-control" id="memberAge">
                        </div>
                        <div class="col-md-2">
                            <label for="memberGender">Gender</label>
                            <select class="form-control" id="memberGender">
                                <option>Male</option>
                                <option>Female</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label for="memberCivilStatus">Civil Status</label>
                            <select class="form-control" id="memberCivilStatus">
                                <option>Single</option>
                                <option></option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="memberEducationalAttainment">Educational Attainment</label>
                            <input type="text" class="form-control" id="memberEducationalAttainment">
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-2">
                            <label for="memberEmployed">Employed</label>
                            <select class="form-control" id="memberEmployed">
                                <option></option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label for="memberOccupation">Occupation</label>
                            <input type="text" class="form-control" id="memberOccupation">
                        </div>
                        <div class="col-md-3">
                            <label for="memberPlaceOfWork">Place of Work</label>
                            <input type="text" class="form-control" id="memberPlaceOfWork">
                        </div>
                        <div class="col-md-3">
                            <label for="memberMonthlyIncome">Monthly Income(PHP)</label>
                            <input type="number" class="form-control" id="memberMonthlyIncome">
                        </div>
                        
                    </div>

                    <div class="row justify-content-end mt-4">
                        <div class="col">
                           
                        </div>
                    </div>

                    <div class="row">
                        <div class="col text-end">
                            <button class="btn btn-secondary"><i class="fa-solid fa-plus"></i> Add</button>
                            <button class="btn btn-secondary"><i class="fa-solid fa-delete-left"></i> Clear</button>
                            <button class="btn btn-secondary"><i class="fa-solid fa-pencil"></i> Edit</button>
                            <button class="btn btn-secondary"><i class="fa-solid fa-trash"></i> Delete</button>
                        </div>
                    </div>

                    <div class="contentContainer">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Relation</th>
                                    <th>Age</th>
                                    <th>Gender</th>
                                    <th>Civil Status</th>
                                    <th>Educational Attainment</th>
                                    <th>Employed</th>
                                    <th>Occupation</th>
                                    <th>Place of Work</th>
                                    <th>Monthly Income</th>
                                </tr>
                            </thead>
                        </table>
                    </div>
                    
                </div>

                <div class="form-step" id="form-step-3">
                    <h5>Lot Information</h5>
                    <div class="row">
                        <div class="col-md-6">
                            <label for="lotOwner">Owner</label>
                            <input type="text" class="form-control" id="lotOwner">
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <label for="construction">Construction/Building Materials Used</label>
                            <select class="form-control" i="construction">
                                <option>Concrete</option>
                                <option>Wood/Nipa</option>
                                <option>Plastic Roof Only</option>
                                <option>Tent</option>
                                <option>Mixed Materials</option>
                                <option>Sharer</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <label for="NOStoreys">Number Of Storeys</label>
                            <input type="number" id="NOStoreys" class="form-control">
                        </div>
                        <div class="col-md-4">
                            <label for="estimatedFloorArea">Estimated Floor Area</label>
                            <input type="number" class="form-control" id="estimatedFloorArea">
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <label for="comfortRoom">Comfort Room</label>
                            <select class="form-control" id="comfortRoom">
                                <option>With Septic Tank Vault</option>
                                <option>Without Septic</option>
                                <option>None</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="utilities">Utilities/Facilities Present Power(Electricity)</label>
                            <select class="form-control" id="utilities">
                                <option>Meralco</option>
                                <option>Connected To Other Subscriber</option>
                                <option>None</option>
                            </select>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <label for="sourceOfWater">Source of Water</label>
                            <select class="form-control" id="sourceOfWater">
                                <option></option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="telephone">Telephone</label>
                            <select class="form-control" id="telephone">
                                <option>Landline</option>
                                <option>Cellphone</option>
                                <option>Others</option>
                            </select>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <label for="modeOfHouse">Mode Of House/Structure Acquistion</label>
                            <select class="form-control" id="modeOfHouse">
                                <option>Sold Rights</option>
                                <option>Transfer Rights</option>
                                <option>Constructed</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label for="infoAboutLot">Information About The Surveyed Lot</label>
                            <select class="form-control" id="infoAboutLot">
                                <option>Caretaker</option>
                                <option>Co-Owner</option>
                                <option>Renter</option>
                                <option>RFO</option>
                                <option>Sharer</option>
                            </select>
                        </div>

                        <div class="col-md-2">
                            <label for="amountToPay">Amount To Pay</label>
                            <input type="number" id="amountToPay" class="form-control">
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <label for="relationshipWithOwner">Relationship With The Owner</label>
                            <select class="form-control" id="relationshipWithOwner">
                                <option>Lot Owner</option>
                                <option>Child</option>
                                <option>Parent</option>
                                <option>Relative</option>
                                <option>Others</option>
                            </select>
                        </div>

                        <div class="col-md-6">
                            <label for="typeOfStructure">Type Of Structure</label>
                            <select class="form-control" id="typeOfStructure">
                                <option>Residential</option>
                                <option>Commercial</option>
                                <option>Apartment</option>
                                <option>Institution</option>
                                <option>Others</option>
                            </select>
                        </div>
                    </div>
                   
                    <div class="row justify-content-between mt-4">
                       <div class="col">
                        
                       
                       </div>
                    </div>
                
            </div>
        </div>
        <div class="modal-footer"> 
            <button type="button" class="btn btn-primary" id="nextBtn1">Next</button>
            <button type="button" class="btn btn-secondary" id="prevBtn2" style="display:none;">Previous</button>
            <button type="button" class="btn btn-primary" id="nextBtn2" style="display:none;">Next</button>
            <button type="button" class="btn btn-secondary" id="prevBtn3" style="display:none;">Previous</button>
            <button type="button" class="btn btn-primary" id="submitBtn" style="display:none;">Submit</button>
        </div>
        
          
      </div>
    </div>
  </div>

          </div>
        </div>
    </div>



    <div class="modal fade" id="viewHousingApplicationModal" tabindex="-1" aria-labelledby="housingApplicationModalTitle" aria-hidden="true">
        <div class="wide-modal modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="housingApplicationModalTitle"></h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="housingApplicationModalBody">
                    <!-- Housing application details will be populated here -->
                </div>
                <div class="modal-footer">
                    <!-- Print Button -->
              
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="printHousingApplicationBtn">Print</button>
                </div>
            </div>
        </div>
    </div>
    

    
     <!-- View Details Modal --> 
<div class="modal fade" id="viewDetailsModal" tabindex="-1" aria-labelledby="viewDetailsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="viewDetailsModalLabel">Permit Details</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <!-- Text information at the top -->
                <div class="row">
                    <div class="col-md-6">
                        <p><strong>Owner Name:</strong> <span id="housingOwnerName"></span></p>
                    </div>
                    <div class="col-md-6">
                        <p><strong>Issued On:</strong> <span id="issuedOnDate"></span></p>
                    </div>
                </div>
            
                <div class="row">
                    <div class="col-md-6">
                        <p><strong>Appointment Date:</strong> <span id="appointmentDateSched"></span></p>
                    </div>
                    <div class="col-md-6">
                        <p><strong>Permit ID:</strong> <span id="permitIdDisplay"></span></p>
                    </div>
                </div>
            
                <!-- Status selection in a row -->
                <div class="row mb-3">
                    <div class="col-md-12">
                        <label for="statusSelect" class="form-label">Status</label>
                        <select id="statusSelect" class="form-select">
                            <option value="Pending">Pending</option>
                            <option value="Processing">Processing</option>
                            <option value="To Pay">To Pay</option>
                            <option value="For Approval">For Approval</option>
                            <option value="For Release">For Release</option>
                            <option value="Claimed">Claimed</option>
                        </select>
                    </div>
                </div>
            
                <!-- Comments section -->
                <div class="row">
                    <div class="col-md-12">
                        <label for="officerRemarks">Comments</label>
                        <textarea class="form-control" id="officerRemarks" rows="2"></textarea>
                    </div>
                </div>
            
                <div id="viewDetailsModalBtnGrp">
                    <!-- Any additional buttons can be added here if needed -->
                </div>
            
                <!-- Hidden input field to store the permit ID -->
                <input type="hidden" id="profileIdInput"> <!-- Update this to match your JavaScript -->
            </div>
            
            <div class="modal-footer">
                <button type="button" id="saveStatusBtn" class="btn btn-primary">Save</button>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<div id="notification-container" class="position-fixed bottom-0 end-0 p-3" style="z-index: 1050; display: none;">
    <!-- Notifications will be dynamically added here -->
</div>


    <!-- Bootstrap JS and Popper.js -->
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js" ></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js"></script>

    <script type="module" src="/Database/firebase.js"></script>
<!--Print-->
    <script>
document.addEventListener('DOMContentLoaded', function () {
    document.getElementById('printHousingApplicationBtn').addEventListener('click', function () {
        // Trigger the print dialog
        window.print();
    });
});


    </script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getAuth } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
        import { getFirestore, collection, getDocs, updateDoc, doc, serverTimestamp, getDoc, setDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
    
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBhvoPidRWGeJmnN2E11SBS5n8oyxVLJ0M",
            authDomain: "chsd-mis.firebaseapp.com",
            projectId: "chsd-mis",
            storageBucket: "chsd-mis.appspot.com",
            messagingSenderId: "694967679357",
            appId: "1:694967679357:web:65cffd50f13739f934f414",
            measurementId: "G-XBQTQFRLJ5"
        };
    
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
    
  // Function to dynamically append buttons to the View Details Modal for Housing
function appendButtons(data) {
    const viewDetailsModalBtnGrp = document.getElementById('viewDetailsModalBtnGrp');
    viewDetailsModalBtnGrp.innerHTML = ''; // Clear existing buttons

    // First row for 'View Housing Application' 
    const firstRow = document.createElement('div');
    firstRow.className = 'row mt-4';

    const col1 = document.createElement('div');
    col1.className = 'col-md-12 mb-2';
    const btn1 = document.createElement('button');
    btn1.className = 'btn btn-primary w-100 view-housing-btn';
    btn1.setAttribute('data-permit-id', data.id);
    btn1.textContent = 'View Housing Application';
    btn1.addEventListener('click', () => {
        const viewDetailsModal = bootstrap.Modal.getInstance(document.getElementById('viewDetailsModal'));
        if (viewDetailsModal) viewDetailsModal.hide();

        // Call openViewHousingApplicationModal to display data
        // Modified to pass the entire data object instead of just data.id
        openViewHousingApplicationModal(data);
    });
    col1.appendChild(btn1);

    firstRow.appendChild(col1);

    // Second row for 'Archive Application'
    const secondRow = document.createElement('div');
    secondRow.className = 'row mt-2';

    const col3 = document.createElement('div');
    col3.className = 'col-md-12 mb-2';
    const btn3 = document.createElement('button');
    btn3.className = 'btn btn-danger w-100 archive-btn';
    btn3.textContent = 'Archive Application';
    btn3.setAttribute('data-id', data.id);
    btn3.addEventListener('click', handleArchiveHousingApplication);
    col3.appendChild(btn3);

    secondRow.appendChild(col3);

    // Append both rows to the modal button group
    viewDetailsModalBtnGrp.appendChild(firstRow);
    viewDetailsModalBtnGrp.appendChild(secondRow);
}



        // Notification Function
        function showNotification(message, type) {
            const notificationContainer = document.getElementById('notification-container');
            if (notificationContainer) {
                const notification = document.createElement('div');
                notification.className = `notification ${type}`;
                notification.textContent = message;
                notificationContainer.appendChild(notification);
    
                // Automatically remove notification after 5 seconds
                setTimeout(() => {
                    notification.remove();
                }, 5000);
            } else {
                console.error('Notification container not found.');
            }
        }
    
        // Pagination Variables
        let profilesPerPage = 10; // Profiles per page
        let currentPage = 1; // Current page
        let totalPages = 1; // Total pages
    
        // Function to Load Housing Profiles and Display in the Table
        async function loadProfiles() {
            try {
                const querySnapshot = await getDocs(collection(db, "Housing"));
                const housingDiv = document.querySelector("tbody");
                const prevPageBtn = document.getElementById("prevPageBtn");
                const nextPageBtn = document.getElementById("nextPageBtn");
                const pageInfo = document.getElementById("pageInfo");
    
                if (!housingDiv) {
                    console.error("housingDiv not found in the DOM.");
                    return;
                }
    
                housingDiv.innerHTML = ""; // Clear existing rows
    
                // Fetch and Process Housing Data
                const housingData = querySnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                const uniqueHousingData = Array.from(new Set(housingData.map(a => a.id)))
                    .map(id => housingData.find(a => a.id === id));
    
                // Sort by createdAt (ascending)
                uniqueHousingData.sort((a, b) => {
                    const aTime = a.createdAt?.seconds || 0;
                    const bTime = b.createdAt?.seconds || 0;
                    return aTime - bTime;
                });
    
                // Calculate Total Pages
                totalPages = Math.ceil(uniqueHousingData.length / profilesPerPage);
    
                // Determine Profiles for Current Page
                const start = (currentPage - 1) * profilesPerPage;
                const end = start + profilesPerPage;
                const currentProfiles = uniqueHousingData.slice(start, end);
    
                for (const data of currentProfiles) {
                    const row = document.createElement("tr");
    
                    let representativeName = data.householdHeadName || "N/A";
                    const createdAt = data.createdAt ? new Date(data.createdAt.seconds * 1000).toLocaleString() : "N/A";
    
                    row.innerHTML = `
                        
                        <td>${representativeName}</td>
                        <td>${createdAt}</td>
                        <td>${data.status || "N/A"}</td>
                        <td>
                            <button class="btn btn-primary btn-sm view-details-btn" data-permit-id="${data.id}">View Details</button>
                        </td>
                    `;
    
                    housingDiv.appendChild(row);
    
                    const viewDetailsBtn = row.querySelector(".view-details-btn");
                    if (viewDetailsBtn) {
                        viewDetailsBtn.addEventListener("click", () => {
                            openViewDetailsModal(data);
                        });
                    }
                }
    
                pageInfo.textContent = `Page ${currentPage} of ${totalPages}`;
                prevPageBtn.disabled = currentPage === 1;
                nextPageBtn.disabled = currentPage === totalPages;
    
            } catch (error) {
                console.error("Error loading profiles:", error);
                showNotification("Failed to load profiles.", "error");
            }
        }


        function openViewHousingApplicationModal(data) {
    // Get the modal elements
    const modalTitle = document.getElementById('housingApplicationModalTitle');
    const modalBody = document.getElementById('housingApplicationModalBody');

    // Set modal title
    modalTitle.textContent = `Housing Application - ${data.householdHeadName}`;

    // Check if householdMembers is an array, if not, set it as an empty array
    const householdMembers = Array.isArray(data.householdMembers) ? data.householdMembers : [];

    // Populate modal body with the housing application data
    modalBody.innerHTML = `
        <p><strong>Number of Storeys:</strong> ${data.NOStoreys}</p>
        <p><strong>Amount to Pay:</strong> ${data.amountToPay}</p>
        <p><strong>Barangay:</strong> ${data.barangay}</p>
        <p><strong>Classification Area:</strong> ${data.classificationArea}</p>
        <p><strong>Classification of Survey Household:</strong> ${data.classificationOfSurveyHousehold}</p>
        <p><strong>Comfort Room:</strong> ${data.comfortRoom}</p>
        <p><strong>Construction:</strong> ${data.construction}</p>
        <p><strong>Date Applied:</strong> ${data.dateApplied}</p>
        <p><strong>Estimated Floor Area:</strong> ${data.estimatedFloorArea}</p>
        <p><strong>Household Address:</strong> ${data.householdAddress}</p>
        <p><strong>Household Amount:</strong> ${data.householdAmount}</p>
        <p><strong>Household Birthday:</strong> ${data.householdBirthday}</p>
        <p><strong>Household Civil Status:</strong> ${data.householdCivilStatus}</p>
        <p><strong>Household Head Name:</strong> ${data.householdHeadName}</p>
        <p><strong>Household Members:</strong></p>
        ${householdMembers.map((member, index) => `
            <p><strong>Member ${index + 1}:</strong></p>
            <ul>
                <li><strong>Name:</strong> ${member.name}</li>
                <li><strong>Age:</strong> ${member.age}</li>
                <li><strong>Gender:</strong> ${member.gender}</li>
                <li><strong>Civil Status:</strong> ${member.civilStatus}</li>
                <li><strong>Education:</strong> ${member.education}</li>
                <li><strong>Employed:</strong> ${member.employed}</li>
                <li><strong>Occupation:</strong> ${member.occupation || 'N/A'}</li>
                <li><strong>Place of Work:</strong> ${member.placeOfWork || 'N/A'}</li>
                <li><strong>Relation:</strong> ${member.relation}</li>
            </ul>`).join('')}
        <p><strong>Household Occupation:</strong> ${data.householdOccupation}</p>
        <p><strong>Household Place of Work:</strong> ${data.householdPlaceOfWork}</p>
        <p><strong>Remarks:</strong> ${data.householdRemarks}</p>
        <p><strong>Info About Lot:</strong> ${data.infoAboutLot}</p>
        <p><strong>Lot Owner:</strong> ${data.lotOwner}</p>
        <p><strong>Mode of House:</strong> ${data.modeOfHouse}</p>
        <p><strong>Province of Origin:</strong> ${data.provinceOfOrigin}</p>
        <p><strong>Reasons for Establishing:</strong> ${data.reasonsForEstablishing}</p>
        <p><strong>Relationship with Owner:</strong> ${data.relationshipWithOwner}</p>
        <p><strong>Sitio/Purok:</strong> ${data.sitioPurok}</p>
        <p><strong>Status:</strong> ${data.status}</p>
        <p><strong>Structure Owner:</strong> ${data.structureOwner}</p>
        <p><strong>Type of Structure:</strong> ${data.typeOfStructure}</p>
        <p><strong>Year of Residency:</strong> ${data.yearOfResidency}</p>
        <p><strong>Utilities:</strong> ${data.utilities}</p>
    `;

    // Show the modal
    const modalInstance = new bootstrap.Modal(document.getElementById('viewHousingApplicationModal'));
    modalInstance.show();
}



       // Function to Handle Status Update
async function updateStatusOptions() {
    const selectedProfileId = document.getElementById("profileIdInput").value;
    const newStatus = document.getElementById("statusSelect").value;
    const timestamp = serverTimestamp();

    if (selectedProfileId) {
        try {
            const profileRef = doc(db, "Housing", selectedProfileId);
            await updateDoc(profileRef, {
                status: newStatus,
                updatedAt: timestamp
            });
            showNotification("Status updated successfully!", "success");
            loadProfiles();  // Refresh profiles after status update
            closeModal("viewDetailsModal"); // Close the modal after updating
        } catch (error) {
            console.error("Error updating status:", error);
            showNotification("Failed to update status.", "error");
        }
    } else {
        console.error("No profile selected for status update.");
    }
}

    
        // Function to Archive a Housing Application
        async function handleArchiveHousingApplication(event) {
            event.preventDefault();
            const housingAppId = event.target.getAttribute('data-id');
    
            if (!housingAppId) {
                console.error("Housing Application ID is null or undefined.");
                showNotification("Error: Housing Application ID is missing.", "error");
                return;
            }
    
            const confirmed = confirm("Are you sure you want to archive this housing application?");
            if (!confirmed) return;
    
            try {
                const housingAppRef = doc(db, "Housing", housingAppId);
                const housingAppSnapshot = await getDoc(housingAppRef);
    
                if (housingAppSnapshot.exists()) {
                    const housingAppData = housingAppSnapshot.data();
    
                    await setDoc(doc(db, "archivedHousingApplications", housingAppId), housingAppData);
                    await deleteDoc(housingAppRef);
    
                    const tableBody = document.querySelector(".housingDiv");  // Use class selector since tbody has class="housingDiv"
if (tableBody) {
    const rowToRemove = tableBody.querySelector(`button[data-permit-id="${housingAppId}"]`)?.closest('tr');
    if (rowToRemove) rowToRemove.remove();
} else {
    console.error(".housingDiv not found in the DOM.");
    showNotification("Error: Failed to locate the housing application row.", "error");
}

                    const viewDetailsModal = bootstrap.Modal.getInstance(document.getElementById('viewDetailsModal'));
                    if (viewDetailsModal) {
                        viewDetailsModal.hide();
                    }
    
                } else {
                    showNotification("Housing application not found!", "error");
                }
            } catch (error) {
                console.error("Error archiving housing application: ", error);
                showNotification(`Failed to archive housing application: ${error.message}`, "error");
            }
        }
    
        function closeModal(modalId) {
    const modalElement = document.getElementById(modalId);
    const modalInstance = bootstrap.Modal.getInstance(modalElement);
    if (modalInstance) {
        modalInstance.hide();
    } else {
        console.error(`No modal found with ID: ${modalId}`);
    }
}

        // Function to Open the View Details Modal
        function openViewDetailsModal(data) {
            let representativeName = data.householdHeadName || "N/A";
            const createdAt = data.createdAt ? new Date(data.createdAt.seconds * 1000).toLocaleString() : "N/A";
    
            document.getElementById("housingOwnerName").textContent = representativeName;
            document.getElementById("issuedOnDate").textContent = createdAt;
            document.getElementById("statusSelect").value = data.status || "N/A";
            document.getElementById("profileIdInput").value = data.id;
    
            updateStatusOptions(data.status);
            appendButtons(data);
    
            const viewDetailsModal = new bootstrap.Modal(document.getElementById('viewDetailsModal'));
            viewDetailsModal.show();
        }
    
        // Initialize the Table with Profiles
        document.addEventListener("DOMContentLoaded", loadProfiles);
    
        // Pagination Buttons
        document.getElementById("prevPageBtn").addEventListener("click", () => {
            if (currentPage > 1) {
                currentPage--;
                loadProfiles();
            }
        });
    
        document.getElementById("nextPageBtn").addEventListener("click", () => {
            if (currentPage < totalPages) {
                currentPage++;
                loadProfiles();
            }
        });
    </script>
    
    <script>
       // Function to show the next form step and control button visibility
function showNextStep(currentStep, nextStep) {
    document.getElementById(`form-step-${currentStep}`).classList.remove('active');
    document.getElementById(`form-step-${nextStep}`).classList.add('active');
    document.getElementById(`step-${currentStep}`).classList.add('completed');
    document.getElementById(`step-${nextStep}`).classList.add('active');
    document.getElementById(`step-${currentStep}`).classList.remove('active');

    // Handle button visibility
    handleButtonVisibility(nextStep);
}

// Function to show the previous form step and control button visibility
function showPreviousStep(currentStep, prevStep) {
    document.getElementById(`form-step-${currentStep}`).classList.remove('active');
    document.getElementById(`form-step-${prevStep}`).classList.add('active');
    document.getElementById(`step-${currentStep}`).classList.remove('completed');
    document.getElementById(`step-${prevStep}`).classList.add('active');

    // Handle button visibility
    handleButtonVisibility(prevStep);
}

// Function to handle button visibility based on the step
function handleButtonVisibility(step) {
    // Initially hide all buttons
    document.getElementById('nextBtn1').style.display = 'none';
    document.getElementById('prevBtn2').style.display = 'none';
    document.getElementById('nextBtn2').style.display = 'none';
    document.getElementById('prevBtn3').style.display = 'none';
    document.getElementById('submitBtn').style.display = 'none';

    // Show buttons based on the step
    if (step === 1) {
        document.getElementById('nextBtn1').style.display = 'inline-block';
    } else if (step === 2) {
        document.getElementById('prevBtn2').style.display = 'inline-block';
        document.getElementById('nextBtn2').style.display = 'inline-block';
    } else if (step === 3) {
        document.getElementById('prevBtn3').style.display = 'inline-block';
        document.getElementById('submitBtn').style.display = 'inline-block';
    }
}

// Event Listeners for Next and Previous Buttons
document.getElementById('nextBtn1').addEventListener('click', function() {
    showNextStep(1, 2); // Move from step 1 to step 2
});

document.getElementById('nextBtn2').addEventListener('click', function() {
    showNextStep(2, 3); // Move from step 2 to step 3
});

document.getElementById('prevBtn2').addEventListener('click', function() {
    showPreviousStep(2, 1); // Move from step 2 to step 1
});

document.getElementById('prevBtn3').addEventListener('click', function() {
    showPreviousStep(3, 2); // Move from step 3 to step 2
});

    </script>
</body>
</html>
