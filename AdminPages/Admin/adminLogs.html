<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CHSD MIS</title>
    <link rel="stylesheet" href="/Stylesheets/style.css">
    <link rel="icon" href="/resources/pictures/chsd.png" type="image/x-icon">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        /* CSS for the content container */
        .content {
            flex: 1; /* Take remaining space */
            overflow: hidden; /* Hide overflow content */
            display: flex; /* Use flexbox */
            flex-direction: column; /* Column layout */
        }

        .content-container {
            overflow-y: auto; /* Enable vertical scrolling */
            padding: 20px; /* Add some padding */
        }
    </style>
</head>
<body>
    <div class="main-container d-flex">
        <div class="sideNav" id="side_nav">
            <div class="header-box text-center px-2 pt-3 pb-4">
               
                
                <button class="btn d-md-none d-block close-btn px-1 py-0 text-black"><i class="fa-solid fa-bars-staggered"></i></button>
            </div>
            <ul class="sideBarList list-unstyled px-2">
                <li class="sideNav">
                    <a href="/AdminPages/Admin/adminUserManagement.html" class="text-decoration-none">
                        <i class="fa-solid fa-user-pen"></i> User Management</a>
                </li>
                <li class="sideNav"><a href="/AdminPages/Admin/adminForm.html" class="text-decoration-none"><i class="fa-solid fa-download"></i> Forms</a></li>
                <li class="sideNav active"><a href="/AdminPages/Admin/adminLogs.html" class="text-decoration-none"><i class="fa-solid fa-clock-rotate-left"></i> Logs</a></li>
                
                <li class="sideNav"><a id="admin-logout-btn"><i class="fa-solid fa-right-from-bracket"></i> Log out</a></li>
              </ul>
        </div>

        <div class="content">
             <!--Navigation Bar-->
<nav class="navigationBar navbar navbar-expand-lg bg-light">
  <div class="container-fluid">
      <!-- Mobile View -->
      <div class="d-flex justify-content-between d-md-none d-block">
          <a class="navbar-brand d-flex align-items-center" href="#">
              <img src="/resources/pictures/chsd.png" alt="CHSD" width="40" height="40" class="me-2">
              <h5 class="mb-0 fs-5">CHSD</h5>
          </a>
          <button class="btn px-1 py-0 open-btn">
              <i class="fa-solid fa-bars-staggered"></i>
          </button>
      </div>

      <!-- Desktop View -->
      <div class="collapse navbar-collapse d-none d-md-flex" id="navbarSupportedContent">
          <a class="navbar-brand d-flex align-items-center" href="#">
              <img src="/resources/pictures/chsd.png" alt="CHSD" width="75" height="75" class="me-2">
              <h5 class="mb-0 fs-5 fs-lg-4">City Housing and Settlements Department</h5>
          </a>
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
              <!-- Additional nav items go here -->
          </ul>
      </div>
  </div>
</nav>

        
            <div class="contentContainer">
           
<h3 class="text-center">Logs</h3>
<table class="table table-striped">
    <thead>
        <th>Date</th>
        <th>Action</th>
        <th>ID</th>
        <th>Database</th>
    </thead>
    <tbody id="logsAppend">
     
    </tbody>
</table>

</div>

        </div>
    </div>
    
    <script type="module" src="/Database/firebase.js"></script>

   
 <!--Navigation Bar-->
 <script>
  document.querySelector('.open-btn').addEventListener('click', function() {
      document.getElementById('side_nav').classList.add('active');
  });

  document.querySelector('.close-btn').addEventListener('click', function() {
      document.getElementById('side_nav').classList.remove('active');
  });
</script>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, collection, getDocs, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyBhvoPidRWGeJmnN2E11SBS5n8oyxVLJ0M",
        authDomain: "chsd-mis.firebaseapp.com",
        projectId: "chsd-mis",
        storageBucket: "chsd-mis.appspot.com",
        messagingSenderId: "694967679357",
        appId: "1:694967679357:web:65cffd50f13739f934f414",
        measurementId: "G-XBQTQFRLJ5"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // Function to fetch logs and display them with the buildingPermitNo as ID
    async function fetchAndDisplayLogs() {
        const logsTableBody = document.getElementById("logsAppend");
        const logsCollection = collection(db, "logs");

        try {
            const querySnapshot = await getDocs(logsCollection);

            for (const logDoc of querySnapshot.docs) {
                const logData = logDoc.data();

                // Format timestamp
                const date = new Date(logData.timestamp);
                const formattedDate = date.toLocaleString("en-US", {
                    year: "numeric",
                    month: "2-digit",
                    day: "2-digit",
                    hour: "2-digit",
                    minute: "2-digit",
                    second: "2-digit",
                    hour12: true,
                });

                // Fetch the buildingPermitNo from OccupancyPermits based on permitId (documentId)
                const occupancyDocRef = doc(db, "OccupancyPermits", logData.documentId);
                const occupancyDoc = await getDoc(occupancyDocRef);

                let buildingPermitNo = "N/A"; // Default value in case document or field does not exist
                if (occupancyDoc.exists() && occupancyDoc.data().buildingPermitNo) {
                    buildingPermitNo = occupancyDoc.data().buildingPermitNo;
                }

                // Create a new row
                const row = document.createElement("tr");

                // Create cells for Date, Action, ID, and Database
                const dateCell = document.createElement("td");
                dateCell.textContent = formattedDate;

                const actionCell = document.createElement("td");
                actionCell.textContent = logData.operation;

                const idCell = document.createElement("td");
                idCell.textContent = buildingPermitNo;

                const databaseCell = document.createElement("td");
                databaseCell.textContent = logData.collection;

                // Append cells to the row
                row.appendChild(dateCell);
                row.appendChild(actionCell);
                row.appendChild(idCell);
                row.appendChild(databaseCell);

                // Append the row to the table body
                logsTableBody.appendChild(row);
            }
        } catch (error) {
            console.error("Error fetching logs:", error);
        }
    }

    // Call the function to fetch and display logs
    fetchAndDisplayLogs();
</script>



    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js" integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy" crossorigin="anonymous"></script>
</body>
</html>
