<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CHSD MIS</title>
    <link rel="stylesheet" href="/Stylesheets/style.css">
    <link rel="icon" href="/resources/pictures/chsd.png" type="image/x-icon">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <style>
        /* CSS for the content container */
        .content {
            flex: 1;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .content-container {
            overflow-y: auto;
            padding: 20px;
        }

        .wide-modal {
            max-width: 80%;
        }
        @media (max-width: 768px) {
    .wide-modal {
        max-width: 100% !important;
    }
}

        .form-control {
            margin-bottom: 1rem;
        }

        .form-check {
            margin-bottom: 0.5rem;
        }

        .row.g-3 .col-md-6,
        .row.g-3 .col-md-4,
        .row.g-3 .col-md-12 {
            margin-bottom: 1rem;
        }

        .d-flex .me-2 {
            margin-right: 1rem;
        }

        .btn-upload {
            padding: 8px 16px;
            background-color: #4CAF50 !important;
            color: white !important;
            border: none;
            cursor: pointer !important;
        }

        .btn-upload:hover {
            background-color: #45a049;
        }

        .file-item {
            display: flex;
            align-items: center;
        }

        .file-name {
            margin-right: 10px;
        }

        .btn-delete {
            color: red;
            cursor: pointer;
        }

        .upload-btn-wrapper {
            position: relative;
            overflow: hidden;
            display: inline-block;
        }

        .btn-upload {
            border: 2px solid #01b813;
            color: white;
            background-color: #007bff;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 14px;
            font-weight: bold;
        }

        .upload-btn-wrapper input[type=file] {
            font-size: 100px;
            position: absolute;
            left: 0;
            top: 0;
            opacity: 0;
        }
    </style>
</head>
<body>
    <div id="loading-screen" class="loading-screen" style="display: none;">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
    </div>

    <div class="main-container d-flex">
        <!-- Sidebar -->
        <div class="sideNav" id="side_nav">
            <div class="container">
                <div class="header-box text-center px-2 pt-3 pb-4 ">
                    <button class="btn d-md-none d-block close-btn px-1 py-0 text-black"><i class="fa-solid fa-bars-staggered"></i></button>
                    <div class="avatar-placeholder">
                        <img id="client-avatar" src="" alt="loading..." width="100" height="100">
                    </div>
                    <div class="avatar-text">
                        <!-- Client ID and Name -->
                        <div id="user-name">loading...</div>
                    </div>
                </div>
            </div>
            <ul class="sideBarList list-unstyled px-2">
                <li class="sideNav"><a href="clientDashboard.html" class="text-decoration-none"><i class="fa-solid fa-circle-info"></i> Application Status</a></li>
                <li class="sideNav"><a href="clientRequirements.html" class="text-decoration-none"><i class="fa-solid fa-list"></i> Requirements List</a></li>
                <li class="sideNav dropdown open">
                    <a href="#" class="text-decoration-none"><i class="fa-solid fa-newspaper"></i> Application <i class="fas fa-caret-down"></i></a>
                    <ul class="submenu list-unstyled">
                        <li class="text-center mt-2"><a href="clientBuildingPermit.html" class="text-decoration-none">Building Permit</a></li>
                        <li class="text-center mt-2"><a href="clientOccupancyApplication.html" class="text-decoration-none">Occupancy</a></li>
                        <li class="text-center mt-2 active"><a href="clientElectricalApplication.html" class="text-decoration-none">Electrical Inspection</a></li>
                        <li class="text-center mt-2"><a href="clientHousingApplication.html" class="text-decoration-none">Housing</a></li>
                    </ul>
                </li>
                <li class="sideNav"><a href="clientProfile.html" class="text-decoration-none"><i class="fa-solid fa-gear"></i> Settings</a></li>
                
               
                <li class="sideNav" id="user-logout-btn"><a href="#" class="text-decoration-none"><i class="fa-solid fa-right-from-bracket"></i> Log out</a></li>
            </ul>
        </div>

        <div class="content">
            <nav class="navigationBar navbar navbar-expand-lg bg-light">
                <div class="container-fluid">
                    <!-- Mobile View -->
                    <div class="d-flex justify-content-between d-md-none d-block">
                        <a class="navbar-brand d-flex align-items-center" href="#">
                            <img src="/resources/pictures/chsd.png" alt="CHSD" width="40" height="40" class="me-2">
                            <h5 class="mb-0 fs-5">CHSD</h5>
                        </a>
                        <button class="btn px-1 py-0 open-btn">
                            <i class="fa-solid fa-bars-staggered"></i>
                        </button>
                    </div>
            
                    <!-- Desktop View -->
                    <div class="collapse navbar-collapse d-none d-md-flex" id="navbarSupportedContent">
                        <a class="navbar-brand d-flex align-items-center" href="#">
                            <img src="/resources/pictures/chsd.png" alt="CHSD" width="75" height="75" class="me-2">
                            <h5 class="mb-0 fs-5 fs-lg-4">City Housing and Settlements Department</h5>
                        </a>
            
                                    <!-- Right-aligned content: Notifications -->
<ul class="navbar-nav ms-auto">
    <!-- Notifications Dropdown -->
    <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
            <i class="fa-solid fa-bell"></i>
            <span id="notification-badge" class="badge bg-danger" style="display: none;">0</span>
        </a>
        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdown" style="width: 500px; padding: 15px; max-height: 500px; overflow-y: auto;">
            <li>
                <h6 class="dropdown-header">Notifications</h6>
            </li>
            <li>
                <div class="notifications-container" id="notification-container" style="max-height: 400px; overflow-y: auto; overflow-x: hidden;">
                    <!-- Notifications will be dynamically added here -->
                </div>
            </li>
            <li>
                <div class="dropdown-item text-center">
                    <button id="prevPageBtn" class="btn btn-secondary btn-sm">Previous</button>
                    <span id="pageInfo">Page 1</span>
                    <button id="nextPageBtn" class="btn btn-secondary btn-sm">Next</button>
                </div>
            </li>
        </ul>
    </li>
</ul>

                    </div>
                </div>
            </nav>
            <div class="contentContainer">
                <div class="card text-center">
                    <div class="card-body">
                        <h5 class="card-title">Start Your Application</h5>
                        <p class="card-text">Click the button below to apply for a Certificate of Electrical Inspection.</p>
                        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#electricalInspectionModal">Apply</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Certificate of Electrical Inspection Upload Modal -->
    <div class="modal fade" id="electricalInspectionModal" tabindex="-1" aria-labelledby="electricalInspectionModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable wide-modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="electricalInspectionModalLabel">Certificate of Electrical Inspection</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <!-- Step Progress Bar -->
                    <div class="step-progress mb-4">
                        <div class="step completed">
                            <div class="circle"></div>
                            <div class="label">Upload Requirements</div>
                        </div>
                        <div class="step">
                            <div class="circle"></div>
                            <div class="label">Appointment</div>
                        </div>
                    </div>
                    <!-- Content -->
                    <div class="row g-3">
                        <label for="ownerName">Owner/Applicant Name:</label>
                         <input type="text" id="ownerName" name="ownerName" class="form-control" placeholder="Last Name, First Name, Middle Name">
                    </div>
                    <div class="row">
                        <div class="col-md-4">
                            <label for="light">Light</label>
                            <select class="form-control" id="light">
                                <option value="">Select Light Type</option>
                                <option value="LED - Residential">LED - Residential</option>
                                <option value="Fluorescent - Residential">Fluorescent - Residential</option>
                                <option value="Incandescent - Residential">Incandescent - Residential</option>
                                <option value="LED - Commercial">LED - Commercial</option>
                                <option value="Fluorescent - Commercial">Fluorescent - Commercial</option>
                                <option value="Halogen - Commercial">Halogen - Commercial</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        
                        <div class="col-md-4">
                            <label for="switch">Switch</label>
                            <select class="form-control" id="switch">
                                <option value="">Select Switch Type</option>
                                <option value="Single Pole (Residential)">Single Pole (Residential)</option>
                                <option value="Double Pole (Residential)">Double Pole (Residential)</option>
                                <option value="Three-Way (Residential)">Three-Way (Residential)</option>
                                <option value="Single Pole (Commercial)">Single Pole (Commercial)</option>
                                <option value="Double Pole (Commercial)">Double Pole (Commercial)</option>
                            </select>
                        </div>
                        
                        <div class="col-md-4">
                            <label for="electricalMotor">Electrical Motor</label>
                            <select class="form-control" id="electricalMotor">
                                <option value="">Select Motor Type</option>
                                <option value="0.5 HP (Residential)">0.5 HP (Residential)</option>
                                <option value="1 HP (Residential)">1 HP (Residential)</option>
                                <option value="3 HP (Commercial)">3 HP (Commercial)</option>
                                <option value="5 HP (Commercial)">5 HP (Commercial)</option>
                                <option value="10 HP (Industrial)">10 HP (Industrial)</option>
                            </select>
                        </div>
                        
                        <div class="col-md-6">
                            <label for="convOutlet">Convenience Outlet</label>
                            <select class="form-control" id="convOutlet">
                                <option value="">Select Number of Outlets</option>
                                <option value="1 Outlet - 15A (Residential)">1 Outlet - 15A (Residential)</option>
                                <option value="2 Outlets - 15A (Residential)">2 Outlets - 15A (Residential)</option>
                                <option value="1 Outlet - 20A (Commercial)">1 Outlet - 20A (Commercial)</option>
                                <option value="2 Outlets - 20A (Commercial)">2 Outlets - 20A (Commercial)</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        
                        <div class="col-md-6">
                            <label for="otherApparatus">Other Apparatus</label>
                            <select class="form-control" id="otherApparatus">
                                <option value="">Select Apparatus Type</option>
                                <option value="Generator (Residential)">Generator (Residential)</option>
                                <option value="UPS (Residential)">UPS (Residential)</option>
                                <option value="Generator (Commercial)">Generator (Commercial)</option>
                                <option value="UPS (Commercial)">UPS (Commercial)</option>
                                <option value="Inverter (Solar)">Inverter (Solar)</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        
                        <div class="col-md-6">
                            <label for="totalKVA">Total KVA</label>
                            <select class="form-control" id="totalKVA">
                                <option value="">Select KVA Rating</option>
                                <option value="1 KVA (Residential)">1 KVA (Residential)</option>
                                <option value="2 KVA (Residential)">2 KVA (Residential)</option>
                                <option value="5 KVA (Commercial)">5 KVA (Commercial)</option>
                                <option value="10 KVA (Commercial)">10 KVA (Commercial)</option>
                                <option value="50 KVA (Industrial)">50 KVA (Industrial)</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        
                        <div class="col-md-12">
                            <label for="natureOfWork">Nature of Work</label>
                            <select class="form-control" id="natureOfWork">
                                <option value="">Select Nature of Work</option>
                                <option value="New Installation">New Installation</option>
                                <option value="Repair">Repair</option>
                                <option value="Maintenance">Maintenance</option>
                                <option value="Modification">Modification</option>
                                <option value="Temporary Service">Temporary Service</option>
                            </select>
                        </div>
                    </div>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Requirements</th>
                                <th>File</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Photocopy of Meralco Service Application</td>
                                <td class="file-column">
                                    <div class="upload-btn-wrapper" style="display: flex; align-items: center;">
                                        <div class="drag-drop-area" style="border: 1px dashed #ccc; padding: 10px; margin-right: 10px;" 
                                             ondrop="handleDrop(event, 'meralcoServiceFile')" ondragover="handleDragOver(event)">
                                            <p>Drag & drop file</p>
                                        </div>
                                        <button class="btn btn-upload" style="margin-left: 10px;" onclick="document.getElementById('meralcoServiceFile').click()">Upload</button>
                                        <input type="file" class="file-input" id="meralcoServiceFile" style="display: none;" onchange="uploadFile(this)">
                                        <div id="meralcoServiceFileName" class="file-column"></div> <!-- Display file details here -->
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td>Photocopy of Barangay Clearance</td>
                                <td class="file-column">
                                    <div class="upload-btn-wrapper" style="display: flex; align-items: center;">
                                        <div class="drag-drop-area" style="border: 1px dashed #ccc; padding: 10px; margin-right: 10px;" 
                                             ondrop="handleDrop(event, 'barangayClearanceFile')" ondragover="handleDragOver(event)">
                                            <p>Drag & drop file</p>
                                        </div>
                                        <button class="btn btn-upload" style="margin-left: 10px;" onclick="document.getElementById('barangayClearanceFile').click()">Upload</button>
                                        <input type="file" class="file-input" id="barangayClearanceFile" style="display: none;" onchange="uploadFile(this)">
                                        <div id="barangayClearanceFileName" class="file-column"></div> <!-- Display file details here -->
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td>Proof of Ownership</td>
                                <td class="file-column">
                                    <div class="upload-btn-wrapper" style="display: flex; align-items: center;">
                                        <div class="drag-drop-area" style="border: 1px dashed #ccc; padding: 10px; margin-right: 10px;" 
                                             ondrop="handleDrop(event, 'ownershipFile')" ondragover="handleDragOver(event)">
                                            <p>Drag & drop file</p>
                                        </div>
                                        <button class="btn btn-upload" style="margin-left: 10px;" onclick="document.getElementById('ownershipFile').click()">Upload</button>
                                        <input type="file" class="file-input" id="ownershipFile" style="display: none;" onchange="uploadFile(this)">
                                        <div id="ownershipFileName" class="file-column"></div> <!-- Display file details here -->
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td>Photocopy of Certificate of Occupancy-Building Permit</td>
                                <td class="file-column">
                                    <div class="upload-btn-wrapper" style="display: flex; align-items: center;">
                                        <div class="drag-drop-area" style="border: 1px dashed #ccc; padding: 10px; margin-right: 10px;" 
                                             ondrop="handleDrop(event, 'occupancyFile')" ondragover="handleDragOver(event)">
                                            <p>Drag & drop file</p>
                                        </div>
                                        <button class="btn btn-upload" style="margin-left: 10px;" onclick="document.getElementById('occupancyFile').click()">Upload</button>
                                        <input type="file" class="file-input" id="occupancyFile" style="display: none;" onchange="uploadFile(this)">
                                        <div id="occupancyFileName" class="file-column"></div> <!-- Display file details here -->
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td>Picture of Structure and Contact Number</td>
                                <td class="file-column">
                                    <div class="upload-btn-wrapper" style="display: flex; align-items: center;">
                                        <div class="drag-drop-area" style="border: 1px dashed #ccc; padding: 10px; margin-right: 10px;" 
                                             ondrop="handleDrop(event, 'structurePhotoFile')" ondragover="handleDragOver(event)">
                                            <p>Drag & drop file</p>
                                        </div>
                                        <button class="btn btn-upload" style="margin-left: 10px;" onclick="document.getElementById('structurePhotoFile').click()">Upload</button>
                                        <input type="file" class="file-input" id="structurePhotoFile" style="display: none;" onchange="uploadFile(this)">
                                        <div id="structurePhotoFileName" class="file-column"></div> <!-- Display file details here -->
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                        
                    </table>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="nextStepButton">Next</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Appointment Modal -->
    <div class="modal fade" id="appointmentModal" tabindex="-1" aria-labelledby="appointmentModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable wide-modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title fs-5" id="appointmentModalLabel">Appointment Schedule</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="step-progress mb-4">
                        <div class="step completed">
                            <div class="circle"></div>
                            <div class="label">Upload Requirements</div>
                        </div>
                        <div class="step completed">
                            <div class="circle"></div>
                            <div class="label">Appointment</div>
                        </div>
                    </div>
                    <!-- Appointment Form -->
                    <div class="container">
                        <div class="row justify-content-center">
                            <div class="col-md-6">
                                <label for="appointmentDate">Date</label>
                                <input type="date" class="form-control" id="appointmentDate">
                            </div>
                        </div>
                    </div>
                    
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-secondary" id="previousStepButton">Previous</button>
                    <button type="button" class="btn btn-primary" id="submitAppointment">Finish</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Application Applied Modal -->
<div class="modal fade" id="applicationAppliedModal" tabindex="-1" aria-labelledby="ApplicationAppliedModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="ApplicationAppliedModalLabel"><i class="fa-solid fa-check-circle"></i> Success</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body text-center">
                <h2>Application Submitted</h2>
                <i class="fa-solid fa-check-circle fa-3x text-success"></i>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<!-- Privacy Policy Modal for Electrical Inspection Permit -->
<div class="modal fade" id="privacyPolicyModal" tabindex="-1" aria-labelledby="privacyPolicyModalLabel" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog modal-dialog-centered wide-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="privacyPolicyModalLabel">Privacy Policy and Terms of Service</h5>
            </div>
            <div class="modal-body" id="privacyPolicyContent" style="max-height: 400px; overflow-y: auto;">
                <h5>Privacy Policy</h5>
                <p>We are committed to protecting your privacy. This privacy policy explains how we collect, use, and share your personal information when you apply for an electrical inspection permit through our system. By submitting your application, you consent to our privacy policy and the collection, use, and sharing of your information as described here.</p>

                <ul>
                    <li><b>Information Collection:</b> We collect personal data such as your name, address, contact information, and project specifics necessary for processing your electrical inspection permit application.</li>
                    <li><b>Use of Data:</b> The data collected is used to facilitate the application process, verify compliance, and communicate with you regarding the status of your application.</li>
                    <li><b>Data Sharing:</b> Your data will be shared only as needed with relevant authorities or as required by law for completing the inspection and approval process.</li>
                </ul>

                <h5>Terms and Conditions</h5>
                <p>By using this service, you agree to the following terms and conditions:</p>
                <ul>
                    <li>You will provide accurate and truthful information in your application.</li>
                    <li>You acknowledge that the electrical inspection process may require coordination with authorized inspectors and additional scheduling.</li>
                    <li>You agree to adhere to all fees, safety requirements, and legal standards necessary for the inspection.</li>
                    <li>Submitting false information may result in penalties or denial of the permit.</li>
                </ul>
            </div>
            <div class="modal-footer d-flex justify-content-between align-items-center">
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="termsCheckbox">
                    <label class="form-check-label" for="termsCheckbox">
                        I have read and agree to the Privacy Policy and Terms and Conditions
                    </label>
                </div>
                <div>
                    <a type="button" class="btn btn-secondary text-white me-2" href="clientApplication.html">Back</a>
                    <button type="button" class="btn btn-primary" id="acceptPolicyButton" disabled>Proceed</button>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

        <script src="/transition.js"></script>
<!-- Privacy Modal Initialization -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const privacyModalEl = document.getElementById('privacyPolicyModal');
        const privacyModal = privacyModalEl ? new bootstrap.Modal(privacyModalEl) : null;
        
        if (privacyModal) {
            console.log("Privacy modal initialized and shown");
            privacyModal.show();
        } else {
            console.error("Privacy modal element not found!");
        }
    });
</script>

<!-- Proceed Button Logic (Enable only when scrolled to bottom and checkbox is checked) -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const modalContent = document.getElementById('privacyPolicyContent');
        const acceptPolicyButton = document.getElementById('acceptPolicyButton');
        const termsCheckbox = document.getElementById('termsCheckbox');

        function updateProceedButton() {
            const isScrolledToBottom = modalContent.scrollTop + modalContent.clientHeight >= modalContent.scrollHeight - 5;
            const isCheckboxChecked = termsCheckbox?.checked;
            acceptPolicyButton.disabled = !(isScrolledToBottom && isCheckboxChecked);
        }

        if (modalContent && acceptPolicyButton && termsCheckbox) {
            modalContent.addEventListener('scroll', updateProceedButton);
            termsCheckbox.addEventListener('change', updateProceedButton);
            updateProceedButton();  // Initial check for button state
        }
    });
</script>

<!-- Proceed Action Script (Hide Privacy Modal, Show Electrical Inspection Modal) -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const privacyModalEl = document.getElementById('privacyPolicyModal');
        const acceptPolicyButton = document.getElementById('acceptPolicyButton');
        
        acceptPolicyButton.addEventListener('click', function () {
            console.log("Proceed button clicked");

            const privacyModalInstance = bootstrap.Modal.getInstance(privacyModalEl);
            if (privacyModalInstance) {
                privacyModalInstance.hide();
            } else {
                console.error("Failed to get privacy modal instance");
            }

            const electricalInspectionModalEl = document.getElementById('electricalInspectionModal');
            const electricalInspectionModal = electricalInspectionModalEl ? new bootstrap.Modal(electricalInspectionModalEl) : null;

            if (electricalInspectionModal) {
                console.log("Electrical inspection modal initialized and shown");
                electricalInspectionModal.show();
            } else {
                console.error("Electrical inspection modal element not found!");
            }
        });
    });
</script>
<script>
    document.addEventListener('DOMContentLoaded', () => {
    // Prevent dropdown from closing when clicking on buttons or notifications
    document.querySelectorAll('.dropdown-menu').forEach(dropdown => {
        dropdown.addEventListener('click', (event) => {
            if (event.target.closest('.btn') || event.target.closest('.client-notification')) {
                event.stopPropagation();
            }
        });
    });

    handleAuthState();
});

  </script>
<!-- Include Popper.js and Bootstrap.js before your custom scripts -->
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <!-- Firebase and custom scripts -->
    <script type="module" src="/Database/firebase.js"></script>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
        import { getFirestore, collection, addDoc, serverTimestamp, updateDoc, doc, getDocs, query, where, orderBy, limit, onSnapshot, startAfter } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
        import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-storage.js";
    
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBhvoPidRWGeJmnN2E11SBS5n8oyxVLJ0M",
            authDomain: "chsd-mis.firebaseapp.com",
            projectId: "chsd-mis",
            storageBucket: "chsd-mis.appspot.com",
            messagingSenderId: "694967679357",
            appId: "1:694967679357:web:65cffd50f13739f934f414",
            measurementId: "G-XBQTQFRLJ5"
        };
    
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const storage = getStorage(app);
    
        document.addEventListener('DOMContentLoaded', () => {
    let formSubmitted = false; // Variable to track submission status

    document.getElementById('submitAppointment').addEventListener('click', async (event) => {
        event.preventDefault();

        const submitButton = document.getElementById('submitAppointment');
        submitButton.disabled = true;

        const loadingScreen = document.getElementById('loading-screen');
        if (loadingScreen) {
            loadingScreen.style.display = 'flex';
        }

        // Collect input values
        const appointmentDate = document.getElementById('appointmentDate').value.trim();
        const ownerName = document.getElementById("ownerName").value;
        const light = document.getElementById("light").value;
        const switchType = document.getElementById("switch").value;
        const electricalMotor = document.getElementById("electricalMotor").value;
        const convOutlet = document.getElementById("convOutlet").value;
        const otherApparatus = document.getElementById("otherApparatus").value;
        const totalKVA = document.getElementById("totalKVA").value;
        const natureOfWork = document.getElementById("natureOfWork").value;

        const requiredFields = [
            { field: appointmentDate, name: 'Appointment Date' },
            { field: ownerName, name: 'Owner Name' }
        ];

        for (const { field, name } of requiredFields) {
            if (!field) {
                alert(`Please fill out the ${name} field.`);
                submitButton.disabled = false;
                return;
            }
        }

        // File inputs for Electrical Inspection
        const requiredFileInputs = [
            { id: 'meralcoServiceFile', namePrefix: 'meralcoService' },
            { id: 'barangayClearanceFile', namePrefix: 'barangayClearance' },
            { id: 'ownershipFile', namePrefix: 'ownership' },
            { id: 'occupancyFile', namePrefix: 'occupancy' },
            { id: 'structurePhotoFile', namePrefix: 'structurePhoto' }
        ];

        try {
            // Ensure the user is authenticated
            const user = await new Promise((resolve, reject) => {
                onAuthStateChanged(auth, user => {
                    if (user) {
                        resolve(user);
                    } else {
                        reject(new Error("No user is authenticated."));
                    }
                });
            });

            const userId = user.uid;

            // Prepare inspection data for Firestore
            const inspectionData = {
                appointmentDate: new Date(appointmentDate),
                ownerUid: userId,
                ownerName,
                light,
                switchType,
                electricalMotor,
                convOutlet,
                otherApparatus,
                totalKVA,
                natureOfWork,
                status: 'Pending',
                createdAt: serverTimestamp(),
            };

            // Add a new document to Firestore for Electrical Inspection
            const inspectionDocRef = await addDoc(collection(db, "ElectricalCert"), inspectionData);
            const inspectionId = inspectionDocRef.id;
            const storagePath = `ElectricalCert/${inspectionId}`;

            // Handle file uploads and storage
            const uploadPromises = requiredFileInputs.map(async fileInputObj => {
                const fileInput = document.getElementById(fileInputObj.id);
                if (fileInput && fileInput.files[0]) {
                    const file = fileInput.files[0];
                    const fileRef = ref(storage, `${storagePath}/${fileInputObj.namePrefix}_${file.name}`);
                    const snapshot = await uploadBytes(fileRef, file);
                    return getDownloadURL(snapshot.ref);
                } else {
                    console.error(`File input missing or undefined for ${fileInputObj.namePrefix}`);
                    return null;
                }
            });

            // Wait for all uploads and store URLs
            const fileURLs = await Promise.all(uploadPromises);

            const fileURLMapping = {
                meralcoServiceURL: fileURLs[0],
                barangayClearanceURL: fileURLs[1],
                ownershipURL: fileURLs[2],
                occupancyURL: fileURLs[3],
                structurePhotoURL: fileURLs[4],
            };

            // Update Firestore document with file URLs
            const inspectionDoc = doc(db, "ElectricalCert", inspectionId);
            await updateDoc(inspectionDoc, fileURLMapping);
            
            // Set formSubmitted to true after successful submission
            formSubmitted = true;

            Swal.fire({
                title: "Success!",
                text: "Application Submitted",
                icon: "success"
            }).then((result) => {
                if (result.isConfirmed) {
                    // Hide both modals after confirmation
                    const uploadModal = bootstrap.Modal.getInstance(document.getElementById('electricalInspectionModal'));
                    const appointmentModal = bootstrap.Modal.getInstance(document.getElementById('appointmentModal'));
                    
                    if (uploadModal) uploadModal.hide();
                    if (appointmentModal) appointmentModal.hide();
                }
            });

        } catch (error) {
            console.error("Error during submission:", error);
            alert(`Error submitting application: ${error.message}`);
        } finally {
            if (loadingScreen) {
                loadingScreen.style.display = 'none';
            }
            submitButton.disabled = false;
        }
    });

    // Handle step transitions with formSubmitted check
    const nextStepButton = document.getElementById('nextStepButton');
    const previousStepButton = document.getElementById('previousStepButton');
    const appointmentModal = new bootstrap.Modal(document.getElementById('appointmentModal'));
    const uploadModal = new bootstrap.Modal(document.getElementById('electricalInspectionModal'), {
        backdrop: 'static',
        keyboard: false
    });

    nextStepButton.addEventListener('click', function() {
        // Prevent further steps if form is submitted
        if (formSubmitted) return;

        const stepProgress = document.querySelector('.step-progress');
        const steps = stepProgress.querySelectorAll('.step');
        steps[0].classList.add('completed');
        steps[1].classList.add('completed');

        const bootstrapUploadModal = bootstrap.Modal.getInstance(document.getElementById('electricalInspectionModal'));
        bootstrapUploadModal.hide();
        setTimeout(() => appointmentModal.show(), 200);
    });

    previousStepButton.addEventListener('click', function() {
        if (formSubmitted) return;

        const stepProgress = document.querySelector('.step-progress');
        const steps = stepProgress.querySelectorAll('.step');
        steps[1].classList.remove('completed');

        const bootstrapAppointmentModal = bootstrap.Modal.getInstance(document.getElementById('appointmentModal'));
        bootstrapAppointmentModal.hide();
        setTimeout(() => uploadModal.show(), 200);
    });
});



    let notificationsPerPage = 5; // Number of notifications per page
    let currentPage = 1; // Track the current page
    let totalPages = 1; // Total pages based on the number of notifications
    let lastVisibleDoc = null; // Keep track of the last document for pagination

    // Function to load client notifications with pagination
    async function loadClientNotifications(userId) {
        const notificationsRef = collection(db, "notifications");
        const notificationContainer = document.getElementById("notification-container");

        const prevPageBtn = document.getElementById("prevPageBtn");
        const nextPageBtn = document.getElementById("nextPageBtn");
        const pageInfo = document.getElementById("pageInfo");

        // Fetch total notifications for user to calculate total pages
        const allNotificationsSnapshot = await getDocs(query(
            notificationsRef,
            where("userId", "==", userId)
        ));

        const totalNotifications = allNotificationsSnapshot.size;
        totalPages = Math.ceil(totalNotifications / notificationsPerPage);

        // Query notifications for the current page, ordered by timestamp
        let notificationsQuery = query(
            notificationsRef,
            where("userId", "==", userId),
            orderBy("timestamp", "desc"),
            limit(notificationsPerPage)
        );

        // If it's not the first page, start after the last visible document
        if (lastVisibleDoc && currentPage > 1) {
            notificationsQuery = query(notificationsQuery, startAfter(lastVisibleDoc));
        }

        onSnapshot(notificationsQuery, (snapshot) => {
            notificationContainer.innerHTML = ''; // Clear previous notifications

            if (snapshot.docs.length === 0) {
                notificationContainer.innerHTML = '<p>No notifications available.</p>';
            }

            snapshot.forEach(doc => {
                const data = doc.data();
                const notification = document.createElement('div');
                notification.className = 'client-notification';
                
                // Apply bold style for unread notifications
                if (!data.read) {
                    notification.style.fontWeight = 'bold';
                }
                
                // Make notification clickable
                notification.innerHTML = `${data.message} <br><small>${new Date(data.timestamp.seconds * 1000).toLocaleString()}</small>`;
                notification.style.cursor = 'pointer';

                notification.addEventListener('click', async () => {
                    // Mark the notification as read in Firestore
                    await updateDoc(doc.ref, {
                        read: true
                    });
                    
                    // Remove the bold style
                    notification.style.fontWeight = 'normal';

                    // Reload unread notifications to update the badge
                    fetchUnreadNotifications(userId);
                });

                notificationContainer.appendChild(notification);
            });

            // Track the last visible document for pagination
            lastVisibleDoc = snapshot.docs[snapshot.docs.length - 1];

            // Update page info
            pageInfo.textContent = `Page ${currentPage} of ${totalPages}`;

            // Disable/enable pagination buttons
            prevPageBtn.disabled = currentPage === 1;
            nextPageBtn.disabled = currentPage === totalPages;
        });
    }

    // Function to fetch unread notifications and update the badge
    async function fetchUnreadNotifications(userId) {
        const notificationsRef = collection(db, "notifications");

        const unreadNotificationsQuery = query(
            notificationsRef,
            where("userId", "==", userId),
            where("read", "==", false)
        );

        const unreadSnapshot = await getDocs(unreadNotificationsQuery);
        const unreadCount = unreadSnapshot.size;

        updateNotificationBadge(unreadCount); // Update the badge
    }

    // Function to update the notification badge
    function updateNotificationBadge(unreadCount) {
        const badgeElement = document.getElementById('notification-badge');
        if (unreadCount > 0) {
            badgeElement.style.display = 'inline-block'; // Show the badge
            badgeElement.textContent = unreadCount;      // Set the count
        } else {
            badgeElement.style.display = 'none';         // Hide the badge if no unread notifications
        }
    }

    // Function to handle authentication state
    function handleAuthState() {
        const prevPageBtn = document.getElementById("prevPageBtn");
        const nextPageBtn = document.getElementById("nextPageBtn");

        onAuthStateChanged(auth, (user) => {
            if (user) {
                // User is signed in, get user ID and load notifications
                const userId = user.uid;

                // Load initial notifications
                loadClientNotifications(userId);

                // Fetch unread notifications to update the badge
                fetchUnreadNotifications(userId);

                // Handle "Previous Page" button click
                prevPageBtn.addEventListener("click", () => {
                    if (currentPage > 1) {
                        currentPage--;
                        lastVisibleDoc = null; // Reset last visible document when going to the previous page
                        loadClientNotifications(userId);
                    }
                });

                // Handle "Next Page" button click
                nextPageBtn.addEventListener("click", () => {
                    if (currentPage < totalPages) {
                        currentPage++;
                        loadClientNotifications(userId);
                    }
                });
            } else {
                console.error("User is not signed in.");
            }
        });
    }

    // Start monitoring authentication state when the DOM is fully loaded
    document.addEventListener('DOMContentLoaded', () => {
        handleAuthState();
    });
    </script>
    
    

    <script>
        // Function to handle file upload
        function uploadFile(input, file = null) {
            const selectedFile = file || input.files[0];  // Use the file from input or passed as an argument
    
            if (selectedFile) {
                const maxSizeMB = 5;  // Set max file size (in MB)
                const allowedTypes = ['image/jpeg', 'image/png', 'application/pdf'];  // Allowed file types
    
                // Validate file type
                if (!allowedTypes.includes(selectedFile.type)) {
                    alert('Invalid file type. Please upload a JPG, PNG, or PDF file.');
                    input.value = '';  // Clear the input
                    return;
                }
    
                // Validate file size
                const maxSizeBytes = maxSizeMB * 1024 * 1024;  // Convert MB to bytes
                if (selectedFile.size > maxSizeBytes) {
                    alert(`File is too large. Please upload a file smaller than ${maxSizeMB}MB.`);
                    input.value = '';  // Clear the input
                    return;
                }
    
                // FileReader to read file details
                const reader = new FileReader();
                reader.onload = function () {
                    const fileName = selectedFile.name;
                    const fileSize = formatBytes(selectedFile.size);
                    const fileItem = `
                        <div class="file-item">
                            <span class="file-name">${fileName} (${fileSize})</span>
                            <span class="btn-delete" onclick="deleteFile(this, '${input.id}')">Delete</span>
                        </div>`;
    
                    // Display file information
                    const fileColumn = input.closest('.upload-btn-wrapper').querySelector('.file-column'); // Get the correct file column
                    if (fileColumn) {
                        fileColumn.insertAdjacentHTML('beforeend', fileItem);  // Append the file item
                    } else {
                        console.error('File column not found.');
                    }
                };
                reader.readAsDataURL(selectedFile);  // Read the file as a data URL
            }
        }
    
        // Function to delete the uploaded file
        function deleteFile(deleteBtn, inputId) {
            const fileItem = deleteBtn.closest('.file-item');
            if (fileItem) {
                fileItem.remove();  // Remove the displayed file item
                document.getElementById(inputId).value = '';  // Clear the input for re-upload
            }
        }
    
        // Format file size to a readable string
        function formatBytes(bytes, decimals = 2) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const dm = decimals < 0 ? 0 : decimals;
            const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i];
        }
    
        // Drag-over handler to show drag-and-drop action
        function handleDragOver(event) {
            event.preventDefault();
            event.stopPropagation();
            event.dataTransfer.dropEffect = 'copy';  // Change the cursor to indicate a drop is possible
        }
    
        // Drop handler to process the dropped files
        function handleDrop(event, inputId) {
            event.preventDefault();
            event.stopPropagation();
    
            const files = event.dataTransfer.files;  // Get the dropped files
            const inputFileElement = document.getElementById(inputId);  // Get the corresponding file input element
    
            if (inputFileElement && files.length > 0) {
                limitFiles(inputFileElement, 5, files);  // Limit the number of dropped files and handle each
            }
        }
    
        // Limit the number of files
        function limitFiles(input, maxFiles = 5, fileList = null) {
            const files = fileList || input.files;
            if (files.length > maxFiles) {
                alert(`You can only upload up to ${maxFiles} files.`);
                input.value = '';  // Clear the input
                return;
            }
    
            for (let i = 0; i < files.length; i++) {
                uploadFile(input, files[i]);  // Process each file
            }
        }
    </script>

<script>
    // Function to set the minimum date to tomorrow
    function setMinDate() {
        const today = new Date();
        const tomorrow = new Date(today);
        tomorrow.setDate(today.getDate() + 1); // Set to tomorrow

        const dd = String(tomorrow.getDate()).padStart(2, '0');
        const mm = String(tomorrow.getMonth() + 1).padStart(2, '0'); // January is 0!
        const yyyy = tomorrow.getFullYear();
        const minDate = yyyy + '-' + mm + '-' + dd; // Format as YYYY-MM-DD
        document.getElementById('appointmentDate').setAttribute('min', minDate);
    }

    // Function to disable weekends
    function disableWeekends() {
        const dateInput = document.getElementById('appointmentDate');
        dateInput.addEventListener('input', function () {
            const selectedDate = new Date(this.value);
            const day = selectedDate.getUTCDay();
            
            // Check if the selected day is Saturday (6) or Sunday (0)
            if (day === 6 || day === 0) {
                alert('Please select a weekday (Monday-Friday).');
                this.value = ''; // Clear the input if it's a weekend
            }
        });
    }

    setMinDate();
    disableWeekends();
</script>
  
    
</body>
</html>
