<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CHSD MIS</title>
    <link rel="stylesheet" href="/Stylesheets/style.css">
    <link rel="icon" href="/resources/pictures/chsd.png" type="image/x-icon">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
   
    <style>
        /* CSS for the content container */
        .content {
            flex: 1; /* Take remaining space */
            overflow: hidden; /* Hide overflow content */
            display: flex; /* Use flexbox */
            flex-direction: column; /* Column layout */
        }

        .content-container {
            overflow-y: auto; /* Enable vertical scrolling */
            padding: 20px; /* Add some padding */
        }

        .wide-modal {
            max-width: 80%;
        }

        .form-control {
            margin-bottom: 1rem; /* Add margin between form controls */
        }

        .form-check {
            margin-bottom: 0.5rem; /* Add margin between checkboxes */
        }

        .row.g-3 .col-md-6,
        .row.g-3 .col-md-4,
        .row.g-3 .col-md-12 {
            margin-bottom: 1rem; /* Add margin to columns */
        }

        .d-flex .me-2 {
            margin-right: 1rem; /* Add margin to the right of the input */
        }
        /* Highlight effect */
.highlight {
    background-color: #d3f9d8; /* light green */
    transition: background-color 1s ease-out; /* fades out smoothly */
}

    </style>
    <style>
        .btn-upload {
        padding: 8px 16px;
        background-color: #4CAF50 !important;
        color: white !important;
        border: none;
        cursor: pointer !important;
    }
    .btn-upload:hover {
        background-color: #45a049;
    }
    .file-item {
        display: flex;
        align-items: center;
    }
    .file-name {
        margin-right: 10px;
    }
    .btn-delete {
        color: red;
        cursor: pointer;
    }
        .content {
            flex: 1; 
            overflow: hidden; 
            display: flex;
            flex-direction: column; 
        }
    
        .content-container {
            overflow-y: auto; 
            padding: 20px; 
        }
    
        .wide-modal {
            max-width: 80%;
        }
        @media (max-width: 768px) {
    .wide-modal {
        max-width: 100% !important;
    }
}
    
        .form-control {
            margin-bottom: 1rem; 
        }
    
        .form-check {
            margin-bottom: 0.5rem; 
        }
    
        .row.g-3 .col-md-6,
        .row.g-3 .col-md-4,
        .row.g-3 .col-md-12 {
            margin-bottom: 1rem; 
        }
    
        .d-flex .me-2 {
            margin-right: 1rem; 
        }
        .upload-btn-wrapper {
            position: relative;
            overflow: hidden;
            display: inline-block;
        }
    
        .btn-upload {
            border: 2px solid #01b813;
            color: white;
            background-color: #007bff;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 14px;
            font-weight: bold;
        }
    
        .upload-btn-wrapper input[type=file] {
            font-size: 100px;
            position: absolute;
            left: 0;
            top: 0;
            opacity: 0;
        }
    
      
    </style>
</head>
<body>
    <div id="loading-screen" class="loading-screen" style="display: none;">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
    </div>

   
    <div class="main-container d-flex">
        <!--Sidebar-->
        <div class="sideNav" id="side_nav">
            <div class="container">
                <div class="header-box text-center px-2 pt-3 pb-4 ">
                    <button class="btn d-md-none d-block close-btn px-1 py-0 text-black"><i class="fa-solid fa-bars-staggered"></i></button>
                    <div class="avatar-placeholder">
                        <img id="client-avatar" src="" alt="loading..." width="100" height="100">
                    </div>
                    <div class="avatar-text">
                        <!-- Client ID and Name -->
                        <div id="user-name">loading...</div>
                    </div>
                </div>
            </div>
            <ul class="sideBarList list-unstyled px-2">
                <li class="sideNav"><a href="clientDashboard.html" class="text-decoration-none"><i class="fa-solid fa-circle-info"></i> Application Status</a></li>
                <li class="sideNav"><a href="clientRequirements.html" class="text-decoration-none"><i class="fa-solid fa-list"></i> Requirements List</a></li>
                <li class="sideNav dropdown open">
                    <a href="#" class="text-decoration-none"><i class="fa-solid fa-newspaper"></i> Application <i class="fas fa-caret-down"></i></a>
                    <ul class="submenu list-unstyled">
                        <li class="text-center mt-2"><a href="clientBuildingPermit.html" class="text-decoration-none">Building Permit</a></li>
                        <li class="text-center mt-2 active"><a href="clientOccupancyApplication.html" class="text-decoration-none">Occupancy</a></li>
                        <li class="text-center mt-2"><a href="clientElectricalApplication.html" class="text-decoration-none">Electrical Inspection</a></li>
                        <li class="text-center mt-2"><a href="clientHousingApplication.html" class="text-decoration-none">Housing</a></li>
                    </ul>
                </li>
                <li class="sideNav"><a href="clientProfile.html" class="text-decoration-none"><i class="fa-solid fa-gear"></i> Settings</a></li>
                
                <li class="sideNav" id="user-logout-btn"><a href="#" class="text-decoration-none"><i class="fa-solid fa-right-from-bracket"></i> Log out</a></li>
            </ul>
        </div>

        <div class="content">
            <nav class="navigationBar navbar navbar-expand-lg bg-light">
                <div class="container-fluid">
                    <!-- Mobile View -->
                    <div class="d-flex justify-content-between d-md-none d-block">
                        <a class="navbar-brand d-flex align-items-center" href="#">
                            <img src="/resources/pictures/chsd.png" alt="CHSD" width="40" height="40" class="me-2">
                            <h5 class="mb-0 fs-5">CHSD</h5>
                        </a>
                        <button class="btn px-1 py-0 open-btn">
                            <i class="fa-solid fa-bars-staggered"></i>
                        </button>
                    </div>
            
                    <!-- Desktop View -->
                    <div class="collapse navbar-collapse d-none d-md-flex" id="navbarSupportedContent">
                        <a class="navbar-brand d-flex align-items-center" href="#">
                            <img src="/resources/pictures/chsd.png" alt="CHSD" width="75" height="75" class="me-2">
                            <h5 class="mb-0 fs-5 fs-lg-4">City Housing and Settlements Department</h5>
                        </a>
            
                                   <!-- Right-aligned content: Notifications -->
<ul class="navbar-nav ms-auto">
    <!-- Notifications Dropdown -->
    <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
            <i class="fa-solid fa-bell"></i>
            <span id="notification-badge" class="badge bg-danger" style="display: none;">0</span>
        </a>
        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdown" style="width: 500px; padding: 15px; max-height: 500px; overflow-y: auto;">
            <li>
                <h6 class="dropdown-header">Notifications</h6>
            </li>
            <li>
                <div class="notifications-container" id="notification-container" style="max-height: 400px; overflow-y: auto; overflow-x: hidden;">
                    <!-- Notifications will be dynamically added here -->
                </div>
            </li>
            <li>
                <div class="dropdown-item text-center">
                    <button id="prevPageBtn" class="btn btn-secondary btn-sm">Previous</button>
                    <span id="pageInfo">Page 1</span>
                    <button id="nextPageBtn" class="btn btn-secondary btn-sm">Next</button>
                </div>
            </li>
        </ul>
    </li>
</ul>

                    </div>
                </div>
            </nav>

            <div class="contentContainer">
                <div class="card text-center">
                    <div class="card-body">
                        <h5 class="card-title">Start Your Application</h5>
                        <p class="card-text">Click the button below to apply for a Occupancy Permit.</p>
                        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#occupancyUploadModal">Apply</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Certificate of Occupancy Upload Modal -->
<div class="modal fade" id="occupancyUploadModal" tabindex="-1" aria-labelledby="occupancyUploadModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable wide-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="occupancyUploadModalLabel">Certificate of Occupancy Application</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <!-- Step Progress Bar -->
                <div class="step-progress mb-4">
                    <div class="step completed">
                        <div class="circle"></div>
                        <div class="label">Upload Requirements</div>
                    </div>
                    <div class="step">
                        <div class="circle"></div>
                        <div class="label">Appointment</div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-4">
                        <label for="buildingPermitOption">Building Permit Option</label>
                        
                        <!-- Toggle Buttons for Selection -->
                        <div class="btn-group d-flex" role="group">
                            <input type="radio" class="btn-check" name="permitOption" id="typeOption" autocomplete="off" checked>
                            <label class="btn btn-outline-secondary flex-fill" for="typeOption">Type Permit No.</label>
                
                            <input type="radio" class="btn-check" name="permitOption" id="selectOption" autocomplete="off">
                            <label class="btn btn-outline-secondary flex-fill" for="selectOption">Select Permit</label>
                        </div>
                
                        <!-- Dynamic Instructional Text -->
                        <small id="instructionText" class="form-text text-muted mt-2">
                            Please type the Building Permit Number.
                        </small>
                
                        <!-- Input for Typing Permit Number -->
                        <div id="permitInputContainer" class="mt-2">
                            <input type="text" id="buildingPermitNo" class="form-control" placeholder="ex. 2024-XXXX">
                        </div>
                
                        <!-- Button for Selecting Permit from Modal -->
                        <div id="permitSelectContainer" class="mt-2 d-none">
                            <button type="button" id="openPermitModalBtn" class="btn btn-outline-secondary w-100">Select Permit from List</button>
                        </div>
                
                        <!-- Readonly Display of Selected Permit Number -->
                        <div id="selectedPermitDisplay" class="mt-2 d-none">
                            <input type="text" id="selectedPermitNumber" class="form-control" readonly>
                            <small class="form-text text-muted">Selected Permit Number</small>
                        </div>
                    </div>
                </div>
                
                
                <div class="row">
                    <label for="ownerName">Owner/Applicant Name:</label>
                    <input type="text" class="form-control" id="ownerName" placeholder="Enter Name">
                </div>

                <div class="row">
                    <div class="col-md-8">
                        <label for="ownerAddress">Address of Owner</label>
                        <input type="text" class="form-control" id="ownerAddress">
                    </div>
                        
                </div>
                <div class="row">
                    <div class="col-md-8">
                        <label for="projectLocation">Location of the Project</label>
                    <input type="text" class="form-control" id="projectLocation">
                    </div>
                    
                 </div>
                 <div class="container">
                    <div class="form-group">
                        <label for="NOUnits">Number of Units<span class="required-asterisk">*</span></label>
                        <select class="form-control" id="NOUnits">
                            <option value="1" selected>1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                        </select>
                    </div>
                    <div id="unitFieldsContainer"></div>
                    <div class="row">
                        <div class="col">
                            <label for="TotalFloorArea">Total Floor Area</label>
                            <input type="number" class="form-control" id="TotalFloorArea" readonly>
                        </div>
                        <div class="col">
                            <label for="TotalEstimatedCost">Total Estimated Cost</label>
                            <input type="number" class="form-control" id="TotalEstimatedCost" disabled>
                        </div>
                    </div>
                </div>
                
                <!-- Content -->
                <table class="table">
                    <thead>
                        <tr>
                            <th>Requirements</th>
                            <th>File</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Duly Accomplished Certificate of Building Permit Completion Form</td>
                            <td class="file-column">
                                <div class="upload-btn-wrapper" style="display: flex; align-items: center;">
                                    <div class="drag-drop-area" style="border: 1px dashed #ccc; padding: 10px; margin-right: 10px;" 
                                         ondrop="handleDrop(event, 'buildingPermitCompletionFile')" ondragover="handleDragOver(event)">
                                        <p>Drag & drop file</p>
                                    </div>
                                    <button class="btn btn-upload" style="margin-left: 10px;" onclick="document.getElementById('buildingPermitCompletionFile').click()">Upload</button>
                                    <input type="file" class="file-input" id="buildingPermitCompletionFile" style="display: none;" onchange="uploadFile(this)">
                                    <div id="buildingPermitCompletionFileName" class="file-column"></div> <!-- Display file details here -->
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td>Photocopy of Approved Building Permit Form</td>
                            <td class="file-column">
                                <div class="upload-btn-wrapper" style="display: flex; align-items: center;">
                                    <div class="drag-drop-area" style="border: 1px dashed #ccc; padding: 10px; margin-right: 10px;" 
                                         ondrop="handleDrop(event, 'approvedBuildingPermitFile')" ondragover="handleDragOver(event)">
                                        <p>Drag & drop file</p>
                                    </div>
                                    <button class="btn btn-upload" style="margin-left: 10px;" onclick="document.getElementById('approvedBuildingPermitFile').click()">Upload</button>
                                    <input type="file" class="file-input" id="approvedBuildingPermitFile" style="display: none;" onchange="uploadFile(this)">
                                    <div id="approvedBuildingPermitFileName" class="file-column"></div> <!-- Display file details here -->
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td>Photocopy of Approved Plan</td>
                            <td class="file-column">
                                <div class="upload-btn-wrapper" style="display: flex; align-items: center;">
                                    <div class="drag-drop-area" style="border: 1px dashed #ccc; padding: 10px; margin-right: 10px;" 
                                         ondrop="handleDrop(event, 'approvedPlanFile')" ondragover="handleDragOver(event)">
                                        <p>Drag & drop file</p>
                                    </div>
                                    <button class="btn btn-upload" style="margin-left: 10px;" onclick="document.getElementById('approvedPlanFile').click()">Upload</button>
                                    <input type="file" class="file-input" id="approvedPlanFile" style="display: none;" onchange="uploadFile(this)">
                                    <div id="approvedPlanFileName" class="file-column"></div> <!-- Display file details here -->
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td>Photos of Structure (Front, Back, Left, Right, Lavatory, and CR)</td>
                            <td class="file-column">
                                <div class="upload-btn-wrapper" style="display: flex; align-items: center;">
                                    <div class="drag-drop-area" style="border: 1px dashed #ccc; padding: 10px; margin-right: 10px;" 
                                         ondrop="handleDrop(event, 'structurePhotosFile')" ondragover="handleDragOver(event)">
                                        <p>Drag & drop file</p>
                                    </div>
                                    <button class="btn btn-upload" style="margin-left: 10px;" onclick="document.getElementById('structurePhotosFile').click()">Upload</button>
                                    <input type="file" class="file-input" id="structurePhotosFile" style="display: none;" onchange="uploadFile(this)">
                                    <div id="structurePhotosFileName" class="file-column"></div> <!-- Display file details here -->
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td>Sketch of Location and Contact Number</td>
                            <td class="file-column">
                                <div class="upload-btn-wrapper" style="display: flex; align-items: center;">
                                    <div class="drag-drop-area" style="border: 1px dashed #ccc; padding: 10px; margin-right: 10px;" 
                                         ondrop="handleDrop(event, 'sketchFile')" ondragover="handleDragOver(event)">
                                        <p>Drag & drop file</p>
                                    </div>
                                    <button class="btn btn-upload" style="margin-left: 10px;" onclick="document.getElementById('sketchFile').click()">Upload</button>
                                    <input type="file" class="file-input" id="sketchFile" style="display: none;" onchange="uploadFile(this)">
                                    <div id="sketchFileName" class="file-column"></div> <!-- Display file details here -->
                                </div>
                            </td>
                        </tr>
                    </tbody>
                    
                    
                </table>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="nextStepButton">Next</button>
            </div>
        </div>
    </div>
</div>

<div class="modal" id="permitSelectionModal" tabindex="-1" aria-hidden="true" style="display: none;">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Select Building Permit</h5>
                <button type="button" id="closePermitModalBtn" class="btn-close"></button>
            </div>
            <div class="modal-body">
                <ul id="permitList" class="list-group">
                    <!-- Building permits will be loaded here dynamically -->
                </ul>
            </div>
            <div class="modal-footer">
                <button type="button" id="closeModalFooterBtn" class="btn btn-secondary">Close</button>
            </div>
        </div>
    </div>
</div>

<!-- Appointment Modal -->
<div class="modal fade" id="appointmentModal" tabindex="-1" aria-labelledby="appointmentModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable wide-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title fs-5" id="appointmentModalLabel">Appointment Schedule</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <!-- Step Progress Bar -->
                <div class="step-progress mb-4">
                    <div class="step completed">
                        <div class="circle"></div>
                        <div class="label">Upload Requirements</div>
                    </div>
                    <div class="step completed">
                        <div class="circle"></div>
                        <div class="label">Appointment</div>
                    </div>
                </div>
                <div class="container">
                    <h5 class="text-center mt-5 mb-4">Appointment Schedule</h5>
                    <div class="row justify-content-center">
                        <div class="col-md-6">
                            <label for="appointmentDate">Date</label>
                            <input type="date" class="form-control" id="appointmentDate">
                        </div>
                    </div>
                </div>
                
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-secondary" id="previousStepButton">Previous</button>
                <button type="button" class="btn btn-primary" id="submitAppointment">Finish</button>
            </div>
        </div>
    </div>
</div>




<!-- Privacy Policy Modal for Occupancy Permit -->
<div class="modal fade" id="privacyPolicyModal" tabindex="-1" aria-labelledby="privacyPolicyModalLabel" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog modal-dialog-centered wide-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="privacyPolicyModalLabel">Privacy Policy and Terms of Service</h5>
            </div>
            <div class="modal-body" id="privacyPolicyContent" style="max-height: 400px; overflow-y: auto;">
                <h5>Privacy Policy</h5>
                <p>We are committed to protecting your privacy. This privacy policy explains how we collect, use, and share your personal information when you apply for an occupancy permit through our system. By submitting your application, you consent to our privacy policy and the collection, use, and sharing of your information as described here.</p>

                <ul>
                    <li><b>Information Collection:</b> We collect personal data such as your name, address, contact information, and project details solely to process your occupancy permit application.</li>
                    <li><b>Use of Data:</b> The collected data is used to process your application, communicate with you, and keep you updated on your application's status.</li>
                    <li><b>Data Sharing:</b> Your data will not be shared with third parties except where required by law or necessary to complete the application process.</li>
                </ul>

                <h5>Terms and Conditions</h5>
                <p>By using this service, you agree to the following terms and conditions:</p>
                <ul>
                    <li>You will provide accurate and truthful information in your application.</li>
                    <li>You understand that the processing of your occupancy permit may take several days depending on the complexity of your application.</li>
                    <li>You are responsible for any fees or charges associated with your application.</li>
                    <li>Any attempt to provide fraudulent information may result in legal consequences.</li>
                </ul>
            </div>
            <div class="modal-footer d-flex justify-content-between align-items-center">
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="termsCheckbox">
                    <label class="form-check-label" for="termsCheckbox">
                        I have read and agree to the Privacy Policy and Terms and Conditions
                    </label>
                </div>
                <div>
                    <a type="button" class="btn btn-secondary text-white me-2" href="clientApplication.html">Back</a>
                    <button type="button" class="btn btn-primary" id="acceptPolicyButton" disabled>Proceed</button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Select form elements
const NOUnitsInput = document.getElementById("NOUnits");
const unitFieldsContainer = document.getElementById("unitFieldsContainer");
const totalFloorAreaInput = document.getElementById("TotalFloorArea");
const totalEstimatedCostInput = document.getElementById("TotalEstimatedCost");

// Initialize the form with 1 unit field displayed by default
function initializeUnitFields() {
    const initialNumUnits = parseInt(NOUnitsInput.value) || 1;
    generateUnitFields(initialNumUnits);
    updateTotals();
}

// Function to generate dynamic fields for each unit
function generateUnitFields(numUnits) {
    // Clear existing unit fields
    unitFieldsContainer.innerHTML = "";

    for (let i = 1; i <= numUnits; i++) {
        const unitDiv = document.createElement("div");
        unitDiv.className = "row mb-3";

        unitDiv.innerHTML = `
            <div class="col">
                <label for="BlockNumber${i}">Block Number for Unit ${i}</label>
                <input type="text" class="form-control" id="BlockNumber${i}" placeholder="Block Number">
            </div>
            <div class="col">
                <label for="LotNumber${i}">Lot Number for Unit ${i}</label>
                <input type="text" class="form-control" id="LotNumber${i}" placeholder="Lot Number">
            </div>
            <div class="col">
                <label for="NOStorey${i}">Number of Storeys for Unit ${i}</label>
                <input type="number" class="form-control" id="NOStorey${i}" placeholder="Number of Storeys">
            </div>
            <div class="col">
                <label for="UnitFloorArea${i}">Floor Area for Unit ${i} (sqm)</label>
                <input type="number" class="form-control unit-floor-area" id="UnitFloorArea${i}" placeholder="Floor Area" required>
            </div>
        `;
        unitFieldsContainer.appendChild(unitDiv);
    }
}

// Event listener for changes in the Number of Units dropdown
NOUnitsInput.addEventListener("change", function () {
    const numUnits = parseInt(NOUnitsInput.value) || 0;
    generateUnitFields(numUnits);
    updateTotals();
});

// Function to calculate total floor area and estimated cost
function updateTotals() {
    const floorAreaInputs = document.querySelectorAll(".unit-floor-area");
    let totalFloorArea = 0;

    // Sum up all floor areas
    floorAreaInputs.forEach(input => {
        const floorArea = parseFloat(input.value) || 0;
        totalFloorArea += floorArea;
    });

    // Update total floor area and estimated cost
    totalFloorAreaInput.value = totalFloorArea.toFixed(2); // Optional: Fix to 2 decimal places
    totalEstimatedCostInput.value = (totalFloorArea * 10000).toFixed(2); // Assuming cost = floor area * 10,000
}

// Event listener for changes in any floor area input
unitFieldsContainer.addEventListener("input", function (event) {
    if (event.target.classList.contains("unit-floor-area")) {
        updateTotals();
    }
});

// Initialize the form on page load
initializeUnitFields();

</script>
<script>
    // Disable the "Proceed" button until the user scrolls to the bottom and checks the checkbox
    const modalContent = document.getElementById('privacyPolicyContent');
    const acceptPolicyButton = document.getElementById('acceptPolicyButton');
    const termsCheckbox = document.getElementById('termsCheckbox');

    function updateProceedButton() {
        // Allow a 5-pixel margin for easier detection near the bottom
        const isScrolledToBottom = modalContent.scrollTop + modalContent.clientHeight >= modalContent.scrollHeight - 5;
        const isCheckboxChecked = termsCheckbox.checked;
        acceptPolicyButton.disabled = !(isScrolledToBottom && isCheckboxChecked);
    }

    // Add scroll event listener to check if the user has scrolled to the bottom
    modalContent.addEventListener('scroll', updateProceedButton);

    // Add change event listener for checkbox
    termsCheckbox.addEventListener('change', updateProceedButton);
</script>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Show the privacy policy modal every time the page is loaded
        const privacyModalEl = document.getElementById('privacyPolicyModal');
        const privacyModal = privacyModalEl ? new bootstrap.Modal(privacyModalEl) : null;
        
        if (privacyModal) {
            console.log("Privacy modal initialized and shown");
            privacyModal.show();
        } else {
            console.error("Privacy modal element not found!");
        }

        // Handle the "Proceed" button click for privacy modal
        document.getElementById('acceptPolicyButton').addEventListener('click', function () {
            console.log("Proceed button clicked");

            // Hide the privacy policy modal
            const privacyModalInstance = bootstrap.Modal.getInstance(privacyModalEl);
            if (privacyModalInstance) {
                privacyModalInstance.hide();
            } else {
                console.error("Failed to get privacy modal instance");
            }

            // Show the occupancy upload modal
            const occupancyUploadModalEl = document.getElementById('occupancyUploadModal');
            const occupancyUploadModal = occupancyUploadModalEl ? new bootstrap.Modal(occupancyUploadModalEl) : null;

            if (occupancyUploadModal) {
                console.log("Occupancy upload modal initialized and shown");
                occupancyUploadModal.show();
            } else {
                console.error("Occupancy upload modal element not found!");
            }
        });
    });
</script>

    
    
<script>
    const instructionText = document.getElementById("instructionText");
document.getElementById("typeOption").addEventListener("change", function() {
    document.getElementById("permitInputContainer").classList.remove("d-none");
    document.getElementById("permitSelectContainer").classList.add("d-none");
    instructionText.textContent = "Please type the Building Permit Number.";
});

document.getElementById("selectOption").addEventListener("change", function() {
    document.getElementById("permitInputContainer").classList.add("d-none");
    document.getElementById("permitSelectContainer").classList.remove("d-none");
    instructionText.textContent = "Please select a Building Permit from the list.";
});

</script>

<script>
    document.addEventListener('DOMContentLoaded', () => {
    // Prevent dropdown from closing when clicking on buttons or notifications
    document.querySelectorAll('.dropdown-menu').forEach(dropdown => {
        dropdown.addEventListener('click', (event) => {
            if (event.target.closest('.btn') || event.target.closest('.client-notification')) {
                event.stopPropagation();
            }
        });
    });

    handleAuthState();
});

  </script>

    <!-- Firebase and custom scripts -->
    <script type="module" src="/Database/firebase.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <!-- Bootstrap and other scripts -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.min.js" integrity="sha384-cuYeSxntonz0PPNlHhBs68uyIAVpIIOZZ5JqeqvYYIcEL727kskC66kF92t6Xl2V" crossorigin="anonymous"></script>
    <script src="/ClientPages/navBarScript.js"></script>
    
    <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { getFirestore, collection, addDoc, serverTimestamp, updateDoc, doc, getDocs, limit, orderBy, onSnapshot, query, where, startAfter, getDoc} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-storage.js";

// Firebase configuration object
const firebaseConfig = {
    apiKey: "AIzaSyBhvoPidRWGeJmnN2E11SBS5n8oyxVLJ0M",
    authDomain: "chsd-mis.firebaseapp.com",
    projectId: "chsd-mis",
    storageBucket: "chsd-mis.appspot.com",
    messagingSenderId: "694967679357",
    appId: "1:694967679357:web:65cffd50f13739f934f414",
    measurementId: "G-XBQTQFRLJ5"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
const storage = getStorage(app);

// Document Ready
document.addEventListener('DOMContentLoaded', () => {
    document.getElementById('submitAppointment').addEventListener('click', async (event) => {
        event.preventDefault();

        const submitButton = document.getElementById('submitAppointment');
        submitButton.disabled = true;

        const loadingScreen = document.getElementById('loading-screen');
        if (loadingScreen) {
            loadingScreen.style.display = 'flex';
        }

        // Collect static input values
        const appointmentDate = document.getElementById('appointmentDate').value.trim();
        const ownerName = document.getElementById("ownerName").value;
        const ownerAddress = document.getElementById("ownerAddress").value;
        const projectLocation = document.getElementById("projectLocation").value;
        const buildingPermitNo = document.getElementById("buildingPermitNo").value;

        // Collect dynamic fields (Units Data)
        const numUnits = parseInt(document.getElementById("NOUnits").value) || 0;
        const unitsData = [];
        for (let i = 1; i <= numUnits; i++) {
            const blockNumber = document.getElementById(`BlockNumber${i}`)?.value.trim();
            const lotNumber = document.getElementById(`LotNumber${i}`)?.value.trim();
            const NOStorey = document.getElementById(`NOStorey${i}`)?.value.trim();
            const floorArea = document.getElementById(`UnitFloorArea${i}`)?.value.trim();

            // Validate fields for each unit
            if (!blockNumber || !lotNumber || !NOStorey || !floorArea) {
                alert(`Please fill out all fields for Unit ${i}.`);
                submitButton.disabled = false;
                loadingScreen.style.display = 'none';
                return;
            }

            unitsData.push({
                blockNumber,
                lotNumber,
                NOStorey: parseInt(NOStorey),
                floorArea: parseFloat(floorArea)
            });
        }

        // Calculate total floor area
        const totalFloorArea = unitsData.reduce((sum, unit) => sum + unit.floorArea, 0);

        // Required static fields validation
        const requiredFields = [
            { field: appointmentDate, name: 'Appointment Date' },
            { field: ownerName, name: 'Owner Name' }
        ];
        for (const { field, name } of requiredFields) {
            if (!field) {
                alert(`Please fill out the ${name} field.`);
                submitButton.disabled = false;
                loadingScreen.style.display = 'none';
                return;
            }
        }

        // Validate file uploads
        const requiredFileInputs = [
            { id: 'buildingPermitCompletionFile', namePrefix: 'buildingPermitCompletion', name: 'Building Permit Completion' },
            { id: 'approvedBuildingPermitFile', namePrefix: 'approvedBuildingPermit', name: 'Approved Building Permit' },
            { id: 'approvedPlanFile', namePrefix: 'approvedPlan', name: 'Approved Plan' },
            { id: 'structurePhotosFile', namePrefix: 'structurePhotos', name: 'Structure Photos' },
            { id: 'sketchFile', namePrefix: 'sketch', name: 'Sketch' }
        ];
        for (const fileInputObj of requiredFileInputs) {
            const fileInput = document.getElementById(fileInputObj.id);
            if (!fileInput || !fileInput.files[0]) {
                alert(`Please upload the ${fileInputObj.name} file.`);
                submitButton.disabled = false;
                loadingScreen.style.display = 'none';
                return;
            }
        }

        try {
            // Ensure user is authenticated
            const user = await new Promise((resolve, reject) => {
                onAuthStateChanged(auth, user => {
                    if (user) resolve(user);
                    else reject(new Error("No user is authenticated."));
                });
            });

            const userId = user.uid;

            // Prepare permit data for Firestore
            const permitData = {
                appointmentDate: new Date(appointmentDate),
                ownerUid: userId,
                ownerName,
                projectLocation,
                buildingPermitNo,
                ownerAddress,
                totalFloorArea,
                numUnits,
                unitsData, // Save the dynamic data
                status: 'Pending',
                createdAt: serverTimestamp(),
            };

            // Add a new document to Firestore and get the generated document ID
            const permitDocRef = await addDoc(collection(db, "OccupancyPermits"), permitData);
            const permitId = permitDocRef.id;
            const storagePath = `OccupancyPermits/${permitId}`;

            // Handle file uploads
            const uploadPromises = requiredFileInputs.map(async fileInputObj => {
                const fileInput = document.getElementById(fileInputObj.id);
                if (fileInput && fileInput.files[0]) {
                    const file = fileInput.files[0];
                    const fileRef = ref(storage, `${storagePath}/${fileInputObj.namePrefix}_${file.name}`);
                    const snapshot = await uploadBytes(fileRef, file);
                    return getDownloadURL(snapshot.ref);
                } else {
                    console.error(`File input missing or undefined for ${fileInputObj.namePrefix}`);
                    return null;
                }
            });

            // Wait for all uploads and store URLs
            const fileURLs = await Promise.all(uploadPromises);

            const fileURLMapping = {
                buildingPermitCompletionURL: fileURLs[0],
                approvedBuildingPermitURL: fileURLs[1],
                approvedPlanURL: fileURLs[2],
                structurePhotosURL: fileURLs[3],
                sketchURL: fileURLs[4],
            };

            // Update Firestore document with file URLs
            const permitDoc = doc(db, "OccupancyPermits", permitId);
            await updateDoc(permitDoc, fileURLMapping);

            // Success feedback
            Swal.fire({
                title: "Success!",
                text: "Application Submitted",
                icon: "success"
            });
            logFirestoreChanges("OccupancyPermits", permitId);

        } catch (error) {
            // Handle errors
            console.error("Error during submission:", error);
            alert(`Error submitting application: ${error.message}`);
        } finally {
            // Reset loading and submit button
            if (loadingScreen) {
                loadingScreen.style.display = 'none';
            }
            submitButton.disabled = false;
        }
    });
});


    // Handle step transitions
    document.addEventListener("DOMContentLoaded", function() {
        const nextStepButton = document.getElementById('nextStepButton');
        const previousStepButton = document.getElementById('previousStepButton');
        const appointmentModal = new bootstrap.Modal(document.getElementById('appointmentModal'));
        const uploadModal = new bootstrap.Modal(document.getElementById('occupancyUploadModal'), {
            backdrop: 'static',
            keyboard: false
        });

        nextStepButton.addEventListener('click', function() {
            // Update the progress bar
            const stepProgress = document.querySelector('.step-progress');
            const steps = stepProgress.querySelectorAll('.step');
            steps[0].classList.add('completed');
            steps[1].classList.add('completed');

            // Hide upload modal and show appointment modal with smooth transition
            const bootstrapUploadModal = bootstrap.Modal.getInstance(document.getElementById('occupancyUploadModal'));
            bootstrapUploadModal.hide();
            setTimeout(() => appointmentModal.show(), 200);  // Add delay for smooth transition
        });

        previousStepButton.addEventListener('click', function() {
            // Update the progress bar to revert the step
            const stepProgress = document.querySelector('.step-progress');
            const steps = stepProgress.querySelectorAll('.step');
            steps[1].classList.remove('completed');

            // Hide appointment modal and show upload modal
            const bootstrapAppointmentModal = bootstrap.Modal.getInstance(document.getElementById('appointmentModal'));
            bootstrapAppointmentModal.hide();
            setTimeout(() => uploadModal.show(), 200);  // Add delay for smooth transition
        });
    });

    let notificationsPerPage = 5; // Number of notifications per page
    let currentPage = 1; // Track the current page
    let totalPages = 1; // Total pages based on the number of notifications
    let lastVisibleDoc = null; // Keep track of the last document for pagination

    // Function to load client notifications with pagination
    async function loadClientNotifications(userId) {
        const notificationsRef = collection(db, "notifications");
        const notificationContainer = document.getElementById("notification-container");

        const prevPageBtn = document.getElementById("prevPageBtn");
        const nextPageBtn = document.getElementById("nextPageBtn");
        const pageInfo = document.getElementById("pageInfo");

        // Fetch total notifications for user to calculate total pages
        const allNotificationsSnapshot = await getDocs(query(
            notificationsRef,
            where("userId", "==", userId)
        ));

        const totalNotifications = allNotificationsSnapshot.size;
        totalPages = Math.ceil(totalNotifications / notificationsPerPage);

        // Query notifications for the current page, ordered by timestamp
        let notificationsQuery = query(
            notificationsRef,
            where("userId", "==", userId),
            orderBy("timestamp", "desc"),
            limit(notificationsPerPage)
        );

        // If it's not the first page, start after the last visible document
        if (lastVisibleDoc && currentPage > 1) {
            notificationsQuery = query(notificationsQuery, startAfter(lastVisibleDoc));
        }

        onSnapshot(notificationsQuery, (snapshot) => {
            notificationContainer.innerHTML = ''; // Clear previous notifications

            if (snapshot.docs.length === 0) {
                notificationContainer.innerHTML = '<p>No notifications available.</p>';
            }

            snapshot.forEach(doc => {
                const data = doc.data();
                const notification = document.createElement('div');
                notification.className = 'client-notification';
                
                // Apply bold style for unread notifications
                if (!data.read) {
                    notification.style.fontWeight = 'bold';
                }
                
                // Make notification clickable
                notification.innerHTML = `${data.message} <br><small>${new Date(data.timestamp.seconds * 1000).toLocaleString()}</small>`;
                notification.style.cursor = 'pointer';

                notification.addEventListener('click', async () => {
                    // Mark the notification as read in Firestore
                    await updateDoc(doc.ref, {
                        read: true
                    });
                    
                    // Remove the bold style
                    notification.style.fontWeight = 'normal';

                    // Reload unread notifications to update the badge
                    fetchUnreadNotifications(userId);
                });

                notificationContainer.appendChild(notification);
            });

            // Track the last visible document for pagination
            lastVisibleDoc = snapshot.docs[snapshot.docs.length - 1];

            // Update page info
            pageInfo.textContent = `Page ${currentPage} of ${totalPages}`;

            // Disable/enable pagination buttons
            prevPageBtn.disabled = currentPage === 1;
            nextPageBtn.disabled = currentPage === totalPages;
        });
    }

    // Function to fetch unread notifications and update the badge
    async function fetchUnreadNotifications(userId) {
        const notificationsRef = collection(db, "notifications");

        const unreadNotificationsQuery = query(
            notificationsRef,
            where("userId", "==", userId),
            where("read", "==", false)
        );

        const unreadSnapshot = await getDocs(unreadNotificationsQuery);
        const unreadCount = unreadSnapshot.size;

        updateNotificationBadge(unreadCount); // Update the badge
    }

    // Function to update the notification badge
    function updateNotificationBadge(unreadCount) {
        const badgeElement = document.getElementById('notification-badge');
        if (unreadCount > 0) {
            badgeElement.style.display = 'inline-block'; // Show the badge
            badgeElement.textContent = unreadCount;      // Set the count
        } else {
            badgeElement.style.display = 'none';         // Hide the badge if no unread notifications
        }
    }

    // Function to handle authentication state
    function handleAuthState() {
        const prevPageBtn = document.getElementById("prevPageBtn");
        const nextPageBtn = document.getElementById("nextPageBtn");

        onAuthStateChanged(auth, (user) => {
            if (user) {
                // User is signed in, get user ID and load notifications
                const userId = user.uid;

                // Load initial notifications
                loadClientNotifications(userId);

                // Fetch unread notifications to update the badge
                fetchUnreadNotifications(userId);

                // Handle "Previous Page" button click
                prevPageBtn.addEventListener("click", () => {
                    if (currentPage > 1) {
                        currentPage--;
                        lastVisibleDoc = null; // Reset last visible document when going to the previous page
                        loadClientNotifications(userId);
                    }
                });

                // Handle "Next Page" button click
                nextPageBtn.addEventListener("click", () => {
                    if (currentPage < totalPages) {
                        currentPage++;
                        loadClientNotifications(userId);
                    }
                });
            } else {
                console.error("User is not signed in.");
            }
        });
    }

    document.addEventListener('DOMContentLoaded', () => {
    // Add event listeners for buttons
    document.getElementById('openPermitModalBtn').addEventListener('click', openPermitSelectionModal);
    document.getElementById('closePermitModalBtn').addEventListener('click', closePermitSelectionModal);
    document.getElementById('closeModalFooterBtn').addEventListener('click', closePermitSelectionModal);

    async function openPermitSelectionModal() {
        const user = auth.currentUser;
        if (!user) {
            console.error("No user is signed in.");
            return;
        }

        const modal = document.getElementById('permitSelectionModal');
        const permitList = document.getElementById('permitList');
        permitList.innerHTML = '';  // Clear previous entries

        // Fetch building permits for the logged-in user
        const buildingPermitsRef = collection(db, "buildingPermits");
        const querySnapshot = await getDocs(query(buildingPermitsRef, where("ownerUid", "==", user.uid)));

        // Populate modal with fetched building permits and client names
        querySnapshot.forEach((doc) => {
            const permit = doc.data();
            const listItem = document.createElement('li');
            listItem.textContent = `${permit.buildingPermitNo} - ${permit.ownerName || 'Unknown Owner'}`;
            listItem.className = "list-group-item list-group-item-action";
            listItem.addEventListener('click', () => selectPermit(doc.id)); // Pass document ID
            permitList.appendChild(listItem);
        });

        // Show the modal
        modal.style.display = 'block';
    }

    function closePermitSelectionModal() {
        document.getElementById('permitSelectionModal').style.display = 'none';
    }

    async function selectPermit(permitId) {
    try {
        const permitRef = doc(db, "buildingPermits", permitId);
        const permitSnap = await getDoc(permitRef);

        if (permitSnap.exists()) {
            const permitData = permitSnap.data();

            // Autofill static form fields and apply highlight effect
            autofillField('buildingPermitNo', permitData.buildingPermitNo);
            autofillField('ownerName', permitData.ownerName);
            autofillField('ownerAddress', permitData.addressTelNo);
            autofillField('projectLocation', permitData.projectLocation);
            autofillField('totalFloorArea', permitData.TotalFloorArea);
            autofillField('NOStorey', permitData.NOStorey);

            // Autofill dropdown for NOUnits
            const noUnitsDropdown = document.getElementById("NOUnitsDropdown");
            if (noUnitsDropdown) {
                noUnitsDropdown.value = permitData.NOUnits || ''; // Set the dropdown value
                noUnitsDropdown.classList.add('highlight'); // Add highlight class
                setTimeout(() => noUnitsDropdown.classList.remove('highlight'), 2000); // Remove highlight
                noUnitsDropdown.dispatchEvent(new Event('change')); // Trigger change event if needed
            }

            // Handle dynamic unit data
            const unitFieldsContainer = document.getElementById("unitFieldsContainer");
            const unitsData = permitData.unitsData || []; // Ensure unitsData exists

            // Generate dynamic fields based on unitsData
            unitFieldsContainer.innerHTML = ""; // Clear existing dynamic fields
            unitsData.forEach((unit, index) => {
                const unitIndex = index + 1;

                const unitDiv = document.createElement("div");
                unitDiv.className = "row mb-3";

                unitDiv.innerHTML = `
                    <div class="col">
                        <label for="BlockNumber${unitIndex}">Block Number for Unit ${unitIndex}</label>
                        <input type="text" class="form-control" id="BlockNumber${unitIndex}" placeholder="Block Number">
                    </div>
                    <div class="col">
                        <label for="LotNumber${unitIndex}">Lot Number for Unit ${unitIndex}</label>
                        <input type="text" class="form-control" id="LotNumber${unitIndex}" placeholder="Lot Number">
                    </div>
                    <div class="col">
                        <label for="NOStorey${unitIndex}">Number of Storeys for Unit ${unitIndex}</label>
                        <input type="number" class="form-control" id="NOStorey${unitIndex}" placeholder="Number of Storeys">
                    </div>
                    <div class="col">
                        <label for="UnitFloorArea${unitIndex}">Floor Area for Unit ${unitIndex}</label>
                        <input type="number" class="form-control unit-floor-area" id="UnitFloorArea${unitIndex}" placeholder="Floor Area" required>
                    </div>
                `;

                unitFieldsContainer.appendChild(unitDiv);

                // Apply autofill and highlight effect for dynamic fields
                autofillField(`BlockNumber${unitIndex}`, unit.blockNumber);
                autofillField(`LotNumber${unitIndex}`, unit.lotNumber);
                autofillField(`NOStorey${unitIndex}`, unit.NOStorey);
                autofillField(`UnitFloorArea${unitIndex}`, unit.floorArea);
            });

            // Update totals after autofill
            updateTotals();

            // Show SweetAlert2 notification after autofilling all fields
            Swal.fire({
                title: 'Fields Populated',
                text: 'All relevant fields have been successfully populated.',
                icon: 'success',
                confirmButtonText: 'OK'
            });

            closePermitSelectionModal();
        } else {
            console.error("No such document!");
            Swal.fire({
                title: 'Error',
                text: 'Permit data not found!',
                icon: 'error',
                confirmButtonText: 'OK'
            });
        }
    } catch (error) {
        console.error("Error fetching permit details:", error);
        Swal.fire({
            title: 'Error',
            text: 'An error occurred while fetching permit details.',
            icon: 'error',
            confirmButtonText: 'OK'
        });
    }
}

// Function to autofill a field and apply highlight effect
function autofillField(fieldId, value) {
    const field = document.getElementById(fieldId);
    if (field) {
        field.value = value || ''; // Set field value
        field.classList.add('highlight'); // Add highlight class

        // Remove highlight effect after 2 seconds
        setTimeout(() => {
            field.classList.remove('highlight');
        }, 2000);
    }
}

});


    // Start monitoring authentication state when the DOM is fully loaded
    document.addEventListener('DOMContentLoaded', () => {
        handleAuthState();
    });


    async function logFirestoreChanges(OccupancyPermits, permitId) {
  // Reference to the specific document in the collection
  const docRef = doc(db, OccupancyPermits, permitId);

  // Listen for real-time updates on the document
  onSnapshot(docRef, async (docSnapshot) => {
    if (docSnapshot.exists()) {
    
      
      // Create a log entry with document data, collection name, timestamp, and type of operation
      const logEntry = {
        documentId: docSnapshot.id,
        collection: OccupancyPermits,
        timestamp: new Date().toISOString(),
        operation: "Create" // Update this to reflect your operation type if needed
      };
      
      // Write the log entry to the 'logs' collection
      try {
        await addDoc(collection(db, "logs"), logEntry);
        console.log(`Logged change for document ${permitId} in collection ${OccupancyPermits}`);
      } catch (error) {
        console.error("Error writing log entry:", error);
      }
    } else {
      console.log(`Document ${OccupancyPermits}/${permitId} does not exist.`);
    }
  });
}

    
</script>
    
    
    

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            var sideNav = document.getElementById('side_nav');
            var openBtn = document.querySelector('.open-btn');
            var closeBtn = document.querySelector('.close-btn');
            var dropdownItems = document.querySelectorAll('.sideNav.dropdown');

            // Toggle the sidebar for mobile view
            openBtn.addEventListener('click', function() {
                sideNav.classList.add('active');
            });

            closeBtn.addEventListener('click', function() {
                sideNav.classList.remove('active');
            });

            // Handle dropdown in sidebar
            dropdownItems.forEach(function(item) {
                item.addEventListener('click', function(e) {
                    e.stopPropagation(); // Prevents clicks from closing the sidebar
                    this.classList.toggle('open');
                });
            });

            // Close the sidebar when clicking outside of it (optional)
            document.addEventListener('click', function(e) {
                if (!sideNav.contains(e.target) && !openBtn.contains(e.target)) {
                    sideNav.classList.remove('active');
                }
            });
        });
    </script>

    <script>
        function updateLotBlockFields() {
            const noUnits = document.getElementById('NOUnits').value;
            const container = document.getElementById('lotBlockContainer');
            container.innerHTML = ''; // Clear existing fields

            for (let i = 1; i <= noUnits; i++) {
                const row = document.createElement('div');
                row.className = 'row mb-3';

                const col1 = document.createElement('div');
                col1.className = 'col-md-6';

                const label1 = document.createElement('label');
                label1.for = `LBNum${i}`;
                label1.className = 'form-label';
                label1.textContent = `Lot and Block Number ${i}:`;

                const input1 = document.createElement('input');
                input1.type = 'text';
                input1.className = 'form-control';
                input1.id = `LBNum${i}`;

                col1.appendChild(label1);
                col1.appendChild(input1);

                const col2 = document.createElement('div');
                col2.className = 'col-md-6';

                const label2 = document.createElement('label');
                label2.for = `SQM${i}`;
                label2.className = 'form-label';
                label2.textContent = `SQ/M ${i}:`;

                const input2 = document.createElement('input');
                input2.type = 'number';
                input2.className = 'form-control';
                input2.id = `SQM${i}`;
                input2.oninput = calculateTotalFloorArea;

                col2.appendChild(label2);
                col2.appendChild(input2);

                row.appendChild(col1);
                row.appendChild(col2);
                container.appendChild(row);
            }
        }

        function calculateTotalFloorArea() {
            const noUnits = document.getElementById('NOUnits').value;
            let totalFloorArea = 0;

            for (let i = 1; i <= noUnits; i++) {
                const sqmValue = parseFloat(document.getElementById(`SQM${i}`).value) || 0;
                totalFloorArea += sqmValue;
            }

            document.getElementById('totalFloorArea').value = totalFloorArea;
        }
    </script>


<script>
    function uploadFile(input, file = null) {
        const selectedFile = file || input.files[0];  // Use the file from input or passed as an argument

        if (selectedFile) {
            const maxSizeMB = 5;  // Set max file size (in MB)
            const allowedTypes = ['image/jpeg', 'image/png', 'application/pdf'];  // Allowed file types

            // Validate file type
            if (!allowedTypes.includes(selectedFile.type)) {
                alert('Invalid file type. Please upload a JPG, PNG, or PDF file.');
                input.value = ''; // Clear the input
                return;
            }

            // Validate file size
            const maxSizeBytes = maxSizeMB * 1024 * 1024;  // Convert MB to bytes
            if (selectedFile.size > maxSizeBytes) {
                alert(`File is too large. Please upload a file smaller than ${maxSizeMB}MB.`);
                input.value = '';  // Clear the input
                return;
            }

            // FileReader to read file details
            const reader = new FileReader();
            reader.onload = function () {
                const fileName = selectedFile.name;
                const fileSize = formatBytes(selectedFile.size);
                const fileItem = `
                    <div class="file-item">
                        <span class="file-name">${fileName} (${fileSize})</span>
                        <span class="btn-delete" onclick="deleteFile(this, '${input.id}')">Delete</span>
                    </div>`;

                // Display file information
                const fileColumn = input.closest('.file-column'); // Get the closest file-column
                if (fileColumn) {
                    fileColumn.insertAdjacentHTML('beforeend', fileItem);  // Append the file item
                } else {
                    console.error('File column not found.');
                }
            };
            reader.readAsDataURL(selectedFile);
        }
    }

    function deleteFile(deleteBtn, inputId) {
        const fileItem = deleteBtn.closest('.file-item');
        if (fileItem) {
            fileItem.remove();  // Remove the displayed file item
            document.getElementById(inputId).value = '';  // Clear the input for re-upload
        }
    }

    // Format file size to a readable string
    function formatBytes(bytes, decimals = 2) {
        if (bytes === 0) return '0 Bytes';
        const k = 1024;
        const dm = decimals < 0 ? 0 : decimals;
        const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB'];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i];
    }

    // Drag-over handler to show drag-and-drop action
    function handleDragOver(event) {
        event.preventDefault();
        event.stopPropagation();
        event.dataTransfer.dropEffect = 'copy';  // Change the cursor to indicate a drop is possible
    }

    // Drop handler to process the dropped files
    function handleDrop(event) {
        event.preventDefault();
        event.stopPropagation();

        const files = event.dataTransfer.files;  // Get the dropped files
        const inputFileElement = event.target.closest('.upload-btn-wrapper').querySelector('.file-input');  // Find the corresponding file input

        if (inputFileElement && files.length > 0) {
            limitFiles(inputFileElement, 5, files);  // Limit the number of dropped files and handle each
        }
    }

    // Limit the number of files
    function limitFiles(input, maxFiles = 5, fileList = null) {
        const files = fileList || input.files;
        if (files.length > maxFiles) {
            alert(`You can only upload up to ${maxFiles} files.`);
            input.value = '';  // Clear the input
            return;
        }

        for (let i = 0; i < files.length; i++) {
            uploadFile(input, files[i]);  // Process each file
        }
    }
</script>

<script>
    // Function to set the minimum date to tomorrow
    function setMinDate() {
        const today = new Date();
        const tomorrow = new Date(today);
        tomorrow.setDate(today.getDate() + 1); // Set to tomorrow

        const dd = String(tomorrow.getDate()).padStart(2, '0');
        const mm = String(tomorrow.getMonth() + 1).padStart(2, '0'); // January is 0!
        const yyyy = tomorrow.getFullYear();
        const minDate = yyyy + '-' + mm + '-' + dd; // Format as YYYY-MM-DD
        document.getElementById('appointmentDate').setAttribute('min', minDate);
    }

    // Function to disable weekends
    function disableWeekends() {
        const dateInput = document.getElementById('appointmentDate');
        dateInput.addEventListener('input', function () {
            const selectedDate = new Date(this.value);
            const day = selectedDate.getUTCDay();
            
            // Check if the selected day is Saturday (6) or Sunday (0)
            if (day === 6 || day === 0) {
                alert('Please select a weekday (Monday-Friday).');
                this.value = ''; // Clear the input if it's a weekend
            }
        });
    }

    setMinDate();
    disableWeekends();
</script>
  

<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

        <script src="/transition.js"></script>

    
</body>
</html>
