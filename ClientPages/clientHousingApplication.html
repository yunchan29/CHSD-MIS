<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CHSD MIS</title>
    <link rel="stylesheet" href="/Stylesheets/style.css">
    <link rel="icon" href="/resources/pictures/chsd.png" type="image/x-icon">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
   
    <style>
        /* CSS for the content container */
        .content {
            flex: 1; /* Take remaining space */
            overflow: hidden; /* Hide overflow content */
            display: flex; /* Use flexbox */
            flex-direction: column; /* Column layout */
        }

        .content-container {
            overflow-y: auto; /* Enable vertical scrolling */
            padding: 20px; /* Add some padding */
        }

        .wide-modal {
            max-width: 80%;
        }
        @media (max-width: 768px) {
    .wide-modal {
        max-width: 100% !important;
    }
}

        .form-control {
            margin-bottom: 1rem; /* Add margin between form controls */
        }

        .form-check {
            margin-bottom: 0.5rem; /* Add margin between checkboxes */
        }

        .row.g-3 .col-md-6,
        .row.g-3 .col-md-4,
        .row.g-3 .col-md-12 {
            margin-bottom: 1rem; /* Add margin to columns */
        }

        .d-flex .me-2 {
            margin-right: 1rem; /* Add margin to the right of the input */
        }

        .form-step {
    display: none; /* Hide all steps by default */
}
.form-step.active {
    display: block; /* Show the active step */
}

.required-asterisk {
    color: red !important; 
    font-weight: bold !important; 
    font-size: 1.2em !important; 
  }

  @media(max-width:991px){
    .subtitle{
    opacity: 0.7;
    font-size: 2vw ;
}
   
}
.subtitle{
    font-size:0.9vw;
    opacity:0.7;
}

    </style>
</head>
<body>
    <div id="loading-screen" class="loading-screen" style="display: none;">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
    </div>

      
   
    
    <div class="main-container d-flex">

        <!--Sidebar-->
        <div class="sideNav" id="side_nav">
            <div class="container">
                <div class="header-box text-center px-2 pt-3 pb-4 ">
                    <button class="btn d-md-none d-block close-btn px-1 py-0 text-black"><i class="fa-solid fa-bars-staggered"></i></button>
                    <div class="avatar-placeholder">
                        <img id="client-avatar" src="" alt="loading..." width="100" height="100">

                    </div>
                    <div class="avatar-text">
                        <!-- Client ID and Name -->
                        <div id="user-name">loading...</div>
                    </div>
                    
                </div>
            </div>
            <ul class="sideBarList list-unstyled px-2">
                <li class="sideNav"><a href="clientDashboard.html" class="text-decoration-none"><i class="fa-solid fa-circle-info"></i> Application Status</a></li>
                <li class="sideNav"><a href="clientRequirements.html" class="text-decoration-none"><i class="fa-solid fa-list"></i> Requirements List</a></li>
                
                <li class="sideNav dropdown open">
                    <a href="#" class="text-decoration-none"><i class="fa-solid fa-newspaper"></i> Application <i class="fas fa-caret-down"></i></a>
                    <ul class="submenu list-unstyled">
                        <li class="text-center mt-2"><a href="clientBuildingPermit.html" class="text-decoration-none">Building Permit</a></li>
                        <li class="text-center mt-2"><a href="clientOccupancyApplication.html" class="text-decoration-none">Occupancy</a></li>
                        <li class="text-center mt-2"><a href="clientElectricalApplication.html" class="text-decoration-none">Electrical Inspection</a></li>
                        <li class="text-center mt-2 active"><a href="clientHousingApplication.html" class="text-decoration-none">Housing</a></li>
                    </ul>
                </li>
                <li class="sideNav"><a href="clientProfile.html" class="text-decoration-none"><i class="fa-solid fa-gear"></i> Settings</a></li>
                
               
                <li class="sideNav" id="user-logout-btn"><a href="#" class="text-decoration-none"><i class="fa-solid fa-right-from-bracket"></i> Log out</a></li>
            </ul>
        </div>
       

        <div class="content">
           

            <nav class="navigationBar navbar navbar-expand-lg bg-light">
                <div class="container-fluid">
                    <!-- Mobile View -->
                    <div class="d-flex justify-content-between d-md-none d-block">
                        <a class="navbar-brand d-flex align-items-center" href="#">
                            <img src="/resources/pictures/chsd.png" alt="CHSD" width="40" height="40" class="me-2">
                            <h5 class="mb-0 fs-5">CHSD</h5>
                        </a>
                        <button class="btn px-1 py-0 open-btn">
                            <i class="fa-solid fa-bars-staggered"></i>
                        </button>
                    </div>
            
                    <!-- Desktop View -->
                    <div class="collapse navbar-collapse d-none d-md-flex" id="navbarSupportedContent">
                        <a class="navbar-brand d-flex align-items-center" href="#">
                            <img src="/resources/pictures/chsd.png" alt="CHSD" width="75" height="75" class="me-2">
                            <h5 class="mb-0 fs-5 fs-lg-4">City Housing and Settlements Department</h5>
                        </a>
            
                                    <!-- Right-aligned content: Notifications -->
<ul class="navbar-nav ms-auto">
    <!-- Notifications Dropdown -->
    <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
            <i class="fa-solid fa-bell"></i>
            <span id="notification-badge" class="badge bg-danger" style="display: none;">0</span>
        </a>
        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdown" style="width: 500px; padding: 15px; max-height: 500px; overflow-y: auto;">
            <li>
                <h6 class="dropdown-header">Notifications</h6>
            </li>
            <li>
                <div class="notifications-container" id="notification-container" style="max-height: 400px; overflow-y: auto; overflow-x: hidden;">
                    <!-- Notifications will be dynamically added here -->
                </div>
            </li>
            <li>
                <div class="dropdown-item text-center">
                    <button id="prevPageBtn" class="btn btn-secondary btn-sm">Previous</button>
                    <span id="pageInfo">Page 1</span>
                    <button id="nextPageBtn" class="btn btn-secondary btn-sm">Next</button>
                </div>
            </li>
        </ul>
    </li>
</ul>

                    </div>
                </div>
            </nav>

            <div class="contentContainer">
                <div class="card text-center">
                    <div class="card-body">
                      <h5 class="card-title">Start Your Application</h5>
                      <p class="card-text">Click the button below to apply for Housing</p>
                      <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#housingApplicationModal">Apply</button>
                    </div>
                  </div>
            </div>
        </div>
    </div>

   
  
    <div class="modal fade" id="housingApplicationModal" tabindex="-1" aria-labelledby="housingApplicationModalLabel" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">

        <div class="modal-dialog modal-dialog-centered wide-modal">
          <div class="modal-content">
            <div class="modal-header">
              <h1 class="modal-title fs-5" id="housingApplicationModalLabel">Housing Application</h1>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                
                    
    
                   
                    <div class="step-progress mb-4">
                        <div class="step completed" id="step-1">
                            <div class="circle"></div>
                            <div class="label">Information of Household</div>
                        </div>
                        <div class="step" id="step-2">
                            <div class="circle"></div>
                            <div class="label">Household Members</div>
                        </div>
                        <div class="step" id="step-3">
                            <div class="circle"></div>
                            <div class="label">Appointment Schedule</div>
                        </div>
                    </div>
                   
                  <!-- Form Steps -->
                   <form id="housingApplicationForm">

    <div class="form-step active" id="form-step-1">
        <p>Note: Fill up all the fields to proceed to the next step.</p>
                        <p><i>Required fields are marked with <span class="required-asterisk">*</span></i></p>
        <h5>Household Head Details</h5>
        <div class="row">
            <div class="col" style="display:none;">
                <label for="surveyNo">Survey No. (Numero ng Survey)</label>
                <input type="text" id="surveyNo" class="form-control" placeholder="Autogenerated" disabled>
            </div>
            <div class="col-md-4">
                <label for="dateApplied">Date<span class="required-asterisk">*</span><span class="subtitle">(Petsa)</span></label>
                <input type="date" id="dateApplied" class="form-control" required>
            </div>
        </div>
        
        <div class="row">
            <div class="col-md-3">
                <label for="householdBirthday">Date of Birth<span class="required-asterisk">*</span> <span class="subtitle">(Araw ng Kapanganakan)</span></label>
                <input type="date" class="form-control" id="householdBirthday" required>
            </div>
            <div class="col-md-3">
                <label for="householdSex">Sex <span class="required-asterisk">*</span> <span class="subtitle">(Kasarian)</span></label>
                <select class="form-control" id="householdSex" required>
                    <option>Male (Lalaki)</option>
                    <option>Female (Babae)</option>
                </select>
            </div>
            <div class="col-md-3">
                <label for="householdCivilStatus">Civil Status<span class="required-asterisk">*</span><span class="subtitle">(Kalagayang Sibil)</span></label>
                <select class="form-control" id="householdCivilStatus" required>
                    <option>Single (Walang Asawa)</option>
                    <option>Married (Kasal)</option>
                    <option>Live in (Magkasama)</option>
                    <option>Widowed (Biyuda/Biyudo)</option>
                    <option>Single Parent (Nag-iisang Magulang)</option>
                    <option>Separated (Hiwalay)</option>
                </select>
            </div>
        </div>
        
        <div class="row">
            <div class="col-md-3">
                <label for="householdLastName">Last Name <span class="required-asterisk">*</span><span class="subtitle">(Apelyido)</span></label>
                <input type="text" class="form-control" id="householdLastName" disabled>
            </div>
            <div class="col-md-3">
                <label for="householdFirstName">First Name <span class="required-asterisk">*</span><span class="subtitle">(Pangalan)</span></label>
                <input type="text" class="form-control" id="householdFirstName" disabled>
            </div>
            <div class="col-md-3">
                <label for="householdMiddleName">Middle Name<span class="subtitle">(Gitnang Pangalan)</span></label>
                <input type="text" class="form-control" id="householdMiddleName">
            </div>
            <div class="col-md-3">
                <label for="householdMaidenName">Maiden Name <span class="subtitle">(Apelyido Bago Magpakasal)</span></label>
                <input type="text" class="form-control" id="householdMaidenName">
            </div>
        </div>
        
        <div class="row">
            <div class="col-md-6">
                <label for="householdOccupation">Occupation <span class="required-asterisk">*</span><span class="subtitle">(Trabaho)</span></label>
                <input type="text" class="form-control" id="householdOccupation" required>
            </div>
            <div class="col-md-6">
                <label for="householdPlaceOfWork">Place of Work<span class="required-asterisk">*</span><span class="subtitle">(Lugar ng Trabaho)</span></label>
                <input type="text" class="form-control" id="householdPlaceOfWork" required>
            </div>
        </div>
        
        <div class="row">
            <div class="col">
                <label for="householdAddress">Present Address<span class="required-asterisk">*</span><span class="subtitle">(Kasalukuyang Tirahan)</span></label>
                <textarea class="form-control" id="householdAddress" rows="1" required></textarea>
            </div>
        </div>
        
        <div class="row">
            <div class="col-md-12">
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="hasSpouse">
                    <label class="form-check-label" for="hasSpouse">
                        Check if you have a spouse (Lagyan ng tsek kung may asawa)
                    </label>
                </div>
            </div>
        </div>
        
        <!-- Spouse fields -->
        <div class="row">
            <h5>Name of Spouse <span class="subtitle">(Pangalan ng Asawa)</span></h5>
        </div>
        <div class="row">
            <div class="col-md-3">
                <label for="spouseLastName">Last Name  <span clas="subtitle">(Apelyido)</span></label>
                <input type="text" class="form-control" id="spouseLastName" disabled>
            </div>
            <div class="col-md-3">
                <label for="spouseFirstName">First Name <span class="subtitle">(Unang Pangalan)</span></label>
                <input type="text" class="form-control" id="spouseFirstName" disabled>
            </div>
            <div class="col-md-3">
                <label for="spouseMiddleName">Middle Name <span class="subtitle">(Gitnang Pangalan)</span></label>
                <input type="text" class="form-control" id="spouseMiddleName" disabled>
            </div>
            <div class="col-md-3">
                <label for="spouseMaidenName">Maiden Name (Pangalan Bago Magpakasal)</label>
                <input type="text" class="form-control" id="spouseMaidenName" disabled>
            </div>
        </div>
        
        <div class="row">
            <div class="col-md-3">
                <label for="spouseBirthday">Date of Birth (Araw ng Kapanganakan)</label>
                <input type="date" class="form-control" id="spouseBirthday" disabled>
            </div>
        </div>
        
        <div class="row">
            <div class="col-md-4">
                <label for="classificationOfSurveyHousehold">Classification of Survey Household <span class="required-asterisk">*</span><span class="subtitle">(Klasipikasyon ng Sambahayang Sinusuri)</span></label>
                <select class="form-control" id="classificationOfSurveyHousehold" required>
                    <option>Caretaker (Tagapangalaga)</option>
                    <option>Co-Owner (Kapwa May-ari)</option>
                    <option>Owner (May-ari)</option>
                    <option>Renter (Nangungupahan)</option>
                    <option>RFO (Handa na para sa Paninirahan)</option>
                    <option>Sharer (Nakikibahagi)</option>
                </select>
            </div>
            <div class="col-md-6">
                <label for="structureOwner">Structure Owner <span class="required-asterisk">*</span><span class="subtitle">(May-ari ng Estruktura)</span></label>
                <input type="text" class="form-control" id="structureOwner" required>
            </div>
        </div>
        
        <div class="row">
            <div class="col-md-6">
                <label for="provinceOfOrigin">Province of Origin <span class="required-asterisk">*</span><span class="subtitle">(Probinsya ng Pinagmulan)</span></label>
               <select class="form-control" id="provinceOfOrigin" required>
                            <option value="" disabled selected>Select your province</option>
                            <option value="Abra">Abra</option>
                            <option value="Agusan del Norte">Agusan del Norte</option>
                            <option value="Agusan del Sur">Agusan del Sur</option>
                            <option value="Aklan">Aklan</option>
                            <option value="Albay">Albay</option>
                            <option value="Antique">Antique</option>
                            <option value="Apayao">Apayao</option>
                            <option value="Aurora">Aurora</option>
                            <option value="Basilan">Basilan</option>
                            <option value="Bataan">Bataan</option>
                            <option value="Batanes">Batanes</option>
                            <option value="Batangas">Batangas</option>
                            <option value="Benguet">Benguet</option>
                            <option value="Biliran">Biliran</option>
                            <option value="Bohol">Bohol</option>
                            <option value="Bukidnon">Bukidnon</option>
                            <option value="Bulacan">Bulacan</option>
                            <option value="Cagayan">Cagayan</option>
                            <option value="Camarines Norte">Camarines Norte</option>
                            <option value="Camarines Sur">Camarines Sur</option>
                            <option value="Camiguin">Camiguin</option>
                            <option value="Capiz">Capiz</option>
                            <option value="Catanduanes">Catanduanes</option>
                            <option value="Cavite">Cavite</option>
                            <option value="Cebu">Cebu</option>
                            <option value="Compostela Valley">Compostela Valley</option>
                            <option value="Cotabato">Cotabato</option>
                            <option value="Davao de Oro">Davao de Oro</option>
                            <option value="Davao del Norte">Davao del Norte</option>
                            <option value="Davao del Sur">Davao del Sur</option>
                            <option value="Davao Occidental">Davao Occidental</option>
                            <option value="Davao Oriental">Davao Oriental</option>
                            <option value="Dinagat Islands">Dinagat Islands</option>
                            <option value="Eastern Samar">Eastern Samar</option>
                            <option value="Guimaras">Guimaras</option>
                            <option value="Ifugao">Ifugao</option>
                            <option value="Ilocos Norte">Ilocos Norte</option>
                            <option value="Ilocos Sur">Ilocos Sur</option>
                            <option value="Iloilo">Iloilo</option>
                            <option value="Isabela">Isabela</option>
                            <option value="Kalinga">Kalinga</option>
                            <option value="La Union">La Union</option>
                            <option value="Laguna">Laguna</option>
                            <option value="Lanao del Norte">Lanao del Norte</option>
                            <option value="Lanao del Sur">Lanao del Sur</option>
                            <option value="Leyte">Leyte</option>
                            <option value="Maguindanao">Maguindanao</option>
                            <option value="Marinduque">Marinduque</option>
                            <option value="Masbate">Masbate</option>
                            <option value="Metro Manila">Metro Manila</option>
                            <option value="Misamis Occidental">Misamis Occidental</option>
                            <option value="Misamis Oriental">Misamis Oriental</option>
                            <option value="Mountain Province">Mountain Province</option>
                            <option value="Negros Occidental">Negros Occidental</option>
                            <option value="Negros Oriental">Negros Oriental</option>
                            <option value="Northern Samar">Northern Samar</option>
                            <option value="Nueva Ecija">Nueva Ecija</option>
                            <option value="Nueva Vizcaya">Nueva Vizcaya</option>
                            <option value="Occidental Mindoro">Occidental Mindoro</option>
                            <option value="Oriental Mindoro">Oriental Mindoro</option>
                            <option value="Palawan">Palawan</option>
                            <option value="Pampanga">Pampanga</option>
                            <option value="Pangasinan">Pangasinan</option>
                            <option value="Quezon">Quezon</option>
                            <option value="Quirino">Quirino</option>
                            <option value="Rizal">Rizal</option>
                            <option value="Romblon">Romblon</option>
                            <option value="Samar">Samar</option>
                            <option value="Sarangani">Sarangani</option>
                            <option value="Siquijor">Siquijor</option>
                            <option value="Sorsogon">Sorsogon</option>
                            <option value="South Cotabato">South Cotabato</option>
                            <option value="Southern Leyte">Southern Leyte</option>
                            <option value="Sultan Kudarat">Sultan Kudarat</option>
                            <option value="Sulu">Sulu</option>
                            <option value="Surigao del Norte">Surigao del Norte</option>
                            <option value="Surigao del Sur">Surigao del Sur</option>
                            <option value="Tarlac">Tarlac</option>
                            <option value="Tawi-Tawi">Tawi-Tawi</option>
                            <option value="Zambales">Zambales</option>
                            <option value="Zamboanga del Norte">Zamboanga del Norte</option>
                            <option value="Zamboanga del Sur">Zamboanga del Sur</option>
                            <option value="Zamboanga Sibugay">Zamboanga Sibugay</option>
                        </select>
            </div>
            <div class="col-md-3">
                <label for="householdSize">Household Size <span class="required-asterisk">*</span><span class="subtitle">(Laki ng Pamilya)</span></label>
                <input type="number" class="form-control" id="householdSize" required>
            </div>
            <div class="col-md-3">
                <label for="yearOfResidency">Year of Residency <span class="required-asterisk">*</span><span class="subtitle">(Taon ng Paninirahan)</span></label>
                <input type="text" class="form-control" id="yearOfResidency" required>
            </div>
        </div>
        
        <div class="row">
            <label for="reasonsForEstablishing">Reasons for Establishing Residence in the Area <span class="required-asterisk">*</span><span class="subtitle">(Mga Dahilan ng Paninirahan sa Lugar)</span></label>
            <select class="form-control" id="reasonsForEstablishing">
                <option>Proximity of Livelihood (Malapit sa Hanapbuhay)</option>
                <option>Rent Free or Affordable Rental Rates (Libreng Upa o Abot-kayang Pabahay)</option>
                <option>Acquired Right (Nakuhang Karapatan)</option>
                <option>Family Ties (Ugnayang Pamilya)</option>
                <option>Near School (Malapit sa Paaralan)</option>
                <option>No Other Place to Go (Walang Ibang Mapupuntahan)</option>
            </select>
        </div>
        
       
        
            
    
    
       
      
    
        <div class="row justify-content-end mt-4">
            <div class="col">
               
            </div>
        </div>
    </div>
    
    
                    <div class="form-step" id="form-step-2">
                        
                        
                        <h5>Household Members Information</h5>
                        <div class="row">
                            <div class="col-md-6">
                                <label for="memberName">Name<span class="required-asterisk">*</span></label>
                                <input type="text" id="memberName" class="form-control" required>
                            </div>
                            <div class="col-md-6">
                                <label for="relationToHead">Relation To The Household Head<span class="required-asterisk">*</span></label>
                                <select class="form-control" id="relationToHead" required>
                                    <option>Father</option>
                                    <option>Mother</option>
                                    <option>Child</option>
                                    <option>Sibling</option>
                                    <option>Husband</option>
                                    <option>Wife</option>
                                    <option>Uncle</option>
                                    <option>Aunt</option>
                                    <option>Grandmother</option>
                                    <option>Grandfather</option>
                                    <option>Others</option>
                                    </select>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-2">
                                <label for="memberAge">Age<span class="required-asterisk">*</span></label>
                                <input type="number" class="form-control" id="memberAge" required>
                            </div>
                            <div class="col-md-2">
                                <label for="memberGender">Gender<span class="required-asterisk">*</span></label>
                                <select class="form-control" id="memberGender" required>
                                    <option>Male</option>
                                    <option>Female</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label for="memberCivilStatus">Civil Status<span class="required-asterisk">*</span></label>
                                <select class="form-control" id="memberCivilStatus" required>
                                    <option>Single</option>
                                    <option>Married</option>
                                    <option>Live in</option>
                                    <option>Widowed</option>
                                    <option>Single Parent</option>
                                    <option>Separated</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="memberEducationalAttainment">Educational Attainment<span class="required-asterisk">*</span></label>
                                <select class="form-control" id="memberEducationalAttainment" required>
                                  
                                    <option>Elementary Undergraduate</option>
                                    <option>Elementary Graduate</option>
                                    <option>High School Undergraduate</option>
                                    <option>High School Graduate</option>
                                    <option>College Undergraduate</option>
                                    <option>College Graduate</option>
                                </select>



                            </div>
                        </div>
    
                        <div class="row">
                            <div class="col-md-2">
                                <label for="memberEmployed">Employed<span class="required-asterisk">*</span></label>
                                <select class="form-control" id="memberEmployed" required>
                                    <option>Yes</option>
                                    <option>No</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label for="memberOccupation">Occupation</label>
                                <input type="text" class="form-control" id="memberOccupation" required>
                            </div>
                            <div class="col-md-3">
                                <label for="memberPlaceOfWork">Place of Work</label>
                                <input type="text" class="form-control" id="memberPlaceOfWork" required>
                            </div>
                            <div class="col-md-3">
                                <label for="memberMonthlyIncome">Monthly Income(PHP)</label>
                                <select class="form-control" id="memberMonthlyIncome" required>
                                    <option>Below 20,000</option>
                                    <option>20,000-25,000</option>
                                    <option>25,000-30,000</option>
                                    <option>Above 30,000</option>
                                </select>
                            </div>
                            
                        </div>
    
                        <div class="row justify-content-end mt-4">
                            <div class="col">
                               
                            </div>
                        </div>
                        

                        <div id="addHouseholdLoading" class="spinner-border text-primary" role="status" style="display: none;">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                        
                        <div class="row">
                            <div class="col text-end">
                                <button class="btn btn-secondary" type="button" id="addHouseholdBtn"><i class="fa-solid fa-plus"></i> Add</button>
                                <button class="btn btn-secondary" type="button" id="clearHouseholdBtn"><i class="fa-solid fa-delete-left"></i> Clear</button>
                                <button class="btn btn-secondary" type="button" id="editHouseholdBtn"><i class="fa-solid fa-pencil"></i> Edit</button>
                                <button class="btn btn-secondary" type="button" id="deleteHouseholdBtn"><i class="fa-solid fa-trash"></i> Delete</button>
                            </div>
                        </div>
    
                        <div class="contentContainer">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Relation</th>
                                        <th>Age</th>
                                        <th>Gender</th>
                                        <th>Civil Status</th>
                                        <th>Educational Attainment</th>
                                        <th>Employed</th>
                                        <th>Occupation</th>
                                        <th>Place of Work</th>
                                        <th>Monthly Income</th>
                                    </tr>
                                </thead>
                                <tbody id="householdMembersTableBody"> <!-- Added id to tbody -->
                                </tbody>
                            </table>
                        </div>
                        
                    </div>
    
                    <div class="form-step" id="form-step-3">
                        
                        <div class="row">
                            <div class="col-md-3"></div> <!-- Empty column for spacing -->
                            <div class="row justify-content-center">
                                <div class="col-md-6">
                                    <label for="appointmentDate">Appointment Schedule(for submission of requirements)</label>
                                    <input type="date" class="form-control" id="appointmentDate">
                                </div>
                            </div>
                            <div class="col-md-3"></div> <!-- Empty column for spacing -->
                        </div>
                       
                       
                       </form>
                       
                    
                </div>
            </div>
            <div class="modal-footer"> 
                <button type="button" class="btn btn-primary" id="nextBtn1">Next</button>
                <button type="button" class="btn btn-secondary" id="prevBtn2" style="display:none;">Previous</button>
                <button type="button" class="btn btn-primary" id="nextBtn2" style="display:none;">Next</button>
                <button type="button" class="btn btn-secondary" id="prevBtn3" style="display:none;">Previous</button>
                <button type="button" class="btn btn-primary" id="submitBtn" style="display:none;">Submit</button>
            </div>
            
              
          </div>
        </div>
      </div>

          </div>

   <!-- Remarks Modal -->
<div class="modal fade" id="viewRemarks" tabindex="-1" aria-labelledby="remarksModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="remarksModalLabel">Remarks</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body" id="remarks-content">
            
        </div>
      </div>
    </div>
  </div>

  <!-- Application Applied Modal -->
<div class="modal fade" id="applicationAppliedModal" tabindex="-1" aria-labelledby="ApplicationAppliedModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="ApplicationAppliedModalLabel"><i class="fa-solid fa-check-circle"></i> Success</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body text-center">
                <h2>Application Submitted</h2>
                <i class="fa-solid fa-check-circle fa-3x text-success"></i>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
<!-- Privacy Policy Modal -->
<div class="modal fade" id="privacyPolicyModal" tabindex="-1" aria-labelledby="privacyPolicyModalLabel" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog modal-dialog-centered wide-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="privacyPolicyModalLabel">Privacy Policy and Terms of Service</h5>
            </div>
            <div class="modal-body" id="privacyPolicyContent" style="max-height: 400px; overflow-y: auto;">
                <h5>Privacy Policy</h5>
                <p>We are committed to protecting your privacy. This privacy policy explains how we collect, use, and share your personal information when you apply for housing through our system. By submitting your application, you consent to our privacy policy and the collection, use, and sharing of your information as described here.</p>

                <ul>
                    <li><b>Information Collection:</b> We collect personal data such as name, address, contact details, employment status, income information, household details, and housing preferences for the sole purpose of processing your housing application.</li>
                    <li><b>Use of Data:</b> The collected data is used to process your housing application, determine eligibility, and communicate with you regarding the status of your application.</li>
                    <li><b>Data Sharing:</b> Your data will not be shared with third parties except where required by law or necessary for completing the housing application process. In some cases, your data may be shared with relevant government agencies or housing authorities.</li>
                  
                </ul>

                <h5>Terms and Conditions</h5>
                <p>By using this service, you agree to the following terms and conditions:</p>
                <ul>
                    <li>You will provide accurate and truthful information in your housing application.</li>
                    <li>You understand that the processing of your application may take several days or weeks, depending on the availability of housing and the complexity of the application.</li>
                    <li>You are responsible for any fees or charges associated with your application, if applicable.</li>
                    <li>Any attempt to provide fraudulent or misleading information may result in legal consequences, including disqualification from the housing program.</li>
                </ul>
            </div>
            <div class="modal-footer d-flex justify-content-between align-items-center">
                <div class="form-check testingPrivacy me-3">
                    <input class="form-check-input" type="checkbox" id="termsCheckbox">
                    <label class="form-check-label" for="termsCheckbox">
                        I have read and agree to the Privacy Policy and Terms and Conditions
                    </label>
                </div>
                <div>
                    <button type="button" class="btn btn-secondary text-white me-2" data-bs-dismiss="modal">Back</button>
                    <button type="button" class="btn btn-primary" id="acceptPolicyButton" disabled>Proceed</button>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

        <script src="/transition.js"></script>


<script>
    document.addEventListener('DOMContentLoaded', () => {
    // Prevent dropdown from closing when clicking on buttons or notifications
    document.querySelectorAll('.dropdown-menu').forEach(dropdown => {
        dropdown.addEventListener('click', (event) => {
            if (event.target.closest('.btn') || event.target.closest('.client-notification')) {
                event.stopPropagation();
            }
        });
    });

    handleAuthState();
});

  </script>




    <!-- Firebase and custom scripts -->
    <script type="module" src="/Database/firebase.js"></script>

  
   
   
    

    <!-- Bootstrap and other scripts -->

  
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.min.js" integrity="sha384-cuYeSxntonz0PPNlHhBs68uyIAVpIIOZZ5JqeqvYYIcEL727kskC66kF92t6Xl2V" crossorigin="anonymous"></script>
    <script src="/ClientPages/navBarScript.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Show the privacy policy modal when the page loads
            var privacyModal = new bootstrap.Modal(document.getElementById('privacyPolicyModal'));
            privacyModal.show();
            
            // Handle the "Proceed" button click
            document.getElementById('acceptPolicyButton').addEventListener('click', function () {
                // Hide the privacy policy modal
                var privacyModalEl = document.getElementById('privacyPolicyModal');
                var privacyModalInstance = bootstrap.Modal.getInstance(privacyModalEl);
                privacyModalInstance.hide();
                
                // Show the housing application modal
                var housingApplicationModal = new bootstrap.Modal(document.getElementById('housingApplicationModal'));
                housingApplicationModal.show();
            });
        });
        
        // Disable the "Proceed" button until the user scrolls to the bottom and checks the checkbox
        const modalContent = document.getElementById('privacyPolicyContent');
        const acceptPolicyButton = document.getElementById('acceptPolicyButton');
        const termsCheckbox = document.getElementById('termsCheckbox');
    
        function updateProceedButton() {
            // Allow a margin for scroll detection and ensure checkbox is checked
            const isScrolledToBottom = modalContent.scrollTop + modalContent.clientHeight >= modalContent.scrollHeight - 5;
            const isCheckboxChecked = termsCheckbox.checked;
            acceptPolicyButton.disabled = !(isScrolledToBottom && isCheckboxChecked);
        }
    
        // Add scroll event listener to check if the user has scrolled to the bottom
        modalContent.addEventListener('scroll', updateProceedButton);
        
        // Add change event listener for checkbox
        termsCheckbox.addEventListener('change', updateProceedButton);
        
        // Initial check in case the content is already scrolled to the bottom or checkbox is pre-checked
        window.addEventListener('load', updateProceedButton);
    </script>
    
     
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            // Sidebar functionality
            var sideNav = document.getElementById('side_nav');
            var openBtn = document.querySelector('.open-btn');
            var closeBtn = document.querySelector('.close-btn');
            var dropdownItems = document.querySelectorAll('.sideNav.dropdown');
            
            // Toggle the sidebar for mobile view
            openBtn?.addEventListener('click', function() {
                sideNav.classList.add('active');
            });
            
            closeBtn?.addEventListener('click', function() {
                sideNav.classList.remove('active');
            });
            
            // Handle dropdown in sidebar
            dropdownItems.forEach(function(item) {
                item.addEventListener('click', function(e) {
                    e.stopPropagation(); // Prevents clicks from closing the sidebar
                    this.classList.toggle('open');
                });
            });
            
            // Close the sidebar when clicking outside of it (optional)
            document.addEventListener('click', function(e) {
                if (!sideNav.contains(e.target) && !openBtn.contains(e.target)) {
                    sideNav.classList.remove('active');
                }
            });
        
            // Function to clear the active state from all steps
            function clearActiveStates() {
                var allSteps = document.querySelectorAll('.step');
                allSteps.forEach(function(step) {
                    step.classList.remove('active');  // Remove the active class from all steps
                });
            }
        
            // Function to show the next form step and update the progress bar
            function showNextStep(currentStep, nextStep) {
                var currentFormStep = document.getElementById(`form-step-${currentStep}`);
                var nextFormStep = document.getElementById(`form-step-${nextStep}`);
                var currentStepIndicator = document.getElementById(`step-${currentStep}`);
                var nextStepIndicator = document.getElementById(`step-${nextStep}`);
        
                if (currentFormStep && nextFormStep) {
                    // Hide the current form step
                    currentFormStep.classList.remove('active');
                    // Show the next form step
                    nextFormStep.classList.add('active');
        
                    // Mark the current step as completed and not active anymore
                    if (currentStepIndicator) {
                        currentStepIndicator.classList.add('completed');
                        currentStepIndicator.classList.remove('active');
                    }
        
                    // Clear the active state of all steps
                    clearActiveStates();
        
                    // Mark the next step as active
                    if (nextStepIndicator) {
                        nextStepIndicator.classList.add('active');
                    }
                }
        
                // Handle button visibility
                handleButtonVisibility(nextStep);
            }
        
            // Function to show the previous form step and update the progress bar
            function showPreviousStep(currentStep, prevStep) {
                var currentFormStep = document.getElementById(`form-step-${currentStep}`);
                var prevFormStep = document.getElementById(`form-step-${prevStep}`);
                var currentStepIndicator = document.getElementById(`step-${currentStep}`);
                var prevStepIndicator = document.getElementById(`step-${prevStep}`);
        
                if (currentFormStep && prevFormStep) {
                    // Hide the current form step
                    currentFormStep.classList.remove('active');
                    // Show the previous form step
                    prevFormStep.classList.add('active');
        
                    // Clear the active state of all steps
                    clearActiveStates();
        
                    // Mark the previous step as active
                    if (prevStepIndicator) {
                        prevStepIndicator.classList.add('active');
                    }
        
                    // Do not remove the completed class, only remove active class from the current step
                    if (currentStepIndicator) {
                        currentStepIndicator.classList.remove('active');
                    }
                }
        
                // Handle button visibility
                handleButtonVisibility(prevStep);
            }
        
            // Function to control the visibility of the buttons based on the current step
            function handleButtonVisibility(step) {
                document.getElementById('nextBtn1').style.display = 'none';
                document.getElementById('prevBtn2').style.display = 'none';
                document.getElementById('nextBtn2').style.display = 'none';
                document.getElementById('prevBtn3').style.display = 'none';
                document.getElementById('submitBtn').style.display = 'none';
        
                if (step === 1) {
                    document.getElementById('nextBtn1').style.display = 'inline-block';
                } else if (step === 2) {
                    document.getElementById('prevBtn2').style.display = 'inline-block';
                    document.getElementById('nextBtn2').style.display = 'inline-block';
                } else if (step === 3) {
                    document.getElementById('prevBtn3').style.display = 'inline-block';
                    document.getElementById('submitBtn').style.display = 'inline-block';
                }
            }
        
            // Form validation logic
            const requiredFields = [
                document.getElementById('dateApplied'),
        
  
                document.getElementById('householdBirthday'),
                document.getElementById('householdCivilStatus'),
                document.getElementById('householdOccupation'),
                document.getElementById('householdPlaceOfWork'),
                document.getElementById('householdAddress'),
                document.getElementById('householdSex'),
                document.getElementById('classificationOfSurveyHousehold'),
            
                document.getElementById('structureOwner'),
                document.getElementById('provinceOfOrigin'),
                document.getElementById('householdSize'),
                document.getElementById('yearOfResidency'),
                document.getElementById('reasonsForEstablishing')
            ];
        
            const nextBtn1 = document.getElementById('nextBtn1');
            nextBtn1.disabled = true; // Disable button initially
        
            // Function to check if all required fields are filled
            function checkFormValidity() {
                const allFilled = requiredFields.every(input => input.value.trim() !== '');
                nextBtn1.disabled = !allFilled; // Enable button only if all fields are filled
            }
        
            // Attach event listeners to all required fields
            requiredFields.forEach(field => {
                field.addEventListener('input', checkFormValidity); // Check on every input change
            });
        
            // Event Listeners for the buttons
            document.getElementById('nextBtn1').addEventListener('click', function() {
                showNextStep(1, 2); // Move from step 1 to step 2
            });
        
            document.getElementById('nextBtn2').addEventListener('click', function() {
                showNextStep(2, 3); // Move from step 2 to step 3
            });
        
            document.getElementById('prevBtn2').addEventListener('click', function() {
                showPreviousStep(2, 1); // Move from step 2 back to step 1
            });
        
            document.getElementById('prevBtn3').addEventListener('click', function() {
                showPreviousStep(3, 2); // Move from step 3 back to step 2
            });
        });
        </script>
        
        <script>
            // Function to set the minimum date to tomorrow
            function setMinDate() {
                const today = new Date();
                const tomorrow = new Date(today);
                tomorrow.setDate(today.getDate() + 1); // Set to tomorrow
        
                const dd = String(tomorrow.getDate()).padStart(2, '0');
                const mm = String(tomorrow.getMonth() + 1).padStart(2, '0'); // January is 0!
                const yyyy = tomorrow.getFullYear();
                const minDate = yyyy + '-' + mm + '-' + dd; // Format as YYYY-MM-DD
                document.getElementById('appointmentDate').setAttribute('min', minDate);
            }
        
            // Function to disable weekends
            function disableWeekends() {
                const dateInput = document.getElementById('appointmentDate');
                dateInput.addEventListener('input', function () {
                    const selectedDate = new Date(this.value);
                    const day = selectedDate.getUTCDay();
                    
                    // Check if the selected day is Saturday (6) or Sunday (0)
                    if (day === 6 || day === 0) {
                        // SweetAlert2 for user-friendly alert
                        Swal.fire({
                            icon: 'warning',
                            title: 'Invalid Date',
                            text: 'Please select a weekday (Monday-Friday).',
                            confirmButtonText: 'OK'
                        }).then(() => {
                            this.value = ''; // Clear the input after alert
                        });
                    }
                });
            }
        
            setMinDate();
            disableWeekends();
        </script>
        

        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

        <script type="module">
            import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
            import { getAuth, onAuthStateChanged} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
            import { getFirestore, collection, addDoc, updateDoc, doc, arrayUnion, Timestamp, getDocs, where, limit, onSnapshot, query, orderBy, startAfter, getDoc} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
        
            // Firebase configuration
            const firebaseConfig = {
                apiKey: "AIzaSyBhvoPidRWGeJmnN2E11SBS5n8oyxVLJ0M",
                authDomain: "chsd-mis.firebaseapp.com",
                projectId: "chsd-mis",
                storageBucket: "chsd-mis.appspot.com",
                messagingSenderId: "694967679357",
                appId: "1:694967679357:web:65cffd50f13739f934f414",
                measurementId: "G-XBQTQFRLJ5"
            };
        
            // Initialize Firebase
            const app = initializeApp(firebaseConfig);
            const auth = getAuth(app);
            const db = getFirestore(app);
        
// Function to autofill the household name fields based on logged-in user data
async function autofillHouseholdNameFields() {
    const householdLastNameInput = document.getElementById('householdLastName');
    const householdFirstNameInput = document.getElementById('householdFirstName');
    const householdMiddleNameInput = document.getElementById('householdMiddleName');
    const householdAddressInput = document.getElementById("householdAddress");

    const user = auth.currentUser;
    if (user) {
        try {
            const userRef = doc(db, 'users', user.uid);
            const docSnap = await getDoc(userRef);
            
            if (docSnap.exists()) {
                const { firstName, lastName, middleName, clientAddress } = docSnap.data();

                if (householdFirstNameInput) householdFirstNameInput.value = firstName || '';
                if (householdLastNameInput) householdLastNameInput.value = lastName || '';
                if (householdMiddleNameInput) householdMiddleNameInput.value = middleName || '';
                if (householdAddressInput) householdAddressInput.value = clientAddress || '';
            } else {
                console.error("User document does not exist!");
            }
        } catch (error) {
            console.error("Error fetching user data:", error);
        }
    } else {
        console.log("No user is logged in.");
        if (householdFirstNameInput) householdFirstNameInput.value = '';
        if (householdLastNameInput) householdLastNameInput.value = '';
        if (householdMiddleNameInput) householdMiddleNameInput.value = '';
    }
}


// Call the autofill function when the users authentication state changes
onAuthStateChanged(auth, autofillHouseholdNameFields);

            // Declare the householdMembers array to store all household members from step 2
            let householdMembers = [];
        
            // Input fields for household members
            const memberNameInput = document.getElementById('memberName');
            const relationToHeadInput = document.getElementById('relationToHead');
            const memberAgeInput = document.getElementById('memberAge');
            const memberGenderInput = document.getElementById('memberGender');
            const memberCivilStatusInput = document.getElementById('memberCivilStatus');
            const memberEducationalAttainmentInput = document.getElementById('memberEducationalAttainment');
            const memberEmployedInput = document.getElementById('memberEmployed');
            const memberOccupationInput = document.getElementById('memberOccupation');
            const memberPlaceOfWorkInput = document.getElementById('memberPlaceOfWork');
            const memberMonthlyIncomeInput = document.getElementById('memberMonthlyIncome');
            const tableBody = document.getElementById('householdMembersTableBody');
        
            // Loading spinner for household member addition
            const addMemberLoadingSpinner = document.getElementById('addHouseholdLoading');
        
            // Function to add household member
            function addHouseholdMember(e) {
                // Prevent form submission behavior
                e.preventDefault();
                e.stopPropagation();
        
                // Show loading spinner
                addMemberLoadingSpinner.style.display = 'inline-block';
        
                const member = {
                    name: memberNameInput.value,
                    relation: relationToHeadInput.value,
                    age: memberAgeInput.value,
                    gender: memberGenderInput.value,
                    civilStatus: memberCivilStatusInput.value,
                    education: memberEducationalAttainmentInput.value,
                    employed: memberEmployedInput.value,
                    occupation: memberOccupationInput.value,
                    placeOfWork: memberPlaceOfWorkInput.value,
                    income: memberMonthlyIncomeInput.value,
                };
        
                // Validate required fields
                if (!member.name || !member.relation || !member.age || !member.gender) {
                    alert('Please fill in all required fields.');
                    addMemberLoadingSpinner.style.display = 'none';
                    return;
                }
        
                // Add the new member to the householdMembers array
                householdMembers.push(member);
        
                // Append the new household member to the table
                appendHouseholdMemberRow(member);
        
                // Clear input fields after adding
                clearHouseholdMemberInputs();
        
                // Hide the loading spinner
                setTimeout(() => {
                    addMemberLoadingSpinner.style.display = 'none';
                }, 500);
            }
        
            // Function to append the new household member to the table without reloading
            function appendHouseholdMemberRow(member) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${member.name}</td>
                    <td>${member.relation}</td>
                    <td>${member.age}</td>
                    <td>${member.gender}</td>
                    <td>${member.civilStatus}</td>
                    <td>${member.education}</td>
                    <td>${member.employed}</td>
                    <td>${member.occupation}</td>
                    <td>${member.placeOfWork}</td>
                    <td>${member.income}</td>
                `;
                tableBody.appendChild(row);
            }
        
            // Function to clear input fields
            function clearHouseholdMemberInputs() {
                memberNameInput.value = '';
                relationToHeadInput.value = '';
                memberAgeInput.value = '';
                memberGenderInput.value = '';
                memberCivilStatusInput.value = '';
                memberEducationalAttainmentInput.value = '';
                memberEmployedInput.value = '';
                memberOccupationInput.value = '';
                memberPlaceOfWorkInput.value = '';
                memberMonthlyIncomeInput.value = '';
            }
        
            // Add event listener to the "Add" button to trigger the add household member function
            document.getElementById('addHouseholdBtn').addEventListener('click', function (e) {
                addHouseholdMember(e); // Call the function to add the member and stop form submission
            });
        
    
            // Add event listener to the submit button to trigger the form submission
            document.getElementById('submitBtn').addEventListener('click', addHousingApplication);
        
            async function generateSurveyNo() {
    const currentYear = new Date().getFullYear();
    let newNumber = '0001'; // Default starting number if no entries exist

    // Query Firestore for housing applications with the current year in surveyNo
    const querySnapshot = await getDocs(query(
        collection(db, "Housing"),
        where("surveyNo", ">=", `${currentYear}-0000`),
        where("surveyNo", "<", `${currentYear + 1}-0000`),
        orderBy("surveyNo", "desc"),
        limit(1)
    ));

    if (!querySnapshot.empty) {
        // Get the latest survey number and increment the numeric part
        const latestSurveyNo = querySnapshot.docs[0].data().surveyNo;
        const latestNumber = parseInt(latestSurveyNo.split('-')[1]);
        newNumber = String(latestNumber + 1).padStart(4, '0');
    }

    return `${currentYear}-${newNumber}`;
}

async function addHousingApplication(event) {
    event.preventDefault();

    // Show the loading screen
    document.getElementById('loading-screen').style.display = 'flex';

    setTimeout(async () => {
        // Generate survey number
        const surveyNo = await generateSurveyNo();

        // Gather Step 1 data (Household Head Details)
        const dateApplied = document.getElementById('dateApplied').value;
 
        
        const householdBirthday = document.getElementById('householdBirthday').value;
        const householdSex = document.getElementById('householdSex').value;
        const householdCivilStatus = document.getElementById('householdCivilStatus').value;
        const householdLastName = document.getElementById('householdLastName').value;
        const householdFirstName = document.getElementById('householdFirstName').value;
        const householdMiddleName = document.getElementById('householdMiddleName').value;
        const householdMaidenName = document.getElementById('householdMaidenName').value;
        const householdOccupation = document.getElementById('householdOccupation').value;
        const householdPlaceOfWork = document.getElementById('householdPlaceOfWork').value;
        const householdAddress = document.getElementById('householdAddress').value;

        // Spouse information (optional)
        const spouseLastName = document.getElementById('spouseLastName').value;
        const spouseFirstName = document.getElementById('spouseFirstName').value;
        const spouseMiddleName = document.getElementById('spouseMiddleName').value;
        const spouseMaidenName = document.getElementById('spouseMaidenName').value;
        const spouseBirthday = document.getElementById('spouseBirthday').value;

        // Additional Step 1 details
        const classificationOfSurveyHousehold = document.getElementById('classificationOfSurveyHousehold').value;
        
        const structureOwner = document.getElementById('structureOwner').value;
        const provinceOfOrigin = document.getElementById('provinceOfOrigin').value;
        const householdSize = document.getElementById('householdSize').value;
        const yearOfResidency = document.getElementById('yearOfResidency').value;
        const reasonsForEstablishing = document.getElementById('reasonsForEstablishing').value;

        const householdHeadName = `${householdLastName} ${householdFirstName} ${householdMiddleName} ${householdMaidenName}`;

        // Get appointment date (new field)
        const appointmentDate = document.getElementById('appointmentDate').value;

        

        try {
            const user = auth.currentUser;
            if (!user) {
                console.error("No user logged in.");
                return;
            }

            // Include household members from Step 2
            if (householdMembers.length === 0) {
                alert("Please add at least one household member.");
                return;
            }

            const housingDocRef = await addDoc(collection(db, "Housing"), {
                surveyNo,
                dateApplied,
    
           
                householdBirthday,
                householdSex,
                householdCivilStatus,
                householdHeadName,
                householdOccupation,
                householdPlaceOfWork,
                householdAddress,
                spouseName: `${spouseLastName} ${spouseFirstName} ${spouseMiddleName} ${spouseMaidenName}`,
                spouseBirthday,
                classificationOfSurveyHousehold,
             
                structureOwner,
                provinceOfOrigin,
                householdSize,
                yearOfResidency,
                reasonsForEstablishing,
                householdMembers,
                appointmentDate: appointmentDate ? Timestamp.fromDate(new Date(appointmentDate)) : null,
         
                ownerUid: user.uid,
                status: 'Pending',
                createdAt: Timestamp.now(),
            });

            await updateDoc(doc(db, 'users', user.uid), {
                housingApplications: arrayUnion({
                    applicationId: housingDocRef.id,
                    surveyNo,
                    status: 'Pending',
                }),
            });

            const housingModal = bootstrap.Modal.getInstance(document.getElementById('housingApplicationModal'));
            housingModal.hide();

            Swal.fire({
                title: "Success!",
                text: "Application Submitted",
                icon: "success"
            });

        } catch (error) {
            console.error("Error submitting housing application:", error);
            alert("Failed to submit application. Please try again later.");
        } finally {
            document.getElementById('loading-screen').style.display = 'none';
        }
    }, 100);
}





            let notificationsPerPage = 5; // Number of notifications per page
    let currentPage = 1; // Track the current page
    let totalPages = 1; // Total pages based on the number of notifications
    let lastVisibleDoc = null; // Keep track of the last document for pagination

    // Function to load client notifications with pagination
    async function loadClientNotifications(userId) {
        const notificationsRef = collection(db, "notifications");
        const notificationContainer = document.getElementById("notification-container");

        const prevPageBtn = document.getElementById("prevPageBtn");
        const nextPageBtn = document.getElementById("nextPageBtn");
        const pageInfo = document.getElementById("pageInfo");

        // Fetch total notifications for user to calculate total pages
        const allNotificationsSnapshot = await getDocs(query(
            notificationsRef,
            where("userId", "==", userId)
        ));

        const totalNotifications = allNotificationsSnapshot.size;
        totalPages = Math.ceil(totalNotifications / notificationsPerPage);

        // Query notifications for the current page, ordered by timestamp
        let notificationsQuery = query(
            notificationsRef,
            where("userId", "==", userId),
            orderBy("timestamp", "desc"),
            limit(notificationsPerPage)
        );

        // If it's not the first page, start after the last visible document
        if (lastVisibleDoc && currentPage > 1) {
            notificationsQuery = query(notificationsQuery, startAfter(lastVisibleDoc));
        }

        onSnapshot(notificationsQuery, (snapshot) => {
            notificationContainer.innerHTML = ''; // Clear previous notifications

            if (snapshot.docs.length === 0) {
                notificationContainer.innerHTML = '<p>No notifications available.</p>';
            }

            snapshot.forEach(doc => {pr
                const data = doc.data();
                const notification = document.createElement('div');
                notification.className = 'client-notification';
                
                // Apply bold style for unread notifications
                if (!data.read) {
                    notification.style.fontWeight = 'bold';
                }
                
                // Make notification clickable
                notification.innerHTML = `${data.message} <br><small>${new Date(data.timestamp.seconds * 1000).toLocaleString()}</small>`;
                notification.style.cursor = 'pointer';

                notification.addEventListener('click', async () => {
                    // Mark the notification as read in Firestore
                    await updateDoc(doc.ref, {
                        read: true
                    });
                    
                    // Remove the bold style
                    notification.style.fontWeight = 'normal';

                    // Reload unread notifications to update the badge
                    fetchUnreadNotifications(userId);
                });

                notificationContainer.appendChild(notification);
            });

            // Track the last visible document for pagination
            lastVisibleDoc = snapshot.docs[snapshot.docs.length - 1];

            // Update page info
            pageInfo.textContent = `Page ${currentPage} of ${totalPages}`;

            // Disable/enable pagination buttons
            prevPageBtn.disabled = currentPage === 1;
            nextPageBtn.disabled = currentPage === totalPages;
        });
    }

    // Function to fetch unread notifications and update the badge
    async function fetchUnreadNotifications(userId) {
        const notificationsRef = collection(db, "notifications");

        const unreadNotificationsQuery = query(
            notificationsRef,
            where("userId", "==", userId),
            where("read", "==", false)
        );

        const unreadSnapshot = await getDocs(unreadNotificationsQuery);
        const unreadCount = unreadSnapshot.size;

        updateNotificationBadge(unreadCount); // Update the badge
    }

    // Function to update the notification badge
    function updateNotificationBadge(unreadCount) {
        const badgeElement = document.getElementById('notification-badge');
        if (unreadCount > 0) {
            badgeElement.style.display = 'inline-block'; // Show the badge
            badgeElement.textContent = unreadCount;      // Set the count
        } else {
            badgeElement.style.display = 'none';         // Hide the badge if no unread notifications
        }
    }

    // Function to handle authentication state
    function handleAuthState() {
        const prevPageBtn = document.getElementById("prevPageBtn");
        const nextPageBtn = document.getElementById("nextPageBtn");

        onAuthStateChanged(auth, (user) => {
            if (user) {
                // User is signed in, get user ID and load notifications
                const userId = user.uid;

                // Load initial notifications
                loadClientNotifications(userId);

                // Fetch unread notifications to update the badge
                fetchUnreadNotifications(userId);

                // Handle "Previous Page" button click
                prevPageBtn.addEventListener("click", () => {
                    if (currentPage > 1) {
                        currentPage--;
                        lastVisibleDoc = null; // Reset last visible document when going to the previous page
                        loadClientNotifications(userId);
                    }
                });

                // Handle "Next Page" button click
                nextPageBtn.addEventListener("click", () => {
                    if (currentPage < totalPages) {
                        currentPage++;
                        loadClientNotifications(userId);
                    }
                });
            } else {
                console.error("User is not signed in.");
            }
        });
    }

    // Start monitoring authentication state when the DOM is fully loaded
    document.addEventListener('DOMContentLoaded', () => {
        handleAuthState();
    });

 

        </script>
        
        
        <!--Spouse Checkbox Script-->
        <script>
            document.addEventListener("DOMContentLoaded", function() {
                const spouseFields = [
                    document.getElementById("spouseLastName"),
                    document.getElementById("spouseFirstName"),
                    document.getElementById("spouseMiddleName"),
                    document.getElementById("spouseMaidenName"),
                    document.getElementById("spouseBirthday")
                ];
        
                const hasSpouseCheckbox = document.getElementById("hasSpouse");
        
                function toggleSpouseFields() {
                    const isChecked = hasSpouseCheckbox.checked;
                    spouseFields.forEach(field => {
                        field.disabled = !isChecked;
                    });
                }
        
                hasSpouseCheckbox.addEventListener("change", toggleSpouseFields);
            });
        </script>
        
        
<script>
    
    document.addEventListener("DOMContentLoaded", function () {
    // Set the default value for "Date Applied" to today's date
    const dateAppliedInput = document.getElementById("dateApplied");
    const today = new Date().toISOString().split('T')[0];
    dateAppliedInput.value = today;

    // Disable future dates and the current date for the household birthday and spouse birthday
    const householdBirthdayInput = document.getElementById("householdBirthday");
    const spouseBirthdayInput = document.getElementById("spouseBirthday");
    const minAgeDate = new Date();
    minAgeDate.setFullYear(minAgeDate.getFullYear() - 18); // At least 18 years old
    
    // Setting the max date for birthdates to ensure 18+ age
    const maxDate = minAgeDate.toISOString().split('T')[0];
    householdBirthdayInput.max = maxDate;
    spouseBirthdayInput.max = maxDate;
    
    // Disable today and future dates for the household and spouse birthday
    householdBirthdayInput.setAttribute('max', maxDate);
    spouseBirthdayInput.setAttribute('max', maxDate);

    // Enable or disable spouse fields based on the "hasSpouse" checkbox
    const hasSpouseCheckbox = document.getElementById("hasSpouse");
    const spouseFields = [
        document.getElementById("spouseLastName"),
        document.getElementById("spouseFirstName"),
        document.getElementById("spouseMiddleName"),
        document.getElementById("spouseMaidenName"),
        document.getElementById("spouseBirthday")
    ];

    hasSpouseCheckbox.addEventListener("change", function () {
        spouseFields.forEach(field => {
            field.disabled = !hasSpouseCheckbox.checked;
        });
    });
});

    </script>

<script>
    // Get the elements
    const memberEmployed = document.getElementById('memberEmployed');
    const memberOccupation = document.getElementById('memberOccupation');
    const memberPlaceOfWork = document.getElementById('memberPlaceOfWork');
    const memberMonthlyIncome = document.getElementById('memberMonthlyIncome');

    // Function to enable/disable fields based on employment status
    function toggleEmploymentFields() {
        if (memberEmployed.value === 'No') {
            memberOccupation.disabled = true;
            memberPlaceOfWork.disabled = true;
            memberMonthlyIncome.disabled = true;

            // Clear the values of the disabled fields
            memberOccupation.value = '';
            memberPlaceOfWork.value = '';
            memberMonthlyIncome.value = '';
        } else {
            memberOccupation.disabled = false;
            memberPlaceOfWork.disabled = false;
            memberMonthlyIncome.disabled = false;
        }
    }

    // Add event listener to the dropdown to trigger the function when the value changes
    memberEmployed.addEventListener('change', toggleEmploymentFields);

    // Run the function on page load to set the initial state
    toggleEmploymentFields();
</script>


    
    </body>
    </html>