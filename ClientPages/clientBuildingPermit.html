<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CHSD MIS</title>
    <link rel="stylesheet" href="/Stylesheets/style.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
   
    <style>
        /* CSS for the content container */
        .content {
            flex: 1; /* Take remaining space */
            overflow: hidden; /* Hide overflow content */
            display: flex; /* Use flexbox */
            flex-direction: column; /* Column layout */
        }

        .content-container {
            overflow-y: auto; /* Enable vertical scrolling */
            padding: 20px; /* Add some padding */
        }

        .wide-modal {
            max-width: 80%;
        }

        @media (max-width: 768px) {
    .wide-modal {
        max-width: 100% !important;
    }
}
   
        .wider-modal{
            max-width:90%;
        }

        .form-control {
            margin-bottom: 1rem; /* Add margin between form controls */
        }

        .form-check {
            margin-bottom: 0.5rem; /* Add margin between checkboxes */
        }

        .row.g-3 .col-md-6,
        .row.g-3 .col-md-4,
        .row.g-3 .col-md-12 {
            margin-bottom: 1rem; /* Add margin to columns */
        }

        .d-flex .me-2 {
            margin-right: 1rem; /* Add margin to the right of the input */
        }
        .required-asterisk {
    color: red;
    font-weight: bold;
}

    </style>

<style>
    .btn-upload {
    padding: 8px 16px;
    background-color: #4CAF50 !important;
    color: white !important;
    border: none;
    cursor: pointer !important;
}
.btn-upload:hover {
    background-color: #45a049;
}
.file-item {
    display: flex;
    align-items: center;
}
.file-name {
    margin-right: 10px;
}
.btn-delete {
    color: red;
    cursor: pointer;
}
    .content {
        flex: 1; 
        overflow: hidden; 
        display: flex;
        flex-direction: column; 
    }

    .content-container {
        overflow-y: auto; 
        padding: 20px; 
    }

    .wide-modal {
        max-width: 80%;
    }

    .form-control {
        margin-bottom: 1rem; 
    }

    .form-check {
        margin-bottom: 0.5rem; 
    }

    .row.g-3 .col-md-6,
    .row.g-3 .col-md-4,
    .row.g-3 .col-md-12 {
        margin-bottom: 1rem; 
    }

    .d-flex .me-2 {
        margin-right: 1rem; 
    }
    .upload-btn-wrapper {
        position: relative;
        overflow: hidden;
        display: inline-block;
    }

    .btn-upload {
        border: 2px solid #01b813;
        color: white;
        background-color: #007bff;
        padding: 5px 10px;
        border-radius: 5px;
        font-size: 14px;
        font-weight: bold;
    }

    .upload-btn-wrapper input[type=file] {
        font-size: 100px;
        position: absolute;
        left: 0;
        top: 0;
        opacity: 0;
    }

  
</style>
<style>
    .main-container {
      display: none; /* Hide content initially */
    }
  </style>
  
 
  
</head>
<body>
    <div id="loading-screen" class="loading-screen" style="display: none;">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
    </div>

    
    <div class="main-container d-flex">

        <!--Sidebar-->
        <div class="sideNav" id="side_nav">
            <div class="container">
                <div class="header-box text-center px-2 pt-3 pb-4 ">
                    <button class="btn d-md-none d-block close-btn px-1 py-0 text-black"><i class="fa-solid fa-bars-staggered"></i></button>
                    <div class="avatar-placeholder">
                        <img id="client-avatar" src="" alt="loading..." width="100" height="100">

                    </div>
                    <div class="avatar-text">
                        <!-- Client ID and Name -->
                        <div id="user-name">loading...</div>
                    </div>
                    
                </div>
            </div>
            <ul class="sideBarList list-unstyled px-2">
                <li class="sideNav"><a href="clientDashboard.html" class="text-decoration-none"><i class="fa-solid fa-circle-info"></i> Application Status</a></li>
                <li class="sideNav"><a href="clientRequirements.html" class="text-decoration-none"><i class="fa-solid fa-list"></i> Requirements List</a></li>
                
                <li class="sideNav dropdown open">
                    <a href="#" class="text-decoration-none"><i class="fa-solid fa-newspaper"></i> Application <i class="fas fa-caret-down"></i></a>
                    <ul class="submenu list-unstyled">
                        <li class="text-center mt-2 active"><a href="clientBuildingPermit.html" class="text-decoration-none">Building Permit</a></li>
                        <li class="text-center mt-2"><a href="clientOccupancyApplication.html" class="text-decoration-none">Occupancy</a></li>
                        <li class="text-center mt-2"><a href="clientElectricalApplication.html" class="text-decoration-none">Electrical Inspection</a></li>
                        <li class="text-center mt-2"><a href="clientHousingApplication.html" class="text-decoration-none">Housing</a></li>
                    </ul>
                </li>
               
                <li class="sideNav" id="user-logout-btn"><a href="#" class="text-decoration-none"><i class="fa-solid fa-right-from-bracket"></i> Log out</a></li>
            </ul>
        </div>
       

        <div class="content">
           

            <nav class="navigationBar navbar navbar-expand-lg bg-light">
                <div class="container-fluid">
                    <!-- Mobile View -->
                    <div class="d-flex justify-content-between d-md-none d-block">
                        <a class="navbar-brand d-flex align-items-center" href="#">
                            <img src="/resources/pictures/chsd.png" alt="CHSD" width="40" height="40" class="me-2">
                            <h5 class="mb-0 fs-5">CHSD</h5>
                        </a>
                        <button class="btn px-1 py-0 open-btn">
                            <i class="fa-solid fa-bars-staggered"></i>
                        </button>
                    </div>
            
                    <!-- Desktop View -->
                    <div class="collapse navbar-collapse d-none d-md-flex" id="navbarSupportedContent">
                        <a class="navbar-brand d-flex align-items-center" href="#">
                            <img src="/resources/pictures/chsd.png" alt="CHSD" width="75" height="75" class="me-2">
                            <h5 class="mb-0 fs-5 fs-lg-4">City Housing and Settlements Department</h5>
                        </a>
            
                        <!-- Right-aligned content: Notifications -->
                        <ul class="navbar-nav ms-auto">
                            <!-- Notifications Dropdown -->
                            <li class="nav-item dropdown">
                                <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                    <i class="fa-solid fa-bell"></i><span id="notification-badge" class="badge bg-danger" style="display: none;">0</span>
                                </a>
                                <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdown" style="width: 400px; padding: 15px;">
                                    <li>
                                        <h6 class="dropdown-header"></h6>
                                    </li>
                                    <li>
                                        <div class="notifications-container" id="notification-container" style="max-height: 400px; overflow-y: auto;">
                                            <!-- Notifications will be dynamically added here -->
                                        </div>
                                    </li>
                                    <li>
                                        <div class="dropdown-item text-center">
                                            <button id="prevPageBtn" class="btn btn-secondary btn-sm">Previous</button>
                                            <span id="pageInfo">Page 1</span>
                                            <button id="nextPageBtn" class="btn btn-secondary btn-sm">Next</button>
                                        </div>
                                    </li>
                                </ul>
                            </li>
                        </ul>
                    </div>
                </div>
            </nav>

            <div class="contentContainer">
                <div class="card text-center">
                    <div class="card-body">
                      <h5 class="card-title">Start Your Application</h5>
                      <p class="card-text">Click the button below to apply for a building permit.</p>
                      <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#buildingPermitModal">Apply</button>
                    </div>
                  </div>
                  
            </div>
        </div>
    </div>

   <!-- Application Modal -->
<div class="modal fade" id="buildingPermitModal" tabindex="-1" aria-labelledby="BuildingPermitModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable wide-modal">
        <div class="modal-content buldingPermitApplication">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="BuildingPermitModalLabel">Building Permit Application</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <!-- Application Modal Content -->
                <div class="container">
                   <!-- Step Progress Bar -->
                <div class="step-progress mb-4">
                    <div class="step completed">
                        <div class="circle"></div>
                        <div class="label">Form</div>
                    </div>
                    <div class="step">
                        <div class="circle"></div>
                        <div class="label">Upload Requirements</div>
                    </div>
                    <div class="step">
                        <div class="circle"></div>
                        <div class="label">Appointment</div>
                    </div>
                </div>
                    <form>
                        <p>Note: Fill up all the fields to proceed to the next step.</p>
                        <p><i>Required fields are marked with <span class="required-asterisk">*</span></i></p>
                       
                        <div class="row g-3">
                            
                            <div class="col-md-6">
                                <div class="input-group">
                                    <span class="input-group-text" id="basic-addon3">Issued on:</span>
                                    <input type="date" class="form-control" id="basic-url" aria-describedby="basic-addon3 basic-addon4">
                                </div>
                            </div>
                        </div>
                      <div class="row g-3">
    <label for="ownerName">Owner/Applicant Name:</label>
    <div class="col-md-3">
        <label for="ownerLastName">Last Name<span class="required-asterisk">*</span></label>
        <input type="text" class="form-control" id="ownerLastName" placeholder="Last Name" required>
    </div>
    <div class="col-md-3">
        <label for="ownerFirstName">First Name<span class="required-asterisk">*</span></label>
        <input type="text" class="form-control" id="ownerFirstName" placeholder="First Name*" required>
    </div>
    <div class="col-md-3">
        <label for="ownerMiddleName">Middle Name</label>
        <input type="text" class="form-control" id="ownerMiddleName" placeholder="Middle Name">
    </div>
    <div class="col-md-3">
        <label for="ownerMaidenName">Maiden Name</label>
        <input type="text" class="form-control" id="ownerMaidenName" placeholder="Maiden Name">
    </div>
</div>


<div class="mb-3">
   <div class="col-md-4">
    <label for="phoneNumber" class="form-label">Cellphone/Telephone Number<span class="required-asterisk">*</span></label>
    <input type="text" class="form-control" id="phoneNumber" required>
   </div>
</div>



                        <div class="row g-3">
                            <div class="col-md-6">
                                <label for="addressTelNo">Address<span class="required-asterisk">*</span></label>
                                <input type="text" class="form-control" id="addressTelNo" placeholder="Address*" required>
                            </div>


                            <div class="col-md-6">
                                <label for="projectLocation">Project Location<span class="required-asterisk">*</span></label>
                                <input type="text" class="form-control" id="projectLocation" placeholder="Project Location*" required>
                            </div>
                        </div>

                    
                        <div class="mb-3">
                            <div class="row g-3">
                                <label for="form-check" class="form-label">Scope of Work<span class="required-asterisk">*</span></label>
                                <div class="col-md-6">
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="scopeOfWork" value="option1" id="option1" required>
                                        <label class="form-check-label" for="option1">New Construction</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="scopeOfWork" value="option2" id="option2" required>
                                        <label class="form-check-label" for="option2">Addition</label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="scopeOfWork" value="option3" id="option3" required>
                                        <label class="form-check-label" for="option3">Repair Renovation</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="scopeOfWork" value="option4" id="option4" required onclick="toggleOtherScopeInput()">
                                        <label class="form-check-label" for="option4">Others</label>
                                        <input type="text" class="form-control mt-2" id="otherScopeInput" placeholder="Specify" disabled>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <div class="row g-3">
                                <label for="form-check" class="form-label">Project Justification<span class="required-asterisk">*</span></label>
                                <div class="col-md-6">
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="projectJustification" value="justification1" id="justification1" required>
                                        <label class="form-check-label" for="justification1">Single Attached/Semi-Attached/Duplex</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="projectJustification" value="justification2" id="justification2" required>
                                        <label class="form-check-label" for="justification2">Single/Detached</label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="projectJustification" value="justification3" id="justification3" required>
                                        <label class="form-check-label" for="justification3">Row House/Multi-family Dwelling</label>
                                    </div>
                                </div>
                            </div>
                        
                        
                            <div class="row mb-3">
                                <div class="col">
                                    <label for="blockNumber">Block Number<span class="required-asterisk">*</span></label>
                                    <input type="number" class="form-control" placeholder="Block number" id="blockNumber" required>
                                </div>
                                <div class="col">
                                    <label for="lotNumber">Lot Number<span class="required-asterisk">*</span></label>
                                    <input type="number" class="form-control" placeholder="Lot number"  id="lotNumber" required>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col">
                                    <label for="NOUnits">Number of Units<span class="required-asterisk">*</span></label>
                                    <input type="number" class="form-control" placeholder="No. of Units" id="NOUnits" required>
                                </div>
                                <div class="col">
                                    <label for="FloorArea">Floor Area Per Unit<span class="required-asterisk">*</span></label>
                                    <input type="number" class="form-control" placeholder="Floor Area Per Unit" id="FloorArea" required>
                                </div>
                                <div class="col">
                                    <label for="TotalFloorArea">Total Floor Area<span class="required-asterisk">*</span></label>
                                    <input type="number" class="form-control" placeholder="Total Floor Area" id="TotalFloorArea" required>
                                </div>
                                <div class="col">
                                    <label for="TotalEstimatedCost">Total Estimated Cost<span class="required-asterisk">*</span></label>
                                    <input type="number" class="form-control" placeholder="Total Estimated Cost" id="TotalEstimatedCost" required>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
               
                <button type="button" id="nextStepButton" class="btn btn-primary">Next</button>
               
            </div>
        </div>
    </div>
</div>
              </div>
                <!-- End of Bootstrap Table -->
            </div>
        </div>
    </div>

    

  
  <!--Building Permit Upload Modal -->
  <div class="modal fade" id="buildingPermitUpload" tabindex="-1" aria-labelledby="buildingPermitUploadLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable wide-modal">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="exampleModalLabel">Building Permit Application</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <!-- Step Progress Bar -->
          <div class="step-progress mb-4">
            <div class="step completed">
                <div class="circle"></div>
                <div class="label">Form</div>
            </div>
            <div class="step completed">
                <div class="circle"></div>
                <div class="label">Upload Requirements</div>
            </div>
            <div class="step">
                <div class="circle"></div>
                <div class="label">Appointment</div>
            </div>
        </div>
        <!--Content-->
        <table class="table">
            <thead>
                <tr>
                    <th>Requirements</th>
                    <th>File</th>
                    
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Building Plan</td>
                    <td class="file-column">
                        <div class="upload-btn-wrapper" style="display: flex; align-items: center;">
                            <div class="drag-drop-area" style="border: 1px dashed #ccc; padding: 10px; margin-right: 10px;" 
                                 ondrop="handleDrop(event, 'buildingPlanFile')" ondragover="handleDragOver(event)">
                                <p>Drag & drop file</p>
                            </div>
                            <button class="btn btn-upload" style="margin-left: 10px;" onclick="document.getElementById('buildingPlanFile').click()">Upload</button>
                            <input type="file" class="file-input" id="buildingPlanFile" style="display: none;" onchange="uploadFile(this)">
                            <div id="buildingPlanFileName" class="file-column"></div>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td>Proof of Ownership</td>
                    <td class="file-column">
                        <div class="upload-btn-wrapper" style="display: flex; align-items: center;">
                            <div class="drag-drop-area" style="border: 1px dashed #ccc; padding: 10px; margin-right: 10px;" 
                                 ondrop="handleDrop(event, 'proofOwnershipFile')" ondragover="handleDragOver(event)">
                                <p>Drag & drop file</p>
                            </div>
                            <button class="btn btn-upload" style="margin-left: 10px;" onclick="document.getElementById('proofOwnershipFile').click()">Upload</button>
                            <input type="file" class="file-input" id="proofOwnershipFile" style="display: none;" onchange="uploadFile(this)">
                            <div id="proofOwnershipFileName" class="file-column"></div>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td>Photocopy of Tax Declaration & Current Tax Receipt</td>
                    <td class="file-column">
                        <div class="upload-btn-wrapper" style="display: flex; align-items: center;">
                            <div class="drag-drop-area" style="border: 1px dashed #ccc; padding: 10px; margin-right: 10px;" ondrop="handleDrop(event, 'taxReceiptFile')" ondragover="handleDragOver(event)">
                                <p>Drag & drop file</p>
                            </div>
                            <button class="btn btn-upload" style="margin-left: 10px;" onclick="document.getElementById('taxReceiptFile').click()">Upload</button>
                            <input type="file" class="file-input" id="taxReceiptFile" style="display: none;" onchange="uploadFile(this)">
                            <div id="taxReceiptFileName" class="file-column"></div>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td>Brgy. Clearance of Building Permit</td>
                    <td class="file-column">
                        <div class="upload-btn-wrapper" style="display: flex; align-items: center;">
                            <div class="drag-drop-area" style="border: 1px dashed #ccc; padding: 10px; margin-right: 10px;" ondrop="handleDrop(event, 'brgyClearanceFile')" ondragover="handleDragOver(event)">
                                <p>Drag & drop file</p>
                            </div>
                            <button class="btn btn-upload" style="margin-left: 10px;" onclick="document.getElementById('brgyClearanceFile').click()">Upload</button>
                            <input type="file" class="file-input" id="brgyClearanceFile" style="display: none;" onchange="uploadFile(this)">
                            <div id="brgyClearanceFileName" class="file-column"></div>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td>Bill of Materials & Specification</td>
                    <td class="file-column">
                        <div class="upload-btn-wrapper" style="display: flex; align-items: center;">
                            <div class="drag-drop-area" style="border: 1px dashed #ccc; padding: 10px; margin-right: 10px;" ondrop="handleDrop(event, 'billMaterialsFile')" ondragover="handleDragOver(event)">
                                <p>Drag & drop file</p>
                            </div>
                            <button class="btn btn-upload" style="margin-left: 10px;" onclick="document.getElementById('billMaterialsFile').click()">Upload</button>
                            <input type="file" class="file-input" id="billMaterialsFile" style="display: none;" onchange="uploadFile(this)">
                            <div id="billMaterialsFileName" class="file-column"></div>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td>Photocopy of PRC IC/PTR of all signing engineers</td>
                    <td class="file-column">
                        <div class="upload-btn-wrapper" style="display: flex; align-items: center;">
                            <div class="drag-drop-area" style="border: 1px dashed #ccc; padding: 10px; margin-right: 10px;" ondrop="handleDrop(event, 'prcFile')" ondragover="handleDragOver(event)">
                                <p>Drag & drop file</p>
                            </div>
                            <button class="btn btn-upload" style="margin-left: 10px;" onclick="document.getElementById('prcFile').click()">Upload</button>
                            <input type="file" class="file-input" id="prcFile" style="display: none;" onchange="uploadFile(this)">
                            <div id="prcFileName" class="file-column"></div>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td>Certification of Exemption Location Clearance from CPDO</td>
                    <td class="file-column">
                        <div class="upload-btn-wrapper" style="display: flex; align-items: center;">
                            <div class="drag-drop-area" style="border: 1px dashed #ccc; padding: 10px; margin-right: 10px;" ondrop="handleDrop(event, 'certExemptionFile')" ondragover="handleDragOver(event)">
                                <p>Drag & drop file</p>
                            </div>
                            <button class="btn btn-upload" style="margin-left: 10px;" onclick="document.getElementById('certExemptionFile').click()">Upload</button>
                            <input type="file" class="file-input" id="certExemptionFile" style="display: none;" onchange="uploadFile(this)">
                            <div id="certExemptionFileName" class="file-column"></div>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td>Structural Analysis (2-Storey and up)</td>
                    <td class="file-column">
                        <div class="upload-btn-wrapper" style="display: flex; align-items: center;">
                            <div class="drag-drop-area" style="border: 1px dashed #ccc; padding: 10px; margin-right: 10px;" ondrop="handleDrop(event, 'structuralAnalysisFile')" ondragover="handleDragOver(event)">
                                <p>Drag & drop file</p>
                            </div>
                            <button class="btn btn-upload" style="margin-left: 10px;" onclick="document.getElementById('structuralAnalysisFile').click()">Upload</button>
                            <input type="file" class="file-input" id="structuralAnalysisFile" style="display: none;" onchange="uploadFile(this)">
                            <div id="structuralAnalysisFileName" class="file-column"></div>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td>Fire Clearance</td>
                    <td class="file-column">
                        <div class="upload-btn-wrapper" style="display: flex; align-items: center;">
                            <div class="drag-drop-area" style="border: 1px dashed #ccc; padding: 10px; margin-right: 10px;" ondrop="handleDrop(event, 'fireClearanceFile')" ondragover="handleDragOver(event)">
                                <p>Drag & drop file</p>
                            </div>
                            <button class="btn btn-upload" style="margin-left: 10px;" onclick="document.getElementById('fireClearanceFile').click()">Upload</button>
                            <input type="file" class="file-input" id="fireClearanceFile" style="display: none;" onchange="uploadFile(this)">
                            <div id="fireClearanceFileName" class="file-column"></div>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td>Boring Test</td>
                    <td class="file-column">
                        <div class="upload-btn-wrapper" style="display: flex; align-items: center;">
                            <div class="drag-drop-area" style="border: 1px dashed #ccc; padding: 10px; margin-right: 10px;" ondrop="handleDrop(event, 'boringTestFile')" ondragover="handleDragOver(event)">
                                <p>Drag & drop file</p>
                            </div>
                            <button class="btn btn-upload" style="margin-left: 10px;" onclick="document.getElementById('boringTestFile').click()">Upload</button>
                            <input type="file" class="file-input" id="boringTestFile" style="display: none;" onchange="uploadFile(this)">
                            <div id="boringTestFileName" class="file-column"></div>
                        </div>
                    </td>
                </tr>
            </tbody>
            
            
        </table>
        </div>
        <div class="modal-footer">
        

                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="previousStepButton">Previous</button>
                <button id="nextStepButton2" class="btn btn-primary" type="button">Next</button>
        </div>
      </div>
    </div>
  </div>


 <!-- Appointment Modal -->
<div class="modal fade" id="appointmentModal" tabindex="-1" aria-labelledby="appointmentModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable wide-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title fs-5" id="exampleModalLabel">Appointment Schedule</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <!-- Step Progress Bar -->
                <div class="step-progress mb-4">
                    <div class="step completed">
                        <div class="circle"></div>
                        <div class="label">Form</div>
                    </div>
                    <div class="step completed">
                        <div class="circle"></div>
                        <div class="label">Upload Requirements</div>
                    </div>
                    <div class="step completed">
                        <div class="circle"></div>
                        <div class="label">Appointment</div>
                    </div>
                </div>
                <!-- Content -->
                <div class="container">
                    <h5 class="text-center mt-5 mb-4">Appointment Schedule</h5>
                    <p class="text-center"><i>Note: Please select only weekdays.</i></p>
                    
                    <div class="row">
                        <div class="col-md-3"></div> <!-- Empty column for spacing -->

                        <div class="row justify-content-center">
                          <div class="col-md-6">
                            <label for="appointmentDate">
                                Date
                            </label>
                            <input type="date" class="form-control" id="appointmentDate">
                          </div>
                           </div>
                        <div class="col-md-3"></div> <!-- Empty column for spacing -->
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="previousStepButton2">Previous</button>
                <button type="button" class="btn btn-primary" id="submitProfile">Finish</button>
            </div>
        </div>
    </div>
</div>

<!-- Appointment Modal 2 -->
<div class="modal fade" id="appointmentModal2" tabindex="-1" role="dialog" aria-labelledby="appointmentModalLabel2" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="appointmentModalLabel">Book Appointment</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p id="selectedDateTime"></p>
                <button type="button" class="btn btn-primary" id="bookAppointmentBtn">Book Appointment</button>
            </div>
        </div>
    </div>
</div>

    <!-- Remarks Modal -->
    <div class="modal fade" id="viewRemarks" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="exampleModalLabel">Remarks</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>Hello, please wait for the approval of your application, thank you!</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Ok</button>
                </div>
            </div>
        </div>
    </div>


<!-- Application Applied Modal -->
<div class="modal fade" id="applicationAppliedModal" tabindex="-1" aria-labelledby="ApplicationAppliedModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="ApplicationAppliedModalLabel"><i class="fa-solid fa-check-circle"></i> Success</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body text-center">
                <h2>Application Submitted</h2>
                <i class="fa-solid fa-check-circle fa-3x text-success"></i>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<!-- Privacy Policy Modal -->
<div class="modal fade" id="privacyPolicyModal" tabindex="-1" aria-labelledby="privacyPolicyModalLabel" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog modal-dialog-centered wide-modal">
      <div class="modal-content johnowen">
        <div class="modal-header">
          <h5 class="modal-title" id="privacyPolicyModalLabel">Privacy Policy and Terms of Service</h5>
       
        </div>
        <div class="modal-body" id="privacyPolicyContent" style="max-height: 400px; overflow-y: auto;">
          <h5>Privacy Policy</h5>
          <p>We are committed to protecting your privacy. This privacy policy explains how we collect, use, and share your personal information when you apply for building permits through our system. By submitting your application, you consent to our privacy policy and the collection, use, and sharing of your information as described here.</p>

          <ul>
            <li><b>Information Collection:</b> We collect personal data such as name, address, phone number, email, and project details for the sole purpose of processing your building permit application.</li>
            <li><b>Use of Data:</b> The collected data is used to process your permit, communicate with you, and keep you updated on your application's status.</li>
            <li><b>Data Sharing:</b> Your data will not be shared with third parties except where required by law or necessary for completing the application process.</li>
          </ul>

          <h5>Terms and Conditions</h5>
          <p>By using this service, you agree to the following terms and conditions:</p>
          <ul>
            <li>You will provide accurate and truthful information in your application.</li>
            <li>You understand that the processing of your permit may take several days depending on the complexity of the application.</li>
            <li>You are responsible for any fees or charges associated with your application.</li>
            <li>Any attempt to provide fraudulent information may result in legal consequences.</li>
          </ul>
        </div>
        <div class="modal-footer d-flex justify-content-between align-items-center">
            <div class="form-check testingPrivacy me-3">
              <input class="form-check-input" type="checkbox" id="termsCheckbox">
              <label class="form-check-label" for="termsCheckbox">
                I have read and agree to the Privacy Policy and Terms and Conditions
              </label>
            </div>
            <div>
              <a type="button" class="btn btn-secondary text-white me-2" href="clientApplication.html">Back</a>
              <button type="button" class="btn btn-primary" id="acceptPolicyButton" disabled>Proceed</button>
            </div>
          </div>
          
      </div>
    </div>
  </div>


  <script>
    document.addEventListener('DOMContentLoaded', () => {
    // Prevent dropdown from closing when clicking on buttons or notifications
    document.querySelectorAll('.dropdown-menu').forEach(dropdown => {
        dropdown.addEventListener('click', (event) => {
            if (event.target.closest('.btn') || event.target.closest('.client-notification')) {
                event.stopPropagation();
            }
        });
    });

    handleAuthState();
});

  </script>
<!--Download PDF and Excel Libraries-->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>
<script>
    // Disable the nextStepButton until all required fields are occupied
    document.addEventListener("DOMContentLoaded", function () {
    const nextStepButton = document.getElementById("nextStepButton");

    // Function to check if all required fields are filled
    function checkRequiredFields() {
        const requiredFields = document.querySelectorAll("#buildingPermitModal [required]");
        let allFilled = true;

        requiredFields.forEach((field) => {
            if (!field.value.trim()) {
                allFilled = false;
            }
        });

        nextStepButton.disabled = !allFilled; // Disable button if not all fields are filled
    }

    // Attach event listeners to all required fields
    const requiredFields = document.querySelectorAll("#buildingPermitModal [required]");
    requiredFields.forEach((field) => {
        field.addEventListener("input", checkRequiredFields);
    });

    // Initially disable the button
    nextStepButton.disabled = true;
});

</script>
<script>
// Disable the "Proceed" button until the user scrolls to the bottom and checks the checkbox
const modalContent = document.getElementById('privacyPolicyContent');
const acceptPolicyButton = document.getElementById('acceptPolicyButton');
const termsCheckbox = document.getElementById('termsCheckbox');

function updateProceedButton() {
  // Enable the button if the user has scrolled to the bottom and checked the box
  const isScrolledToBottom = modalContent.scrollHeight - modalContent.scrollTop === modalContent.clientHeight;
  const isCheckboxChecked = termsCheckbox.checked;
  acceptPolicyButton.disabled = !(isScrolledToBottom && isCheckboxChecked);
}

// Add scroll event listener to check if the user has scrolled to the bottom
modalContent.addEventListener('scroll', updateProceedButton);

// Add change event listener for checkbox
termsCheckbox.addEventListener('change', updateProceedButton);
</script>




    <!-- Firebase and custom scripts -->
    <script type="module" src="/Database/firebase.js"></script>

  
   
   
    

    <!-- Bootstrap and other scripts -->
  
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.min.js" integrity="sha384-cuYeSxntonz0PPNlHhBs68uyIAVpIIOZZ5JqeqvYYIcEL727kskC66kF92t6Xl2V" crossorigin="anonymous"></script>
    <script src="/ClientPages/navBarScript.js"></script>


    <script>
        document.querySelector('.open-btn').addEventListener('click', function() {
            document.getElementById('side_nav').classList.add('active');
        });
    
        document.querySelector('.close-btn').addEventListener('click', function() {
            document.getElementById('side_nav').classList.remove('active');
        });
    </script>

<script>
    document.getElementById('phoneNumber').addEventListener('input', function(e) {
        let value = e.target.value;

        // Ensure that the phone number starts with +63
        if (!value.startsWith('+63')) {
            e.target.value = '+63';
        }
    });
</script>


<script>
    document.addEventListener("DOMContentLoaded", function() {
    var sideNav = document.getElementById('side_nav');
    var openBtn = document.querySelector('.open-btn');
    var closeBtn = document.querySelector('.close-btn');
    var dropdownItems = document.querySelectorAll('.sideNav.dropdown');

    // Toggle the sidebar for mobile view
    openBtn.addEventListener('click', function() {
        sideNav.classList.add('active');
    });

    closeBtn.addEventListener('click', function() {
        sideNav.classList.remove('active');
    });

    // Handle dropdown in sidebar
    dropdownItems.forEach(function(item) {
        item.addEventListener('click', function(e) {
            e.stopPropagation(); // Prevents clicks from closing the sidebar
            this.classList.toggle('open');
        });
    });

    // Close the sidebar when clicking outside of it (optional)
    document.addEventListener('click', function(e) {
        if (!sideNav.contains(e.target) && !openBtn.contains(e.target)) {
            sideNav.classList.remove('active');
        }
    });
});


    </script>

<script>
    document.addEventListener('DOMContentLoaded', function () {
      if (localStorage.getItem('privacyPolicyAccepted')) {
        document.querySelector('.main-container').style.display = 'flex'; // Show content
      }
    });
  </script>




    
<script>
    // Function to handle file upload
    function uploadFile(input, file = null) {
        const selectedFile = file || input.files[0];  // Use the file from input or passed as an argument

        if (selectedFile) {
            const maxSizeMB = 5;  // Set max file size (in MB)
            const allowedTypes = ['image/jpeg', 'image/png', 'application/pdf'];  // Allowed file types

            // Validate file type
            if (!allowedTypes.includes(selectedFile.type)) {
                alert('Invalid file type. Please upload a JPG, PNG, or PDF file.');
                input.value = '';  // Clear the input
                return;
            }

            // Validate file size
            const maxSizeBytes = maxSizeMB * 1024 * 1024;  // Convert MB to bytes
            if (selectedFile.size > maxSizeBytes) {
                alert(`File is too large. Please upload a file smaller than ${maxSizeMB}MB.`);
                input.value = '';  // Clear the input
                return;
            }

            // FileReader to read file details
            const reader = new FileReader();
            reader.onload = function () {
                const fileName = selectedFile.name;
                const fileSize = formatBytes(selectedFile.size);
                const fileItem = `
                    <div class="file-item">
                        <span class="file-name">${fileName} (${fileSize})</span>
                        <span class="btn-delete" onclick="deleteFile(this, '${input.id}')">Delete</span>
                    </div>`;

                // Display file information
                const fileColumn = input.closest('.upload-btn-wrapper').querySelector('.file-column');
                fileColumn.innerHTML = fileItem;  // Display file name and delete option
            };
            reader.readAsDataURL(selectedFile);  // Read the file as a data URL
        }
    }

    // Function to delete the uploaded file
    function deleteFile(deleteBtn, inputId) {
        const fileItem = deleteBtn.closest('.file-item');
        if (fileItem) {
            fileItem.remove();  // Remove the displayed file item
            document.getElementById(inputId).value = '';  // Clear the input for re-upload
        }
    }

    // Format file size to a readable string
    function formatBytes(bytes, decimals = 2) {
        if (bytes === 0) return '0 Bytes';
        const k = 1024;
        const dm = decimals < 0 ? 0 : decimals;
        const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB'];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i];
    }

    // Drag-over handler to show drag-and-drop action
    function handleDragOver(event) {
        event.preventDefault();
        event.stopPropagation();
        event.dataTransfer.dropEffect = 'copy';  // Change the cursor to indicate a drop is possible
    }

    // Drop handler to process the dropped files
    function handleDrop(event, inputId) {
        event.preventDefault();
        event.stopPropagation();

        const files = event.dataTransfer.files;  // Get the dropped files
        const inputFileElement = document.getElementById(inputId);  // Get the corresponding file input element

        if (inputFileElement && files.length > 0) {
            limitFiles(inputFileElement, 5, files);  // Limit the number of dropped files and handle each
        }
    }

    // Limit the number of files
    function limitFiles(input, maxFiles = 5, fileList = null) {
        const files = fileList || input.files;
        if (files.length > maxFiles) {
            alert(`You can only upload up to ${maxFiles} files.`);
            input.value = '';  // Clear the input
            return;
        }

        for (let i = 0; i < files.length; i++) {
            uploadFile(input, files[i]);  // Process each file
        }
    }
</script>


<script>
    // Function to format the date as YYYY-MM-DD
    function formatDate(date) {
        const year = date.getFullYear();
        const month = String(date.getMonth() + 1).padStart(2, '0'); // Months are 0-based
        const day = String(date.getDate()).padStart(2, '0');
        return `${year}-${month}-${day}`;
    }

    // Get today's date and set it as the default value
    const today = new Date();
    const dateInput = document.getElementById('basic-url');
    dateInput.value = formatDate(today);
</script>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Show the privacy policy modal every time the page is loaded
        var privacyModal = new bootstrap.Modal(document.getElementById('privacyPolicyModal'));
        privacyModal.show();
  
        // Handle the "Proceed" button click
        document.getElementById('acceptPolicyButton').addEventListener('click', function () {
            // Hide the privacy policy modal
            var privacyModalEl = document.getElementById('privacyPolicyModal');
            var privacyModalInstance = bootstrap.Modal.getInstance(privacyModalEl);
            privacyModalInstance.hide();
            
            // Show the building permit modal
            var buildingPermitModal = new bootstrap.Modal(document.getElementById('buildingPermitModal'));
            buildingPermitModal.show();
        });
    });
</script>

<!--Toggle Others-->
<script>
    function toggleOtherScopeInput() {
    const otherInput = document.getElementById("otherScopeInput");
    const otherRadio = document.getElementById("option4");

    if (otherRadio.checked) {
        otherInput.disabled = false;
    } else {
        otherInput.disabled = true;
        otherInput.value = '';  // Clear the input if disabled
    }
}

// Call the function on page load to ensure the state is correct
window.onload = toggleOtherScopeInput;



</script>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { getFirestore, collection, addDoc, serverTimestamp, updateDoc, doc, getDocs, where, onSnapshot, query, orderBy, limit, startAfter} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
    import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-storage.js";

    const firebaseConfig = {
        apiKey: "AIzaSyBhvoPidRWGeJmnN2E11SBS5n8oyxVLJ0M",
        authDomain: "chsd-mis.firebaseapp.com",
        projectId: "chsd-mis",
        storageBucket: "chsd-mis.appspot.com",
        messagingSenderId: "694967679357",
        appId: "1:694967679357:web:65cffd50f13739f934f414",
        measurementId: "G-XBQTQFRLJ5"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const storage = getStorage(app);

    document.addEventListener('DOMContentLoaded', () => {
    document.getElementById('submitProfile').addEventListener('click', async (event) => {
        event.preventDefault();

        const issuedOn = document.getElementById('basic-url').value.trim();
        const addressTelNo = document.getElementById('addressTelNo').value.trim();
        const projectLocation = document.getElementById('projectLocation').value.trim();
        const phoneNumber = document.getElementById('phoneNumber').value.trim();
        const ownerLastName = document.getElementById('ownerLastName').value.trim();
        const ownerFirstName = document.getElementById('ownerFirstName').value.trim();
        const ownerMiddleName = document.getElementById('ownerMiddleName').value.trim();
        const ownerMaidenName = document.getElementById('ownerMaidenName').value.trim();
        const appointmentDate = document.getElementById('appointmentDate').value;

        const ownerName = `${ownerLastName} ${ownerFirstName} ${ownerMiddleName} ${ownerMaidenName}`.trim();
        
        const scopeOfWork = document.querySelector('input[name="scopeOfWork"]:checked').nextElementSibling.textContent;
        const projectJustification = document.querySelector('input[name="projectJustification"]:checked').nextElementSibling.textContent;
        
        const otherScopeInput = document.getElementById("otherScopeInput").value;
        const finalScopeOfWork = (scopeOfWork === 'Others' && otherScopeInput) ? otherScopeInput : scopeOfWork;
       
        const blockNumber = document.getElementById("blockNumber").value;
        const lotNumber = document.getElementById("lotNumber").value;
        const NOUnits = document.getElementById("NOUnits").value;
        const FloorArea = document.getElementById("FloorArea").value;
        const TotalFloorArea = document.getElementById("TotalFloorArea").value;
        const TotalEstimatedCost = document.getElementById("TotalEstimatedCost").value;

        const requiredFields = [
            { field: issuedOn, name: 'Issued On' },
            { field: addressTelNo, name: 'Address/Tel No' },
            { field: projectLocation, name: 'Project Location' },
            { field: phoneNumber, name: 'Phone Number' },
            { field: ownerName, name: 'Owner Name' },
            { field: appointmentDate, name: 'Appointment Date' }
        ];

        for (const { field, name } of requiredFields) {
            if (!field) {
                alert(`Please fill out the ${name} field.`);
                return;
            }
        }

        const requiredFileInputs = [
            { id: 'buildingPlanFile', name: 'Building Plan' },
            { id: 'proofOwnershipFile', name: 'Proof of Ownership' },
            { id: 'taxReceiptFile', name: 'Photocopy of Tax Declaration & Current Tax Receipt' },
            { id: 'brgyClearanceFile', name: 'Brgy. Clearance of Building Permit' },
            { id: 'billMaterialsFile', name: 'Bill of Materials & Specification' },
            { id: 'prcFile', name: 'Photocopy of PRC IC/PTR of all signing engineers' },
            { id: 'certExemptionFile', name: 'Certification of Exemption Location Clearance from CPDO' },
            { id: 'structuralAnalysisFile', name: 'Structural Analysis (2-Storey and up)' }
        ];

        for (const { id, name } of requiredFileInputs) {
            const fileInput = document.getElementById(id);
            if (!fileInput || !fileInput.files[0]) {
                alert(`Please upload the ${name} file.`);
                return;
            }
        }

        const loadingScreen = document.getElementById('loading-screen');
        if (loadingScreen) {
            loadingScreen.style.display = 'flex';
        }

        try {
            const user = await new Promise((resolve, reject) => {
                onAuthStateChanged(auth, user => {
                    if (user) {
                        resolve(user);
                    } else {
                        reject(new Error("No user is authenticated."));
                    }
                }, reject);
            });

            const userId = user.uid;

            const permitData = {
                appointmentDate: new Date(appointmentDate),
                issuedOn,
                ownerName,
                phoneNumber,
                addressTelNo,
                projectLocation,
                scopeOfWork: finalScopeOfWork,
                projectJustification,
                ownerUid: userId,
                status: 'Pending',
                blockNumber,
                lotNumber,
                NOUnits,
                FloorArea,
                TotalFloorArea,
                TotalEstimatedCost,
                createdAt: serverTimestamp(),
            };

            // Create the building permit document in Firestore
            const permitDocRef = await addDoc(collection(db, "buildingPermits"), permitData);
            const permitId = permitDocRef.id; // Get the newly created document ID

            console.log("Document written with ID:", permitId);

            // Use the permitId for storage path
            const storagePath = `buildingPermits/${permitId}`;

            const filesToUpload = requiredFileInputs.map(file => ({
                inputId: file.id,
                namePrefix: file.name.replace(/\s+/g, '')
            }));

            const uploadPromises = filesToUpload.map(async file => {
                const fileInput = document.getElementById(file.inputId);
                if (fileInput && fileInput.files[0]) {
                    const file = fileInput.files[0];
                    const fileRef = ref(storage, `${storagePath}/${file.namePrefix}_${file.name}`);
                    const snapshot = await uploadBytes(fileRef, file);
                    return getDownloadURL(snapshot.ref);
                } else {
                    return null;
                }
            });

            const fileURLs = await Promise.all(uploadPromises);

            const fileURLMapping = {
                buildingPlanURL: fileURLs[0],
                proofOwnershipURL: fileURLs[1],
                taxReceiptURL: fileURLs[2],
                brgyClearanceURL: fileURLs[3],
                billMaterialsURL: fileURLs[4],
                prcURL: fileURLs[5],
                certExemptionURL: fileURLs[6],
                structuralAnalysisURL: fileURLs[7]
            };

            // Update the permit document with file URLs directly in the same document
            const permitDoc = doc(db, "buildingPermits", permitId);
            await updateDoc(permitDoc, fileURLMapping);

            var modal = new bootstrap.Modal(document.getElementById('applicationAppliedModal'));
            modal.show();

            window.location.reload();

        } catch (error) {
            console.error("Error during submission:", error);
            alert(`Error submitting application: ${error.message}`);
        } finally {
            if (loadingScreen) {
                loadingScreen.style.display = 'none';
            }
        }
    });
});

    



    let notificationsPerPage = 5; // Number of notifications per page
    let currentPage = 1; // Track the current page
    let totalPages = 1; // Total pages based on the number of notifications
    let lastVisibleDoc = null; // Keep track of the last document for pagination

    // Function to load client notifications with pagination
    async function loadClientNotifications(userId) {
        const notificationsRef = collection(db, "notifications");
        const notificationContainer = document.getElementById("notification-container");

        const prevPageBtn = document.getElementById("prevPageBtn");
        const nextPageBtn = document.getElementById("nextPageBtn");
        const pageInfo = document.getElementById("pageInfo");

        // Fetch total notifications for user to calculate total pages
        const allNotificationsSnapshot = await getDocs(query(
            notificationsRef,
            where("userId", "==", userId)
        ));

        const totalNotifications = allNotificationsSnapshot.size;
        totalPages = Math.ceil(totalNotifications / notificationsPerPage);

        // Query notifications for the current page, ordered by timestamp
        let notificationsQuery = query(
            notificationsRef,
            where("userId", "==", userId),
            orderBy("timestamp", "desc"),
            limit(notificationsPerPage)
        );

        // If it's not the first page, start after the last visible document
        if (lastVisibleDoc && currentPage > 1) {
            notificationsQuery = query(notificationsQuery, startAfter(lastVisibleDoc));
        }

        onSnapshot(notificationsQuery, (snapshot) => {
            notificationContainer.innerHTML = ''; // Clear previous notifications

            if (snapshot.docs.length === 0) {
                notificationContainer.innerHTML = '<p>No notifications available.</p>';
            }

            snapshot.forEach(doc => {
                const data = doc.data();
                const notification = document.createElement('div');
                notification.className = 'client-notification';
                
                // Apply bold style for unread notifications
                if (!data.read) {
                    notification.style.fontWeight = 'bold';
                }
                
                // Make notification clickable
                notification.innerHTML = `${data.message} <br><small>${new Date(data.timestamp.seconds * 1000).toLocaleString()}</small>`;
                notification.style.cursor = 'pointer';

                notification.addEventListener('click', async () => {
                    // Mark the notification as read in Firestore
                    await updateDoc(doc.ref, {
                        read: true
                    });
                    
                    // Remove the bold style
                    notification.style.fontWeight = 'normal';

                    // Reload unread notifications to update the badge
                    fetchUnreadNotifications(userId);
                });

                notificationContainer.appendChild(notification);
            });

            // Track the last visible document for pagination
            lastVisibleDoc = snapshot.docs[snapshot.docs.length - 1];

            // Update page info
            pageInfo.textContent = `Page ${currentPage} of ${totalPages}`;

            // Disable/enable pagination buttons
            prevPageBtn.disabled = currentPage === 1;
            nextPageBtn.disabled = currentPage === totalPages;
        });
    }

    // Function to fetch unread notifications and update the badge
    async function fetchUnreadNotifications(userId) {
        const notificationsRef = collection(db, "notifications");

        const unreadNotificationsQuery = query(
            notificationsRef,
            where("userId", "==", userId),
            where("read", "==", false)
        );

        const unreadSnapshot = await getDocs(unreadNotificationsQuery);
        const unreadCount = unreadSnapshot.size;

        updateNotificationBadge(unreadCount); // Update the badge
    }

    // Function to update the notification badge
    function updateNotificationBadge(unreadCount) {
        const badgeElement = document.getElementById('notification-badge');
        if (unreadCount > 0) {
            badgeElement.style.display = 'inline-block'; // Show the badge
            badgeElement.textContent = unreadCount;      // Set the count
        } else {
            badgeElement.style.display = 'none';         // Hide the badge if no unread notifications
        }
    }

    // Function to handle authentication state
    function handleAuthState() {
        const prevPageBtn = document.getElementById("prevPageBtn");
        const nextPageBtn = document.getElementById("nextPageBtn");

        onAuthStateChanged(auth, (user) => {
            if (user) {
                // User is signed in, get user ID and load notifications
                const userId = user.uid;

                // Load initial notifications
                loadClientNotifications(userId);

                // Fetch unread notifications to update the badge
                fetchUnreadNotifications(userId);

                // Handle "Previous Page" button click
                prevPageBtn.addEventListener("click", () => {
                    if (currentPage > 1) {
                        currentPage--;
                        lastVisibleDoc = null; // Reset last visible document when going to the previous page
                        loadClientNotifications(userId);
                    }
                });

                // Handle "Next Page" button click
                nextPageBtn.addEventListener("click", () => {
                    if (currentPage < totalPages) {
                        currentPage++;
                        loadClientNotifications(userId);
                    }
                });
            } else {
                console.error("User is not signed in.");
            }
        });
    }

    // Start monitoring authentication state when the DOM is fully loaded
    document.addEventListener('DOMContentLoaded', () => {
        handleAuthState();
    });
</script>



<script>
    document.addEventListener('DOMContentLoaded', () => {
        let currentStep = 1; // Start from the first step

        function goToNextStep() {
            console.log("Current step:", currentStep);

            // Validate file uploads in step 2
            if (currentStep === 2) {
                const buildingPlanInput = document.getElementById('buildingPlanFile');
                const proofOwnershipInput = document.getElementById('proofOwnershipFile');

                // Log the file input elements to check if they are null
                console.log("Building Plan Input:", buildingPlanInput);
                console.log("Proof Ownership Input:", proofOwnershipInput);

                // Check if the inputs exist
                if (!buildingPlanInput || !proofOwnershipInput) {
                    console.error("Required file inputs not found in the DOM.");
                    alert('Required file inputs are missing.');
                    return;
                }

                // Validate files
                const requiredFileInputs = [buildingPlanInput, proofOwnershipInput];
                for (const input of requiredFileInputs) {
                    if (!input.files[0]) {
                        alert('Please upload all required files before proceeding.');
                        return; // Stop if any required file is missing
                    }
                }
            }

            // Proceed with step transitions
            if (currentStep === 1) {
                // Transition from step 1 to step 2
                bootstrap.Modal.getInstance(document.getElementById('buildingPermitModal')).hide();
                new bootstrap.Modal(document.getElementById('buildingPermitUpload')).show();
                currentStep = 2; // Update current step to 2
            } else if (currentStep === 2) {
                // Transition from step 2 to step 3
                bootstrap.Modal.getInstance(document.getElementById('buildingPermitUpload')).hide();
                new bootstrap.Modal(document.getElementById('appointmentModal')).show();
                currentStep = 3; // Update current step to 3
            }
        }

        function goToPreviousStep() {
            if (currentStep === 2) {
                // Transition from step 2 back to step 1
                bootstrap.Modal.getInstance(document.getElementById('buildingPermitModal')).show();
                bootstrap.Modal.getInstance(document.getElementById('buildingPermitUpload')).hide();
                currentStep = 1; // Update current step to 1
            } else if (currentStep === 3) {
                // Transition from step 3 back to step 2
                bootstrap.Modal.getInstance(document.getElementById('appointmentModal')).hide();
                new bootstrap.Modal(document.getElementById('buildingPermitUpload')).show();
                currentStep = 2; // Update current step to 2
            }
        }

        function finishApplication() {
            // Final step: hide appointmentModal and show applicationAppliedModal
            bootstrap.Modal.getInstance(document.getElementById('appointmentModal')).hide();
            // You can also add additional logic here to submit the form or show a success message
        }

        // Event listeners for next and previous buttons
        document.getElementById('nextStepButton').addEventListener('click', goToNextStep);
        document.getElementById('nextStepButton2').addEventListener('click', goToNextStep);
        document.getElementById('previousStepButton').addEventListener('click', goToPreviousStep);
        document.getElementById('previousStepButton2').addEventListener('click', goToPreviousStep);

        // Event listener for finishing the application
        document.getElementById('submitProfile').addEventListener('click', finishApplication);
    });
</script>



<script>
    // Function to set the minimum date to tomorrow
    function setMinDate() {
        const today = new Date();
        const tomorrow = new Date(today);
        tomorrow.setDate(today.getDate() + 1); // Set to tomorrow

        const dd = String(tomorrow.getDate()).padStart(2, '0');
        const mm = String(tomorrow.getMonth() + 1).padStart(2, '0'); // January is 0!
        const yyyy = tomorrow.getFullYear();
        const minDate = yyyy + '-' + mm + '-' + dd; // Format as YYYY-MM-DD
        document.getElementById('appointmentDate').setAttribute('min', minDate);
    }

    // Function to disable weekends
    function disableWeekends() {
        const dateInput = document.getElementById('appointmentDate');
        dateInput.addEventListener('input', function () {
            const selectedDate = new Date(this.value);
            const day = selectedDate.getUTCDay();
            
            // Check if the selected day is Saturday (6) or Sunday (0)
            if (day === 6 || day === 0) {
                alert('Please select a weekday (Monday-Friday).');
                this.value = ''; // Clear the input if it's a weekend
            }
        });
    }

    setMinDate();
    disableWeekends();
</script>
  

<script>
    document.getElementById('applicationAppliedModal').addEventListener('hidden.bs.modal', function () {
    // Remove the modal backdrop manually if it remains
    const modalBackdrop = document.querySelector('.modal-backdrop');
    if (modalBackdrop) {
        modalBackdrop.remove();
    }
});

</script>

    
    
    
    </body>
    </html>